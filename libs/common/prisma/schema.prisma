generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth", "compliance", "public", "veroscore"]
}

model Tenant {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String                    @db.VarChar(255)
  domain                  String?                   @unique @db.VarChar(100)
  status                  String                    @default("active") @db.VarChar(20)
  subscription_tier       String                    @default("basic") @db.VarChar(20)
  created_at              DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at              DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  Invoice                 Invoice[]
  Payment                 Payment[]
  ServiceAgreement        ServiceAgreement[]
  auditLogs               AuditLog[]
  automatedCommunications AutomatedCommunication[]
  communicationTemplates  CommunicationTemplate[]
  complianceRecords       ComplianceRecord[]
  complianceRequirements  ComplianceRequirement[]
  customerAnalytics       CustomerAnalytics[]
  customerContacts        CustomerContact[]
  customerProfiles        CustomerProfile[]
  customerSegments        CustomerSegment[]
  jobs                    Job[]
  kpiTemplateUsage        KpiTemplateUsage[]
  kpiTemplates            KpiTemplate[]
  paymentMethods          PaymentMethod[]
  pricingTiers            PricingTier[]
  recurring_job_instances recurring_job_instances[]
  recurring_job_templates recurring_job_templates[]
  search_user_behavior    search_user_behavior[]
  serviceAnalytics        ServiceAnalytics[]
  serviceAreas            ServiceArea[]
  serviceCategories       ServiceCategory[]
  servicePricing          ServicePricing[]
  serviceTypes            ServiceType[]
  technician_availability technician_availability[]
  technicianDocuments     TechnicianDocument[]
  technicianPayroll       TechnicianPayroll[]
  technicianPerformance   TechnicianPerformance[]
  technicianProfiles      TechnicianProfile[]
  technician_schedules    technician_schedules[]
  technicianSkills        TechnicianSkill[]
  tenantBranding          TenantBranding?
  time_off_requests       time_off_requests[]
  userKpis                UserKpi[]
  users                   User[]
  workOrders              WorkOrder[]
  complianceChecks        ComplianceCheck[]
  complianceTrends         ComplianceTrend[]

  @@map("tenants")
  @@schema("public")
}

model User {
  id                                                       String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                                String                    @db.Uuid
  email                                                    String                    @unique @db.VarChar(255)
  password_hash                                            String                    @db.VarChar(255)
  first_name                                               String                    @db.VarChar(100)
  last_name                                                String                    @db.VarChar(100)
  phone                                                    String?                   @db.VarChar(20)
  roles                                                    String[]                  @default([])
  status                                                   String                    @default("active") @db.VarChar(20)
  created_at                                               DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at                                               DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  technician_number                                        String?                   @db.VarChar(20)
  pesticide_license_number                                 String?                   @db.VarChar(50)
  license_expiration_date                                  DateTime?                 @db.Date
  hire_date                                                DateTime?                 @db.Date
  position                                                 String?                   @db.VarChar(100)
  department                                               String?                   @db.VarChar(100)
  employment_type                                          String?                   @default("full_time") @db.VarChar(20)
  emergency_contact_name                                   String?                   @db.VarChar(100)
  emergency_contact_phone                                  String?                   @db.VarChar(20)
  employee_id                                              String?                   @unique @db.VarChar(20)
  emergency_contact_relationship                           String?                   @db.VarChar(50)
  address_line1                                            String?                   @db.VarChar(255)
  address_line2                                            String?                   @db.VarChar(255)
  city                                                     String?                   @db.VarChar(100)
  state                                                    String?                   @db.VarChar(2)
  postal_code                                              String?                   @db.VarChar(20)
  country                                                  String?                   @default("US") @db.VarChar(100)
  date_of_birth                                            DateTime?                 @db.Date
  social_security_number                                   String?                   @db.VarChar(255)
  driver_license_number                                    String?                   @db.VarChar(255)
  driver_license_state                                     String?                   @db.VarChar(2)
  driver_license_expiry                                    DateTime?                 @db.Date
  qualifications                                           String[]                  @default([])
  custom_permissions                                       String[]                  @default([])
  manager_id                                               String?                   @db.Uuid
  avatar_url                                               String?                   @db.VarChar(500)
  tags                                                     String[]                  @default([])
  Invoice_Invoice_created_byTousers                        Invoice[]                 @relation("Invoice_created_byTousers")
  Invoice_Invoice_updated_byTousers                        Invoice[]                 @relation("Invoice_updated_byTousers")
  Payment                                                  Payment[]
  ServiceAgreement_ServiceAgreement_created_byTousers      ServiceAgreement[]        @relation("ServiceAgreement_created_byTousers")
  ServiceAgreement_ServiceAgreement_updated_byTousers      ServiceAgreement[]        @relation("ServiceAgreement_updated_byTousers")
  complianceRecords                                        ComplianceRecord[]
  kpiTemplateUsage                                         KpiTemplateUsage[]
  approvedKpiTemplates                                     KpiTemplate[]             @relation("KpiTemplateApprover")
  createdKpiTemplates                                      KpiTemplate[]             @relation("KpiTemplateCreator")
  recurring_job_templates                                  recurring_job_templates[]
  serviceAnalytics                                         ServiceAnalytics[]
  technician_availability                                  technician_availability[]
  technicianDocuments                                      TechnicianDocument[]
  uploadedDocuments                                        TechnicianDocument[]      @relation("DocumentUploader")
  verifiedDocuments                                        TechnicianDocument[]      @relation("DocumentVerifier")
  technicianPayrolls                                       TechnicianPayroll[]
  technicianPerformance                                    TechnicianPerformance[]
  technicianProfiles                                       TechnicianProfile[]
  technician_schedules                                     technician_schedules[]
  technicianSkills                                         TechnicianSkill[]
  time_off_requests_time_off_requests_approved_byTousers   time_off_requests[]       @relation("time_off_requests_approved_byTousers")
  time_off_requests_time_off_requests_requested_byTousers  time_off_requests[]       @relation("time_off_requests_requested_byTousers")
  time_off_requests_time_off_requests_technician_idTousers time_off_requests[]       @relation("time_off_requests_technician_idTousers")
  userKpis                                                 UserKpi[]
  manager                                                  User?                     @relation("UserHierarchy", fields: [manager_id], references: [id], onUpdate: NoAction)
  directReports                                            User[]                    @relation("UserHierarchy")
  tenant                                                   Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  assignedWorkOrders                                       WorkOrder[]               @relation("WorkOrderAssignedTo")

  @@index([city], map: "idx_users_city")
  @@index([employment_type], map: "idx_users_employment_type")
  @@index([manager_id], map: "idx_users_manager_id")
  @@index([postal_code], map: "idx_users_postal_code")
  @@index([state], map: "idx_users_state")
  @@index([tags], map: "idx_users_tags", type: Gin)
  @@map("users")
  @@schema("public")
}

model CustomerSegment {
  id                      String            @id @default(uuid()) @db.Uuid
  tenant_id               String            @db.Uuid
  segment_name            String            @db.VarChar(100)
  segment_code            String            @db.VarChar(20)
  description             String?
  default_service_types   Json?
  pricing_tier            String            @default("standard") @db.VarChar(20)
  compliance_requirements Json?
  created_at              DateTime          @default(now()) @db.Timestamptz(6)
  updated_at              DateTime          @updatedAt @db.Timestamptz(6)
  customerProfiles        CustomerProfile[]
  tenant                  Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, segment_code])
  @@unique([tenant_id, segment_code], map: "customer_segments_tenant_code_unique")
  @@map("customer_segments")
  @@schema("public")
}

model ServiceCategory {
  id                  String        @id @default(uuid()) @db.Uuid
  tenant_id           String        @db.Uuid
  category_name       String        @db.VarChar(100)
  category_code       String        @db.VarChar(20)
  description         String?
  applicable_segments Json?
  estimated_duration  Int           @default(60)
  base_price          Decimal?      @db.Decimal(10, 2)
  created_at          DateTime      @default(now()) @db.Timestamptz(6)
  is_active           Boolean?      @default(true)
  tenant              Tenant        @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  serviceTypes        ServiceType[]

  @@unique([tenant_id, category_code])
  @@unique([tenant_id, category_code], map: "service_categories_tenant_code_unique")
  @@map("service_categories")
  @@schema("public")
}

model ServiceType {
  id                      String             @id @default(uuid()) @db.Uuid
  tenant_id               String             @db.Uuid
  category_id             String?            @db.Uuid
  service_name            String             @db.VarChar(100)
  service_code            String             @db.VarChar(20)
  description             String?
  required_equipment      Json?
  required_chemicals      Json?
  safety_requirements     Json?
  compliance_requirements Json?
  estimated_duration      Int                @default(60)
  base_price              Decimal?           @db.Decimal(10, 2)
  is_active               Boolean            @default(true)
  created_at              DateTime           @default(now()) @db.Timestamptz(6)
  InvoiceItem             InvoiceItem[]
  ServiceAgreement        ServiceAgreement[]
  serviceAnalytics        ServiceAnalytics[]
  servicePricing          ServicePricing[]
  category                ServiceCategory?   @relation(fields: [category_id], references: [id])
  tenant                  Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  technicianSkills        TechnicianSkill[]

  @@unique([tenant_id, service_code])
  @@unique([tenant_id, service_code], map: "service_types_tenant_code_unique")
  @@map("service_types")
  @@schema("public")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Account {
  id                 String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id          String    @db.Uuid
  name               String
  email              String?
  phone              String?
  address            String?
  city               String?
  state              String?
  zip_code           String?
  country            String?   @default("USA")
  status             String?   @default("active")
  account_type       String?   @default("residential")
  notes              String?
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @updatedAt @db.Timestamptz(6)
  created_by         String?   @db.Uuid
  updated_by         String?   @db.Uuid
  billing_address    Json?
  property_type      String?   @db.VarChar(100)
  property_size      String?   @db.VarChar(100)
  ar_balance         Decimal?  @default(0.00) @db.Decimal(10, 2)
  stripe_customer_id String?   @db.VarChar(255)
  Invoice            Invoice[]
  PaymentMethod      PaymentMethod[]
  ServiceAgreement   ServiceAgreement[]
  WorkOrder          WorkOrder[]
  Job                Job[]

  @@index([address(ops: raw("gin_trgm_ops"))], map: "idx_accounts_address", type: Gin)
  @@index([email], map: "idx_accounts_email")
  @@index([name(ops: raw("gin_trgm_ops"))], map: "idx_accounts_name", type: Gin)
  @@index([phone], map: "idx_accounts_phone")
  @@index([tenant_id], map: "idx_accounts_tenant_id")
  @@map("accounts")
  @@schema("public")
}

model CustomerProfile {
  id                    String           @id @default(uuid()) @db.Uuid
  tenant_id             String           @db.Uuid
  account_id            String           @db.Uuid
  segment_id            String?          @db.Uuid
  business_name         String?          @db.VarChar(255)
  business_type         String?          @db.VarChar(100)
  tax_id                String?          @db.VarChar(50)
  credit_limit          Decimal?         @db.Decimal(10, 2)
  credit_score          Int?
  credit_check_date     DateTime?        @db.Date
  property_type         String?          @db.VarChar(50)
  property_size         String?          @db.VarChar(50)
  year_built            Int?
  square_footage        Int?
  access_codes          String?
  gate_codes            String?
  key_locations         String?
  special_instructions  String?
  preferred_language    String           @default("English") @db.VarChar(20)
  timezone              String           @default("UTC") @db.VarChar(20)
  communication_methods Json?
  contract_start_date   DateTime?        @db.Date
  contract_end_date     DateTime?        @db.Date
  contract_type         String?          @db.VarChar(50)
  contract_value        Decimal?         @db.Decimal(10, 2)
  auto_renew            Boolean          @default(false)
  cancellation_policy   String?
  account_status        String           @default("active") @db.VarChar(20)
  payment_status        String           @default("current") @db.VarChar(20)
  service_status        String           @default("scheduled") @db.VarChar(20)
  created_at            DateTime         @default(now()) @db.Timestamptz(6)
  updated_at            DateTime         @updatedAt @db.Timestamptz(6)
  segment               CustomerSegment? @relation(fields: [segment_id], references: [id])
  tenant                Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, account_id])
  @@map("customer_profiles")
  @@schema("public")
}

model CustomerContact {
  id                       String                   @id @default(uuid()) @db.Uuid
  tenant_id                String                   @db.Uuid
  account_id               String                   @db.Uuid
  contact_type             String                   @db.VarChar(20)
  first_name               String?                  @db.VarChar(100)
  last_name                String?                  @db.VarChar(100)
  email                    String?                  @db.VarChar(255)
  phone                    String?                  @db.VarChar(20)
  mobile                   String?                  @db.VarChar(20)
  position                 String?                  @db.VarChar(100)
  is_primary               Boolean                  @default(false)
  is_emergency_contact     Boolean                  @default(false)
  preferred_contact_method String?                  @db.VarChar(20)
  notes                    String?
  created_at               DateTime                 @default(now()) @db.Timestamptz(6)
  automatedCommunications  AutomatedCommunication[]
  tenant                   Tenant                   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, account_id, contact_type])
  @@map("customer_contacts")
  @@schema("public")
}

model Location {
  id              String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String      @db.Uuid
  account_id      String      @db.Uuid
  name            String      @db.VarChar(255)
  address_line1   String      @db.VarChar(255)
  address_line2   String?     @db.VarChar(255)
  city            String      @db.VarChar(100)
  state           String      @db.VarChar(20)
  postal_code     String      @db.VarChar(20)
  country         String      @default("US") @db.VarChar(10)
  latitude        Decimal?    @db.Decimal(10, 8)
  longitude       Decimal?    @db.Decimal(11, 8)
  service_area_id String?     @db.Uuid
  created_at      DateTime    @default(now()) @db.Timestamptz(6)
  updated_at      DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  jobs            Job[]
  workOrders      WorkOrder[]

  @@unique([tenant_id, id])
  @@map("locations")
  @@schema("public")
}

model WorkOrder {
  id                                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                            String    @db.Uuid
  customer_id                          String    @db.Uuid
  assigned_to                          String?   @db.Uuid
  status                               String    @default("pending") @db.VarChar(20)
  priority                             String    @default("medium") @db.VarChar(20)
  scheduled_date                       DateTime? @db.Timestamptz(6)
  completion_date                      DateTime? @db.Timestamptz(6)
  description                          String
  notes                                String?
  created_at                           DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                           DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  account_id                           String?   @db.Uuid
  location_id                          String?   @db.Uuid
  service_type                         String?   @db.VarChar(100)
  recurrence_rule                      String?   @db.VarChar(255)
  estimated_duration                   Int?      @default(60)
  service_price                        Decimal?  @db.Decimal(8, 2)
  special_instructions                 String?
  Invoice                              Invoice[]
  jobs_jobs_work_order_idTowork_orders Job[]     @relation("jobs_work_order_idTowork_orders")
  jobs                                 Job[]
  location                             Location? @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_work_orders_location_id")
  assignedTechnician                   User?     @relation("WorkOrderAssignedTo", fields: [assigned_to], references: [id])
  tenant                               Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  account                              Account?  @relation(fields: [account_id], references: [id], onDelete: SetNull, onUpdate: NoAction)

  @@unique([tenant_id, id])
  @@index([tenant_id, status], map: "idx_work_orders_tenant_status")
  @@map("work_orders")
  @@schema("public")
}

model Job {
  id                                          String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                   String                    @db.Uuid
  work_order_id                               String                    @db.Uuid
  account_id                                  String                    @db.Uuid
  location_id                                 String                    @db.Uuid
  technician_id                               String?                   @db.Uuid
  status                                      String                    @default("unassigned") @db.VarChar(20)
  priority                                    String                    @default("medium") @db.VarChar(20)
  scheduled_date                              DateTime                  @db.Date
  scheduled_start_time                        String?                   @db.VarChar(8)
  scheduled_end_time                          String?                   @db.VarChar(8)
  actual_start_time                           DateTime?                 @db.Timestamptz(6)
  actual_end_time                             DateTime?                 @db.Timestamptz(6)
  completion_notes                            String?
  customer_signature                          String?                   @db.VarChar(500)
  photos                                      String[]                  @default([])
  chemicals_used                              Json[]                    @default([])
  created_at                                  DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at                                  DateTime                  @default(now()) @updatedAt @db.Timestamptz(6)
  parent_job_id                               String?                   @db.Uuid
  is_recurring                                Boolean?                  @default(false)
  recurring_template_id                       String?                   @db.Uuid
  Invoice                                     Invoice[]
  location                                    Location                  @relation(fields: [location_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_jobs_location_id")
  work_orders_jobs_work_order_idTowork_orders WorkOrder                 @relation("jobs_work_order_idTowork_orders", fields: [work_order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_jobs_work_order_id")
  jobs                                        Job?                      @relation("jobsTojobs", fields: [parent_job_id], references: [id], onUpdate: NoAction)
  other_jobs                                  Job[]                     @relation("jobsTojobs")
  recurring_job_templates                     recurring_job_templates?  @relation(fields: [recurring_template_id], references: [id], onUpdate: NoAction)
  tenant                                      Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  workOrder                                   WorkOrder                 @relation(fields: [tenant_id, work_order_id], references: [tenant_id, id])
  account                                     Account                   @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recurring_job_instances                     recurring_job_instances[]

  @@unique([tenant_id, id])
  @@index([tenant_id, technician_id, scheduled_date])
  @@index([tenant_id, status, scheduled_date])
  @@map("jobs")
  @@schema("public")
}

model ServiceArea {
  id                    String             @id @default(uuid()) @db.Uuid
  tenant_id             String             @db.Uuid
  area_name             String             @db.VarChar(100)
  area_code             String             @db.VarChar(20)
  description           String?
  boundaries            String?
  center_lat            Decimal?           @db.Decimal(10, 8)
  center_lng            Decimal?           @db.Decimal(11, 8)
  estimated_travel_time Int?
  is_active             Boolean            @default(true)
  created_at            DateTime           @default(now()) @db.Timestamptz(6)
  coverage_radius_miles Decimal?           @db.Decimal(8, 2)
  serviceAnalytics      ServiceAnalytics[]
  tenant                Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, area_code])
  @@unique([tenant_id, area_code], map: "service_areas_tenant_code_unique")
  @@map("service_areas")
  @@schema("public")
}

model TechnicianSkill {
  id                      String      @id @default(uuid()) @db.Uuid
  tenant_id               String      @db.Uuid
  technician_id           String      @db.Uuid
  service_type_id         String      @db.Uuid
  skill_level             String      @default("basic") @db.VarChar(20)
  certification_required  Boolean     @default(false)
  certification_expiry    DateTime?   @db.Date
  training_completed_date DateTime?   @db.Date
  is_active               Boolean     @default(true)
  created_at              DateTime    @default(now()) @db.Timestamptz(6)
  serviceType             ServiceType @relation(fields: [service_type_id], references: [id])
  technician              User        @relation(fields: [technician_id], references: [id])
  tenant                  Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, technician_id, service_type_id])
  @@map("technician_skills")
  @@schema("public")
}

model PricingTier {
  id                     String           @id @default(uuid()) @db.Uuid
  tenant_id              String           @db.Uuid
  tier_name              String           @db.VarChar(100)
  tier_code              String           @db.VarChar(20)
  description            String?
  base_multiplier        Decimal          @default(1.00) @db.Decimal(5, 2)
  minimum_contract_value Decimal?         @db.Decimal(10, 2)
  payment_terms          Int              @default(30)
  late_fee_percentage    Decimal          @default(0.00) @db.Decimal(5, 2)
  created_at             DateTime         @default(now()) @db.Timestamptz(6)
  is_active              Boolean?         @default(true)
  discount_percentage    Decimal?         @default(0.0) @db.Decimal(5, 2)
  tenant                 Tenant           @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  servicePricing         ServicePricing[]

  @@unique([tenant_id, tier_code])
  @@unique([tenant_id, tier_code], map: "pricing_tiers_tenant_code_unique")
  @@map("pricing_tiers")
  @@schema("public")
}

model ServicePricing {
  id              String      @id @default(uuid()) @db.Uuid
  tenant_id       String      @db.Uuid
  service_type_id String      @db.Uuid
  pricing_tier_id String      @db.Uuid
  base_price      Decimal     @db.Decimal(10, 2)
  hourly_rate     Decimal?    @db.Decimal(10, 2)
  minimum_charge  Decimal?    @db.Decimal(10, 2)
  travel_fee      Decimal?    @db.Decimal(10, 2)
  emergency_fee   Decimal?    @db.Decimal(10, 2)
  effective_date  DateTime    @db.Date
  expiry_date     DateTime?   @db.Date
  created_at      DateTime    @default(now()) @db.Timestamptz(6)
  pricingTier     PricingTier @relation(fields: [pricing_tier_id], references: [id])
  serviceType     ServiceType @relation(fields: [service_type_id], references: [id])
  tenant          Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, service_type_id, pricing_tier_id, effective_date])
  @@map("service_pricing")
  @@schema("public")
}

model PaymentMethod {
  id             String    @id @default(uuid()) @db.Uuid
  tenant_id      String    @db.Uuid
  account_id     String    @db.Uuid
  payment_type   String    @db.VarChar(20)
  payment_name   String?   @db.VarChar(100)
  account_number String?   @db.VarChar(50)
  routing_number String?   @db.VarChar(20)
  card_type      String?   @db.VarChar(20)
  card_last4     String?   @db.VarChar(4)
  card_expiry    String?   @db.VarChar(7)
  is_default     Boolean   @default(false)
  is_active      Boolean   @default(true)
  created_at     DateTime  @default(now()) @db.Timestamptz(6)
  Payment        Payment[]
  tenant         Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  account        Account   @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, account_id, payment_type])
  @@map("payment_methods")
  @@schema("public")
}

model CustomerAnalytics {
  id              String   @id @default(uuid()) @db.Uuid
  tenant_id       String   @db.Uuid
  account_id      String   @db.Uuid
  metric_date     DateTime @db.Date
  metric_type     String   @db.VarChar(50)
  metric_value    Decimal  @db.Decimal(15, 4)
  metric_metadata Json?
  calculated_at   DateTime @default(now()) @db.Timestamptz(6)
  tenant          Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, account_id, metric_date, metric_type])
  @@map("customer_analytics")
  @@schema("public")
}

model ServiceAnalytics {
  id              String       @id @default(uuid()) @db.Uuid
  tenant_id       String       @db.Uuid
  service_type_id String?      @db.Uuid
  service_area_id String?      @db.Uuid
  technician_id   String?      @db.Uuid
  metric_date     DateTime     @db.Date
  metric_type     String       @db.VarChar(50)
  metric_value    Decimal      @db.Decimal(15, 4)
  metric_metadata Json?
  calculated_at   DateTime     @default(now()) @db.Timestamptz(6)
  serviceArea     ServiceArea? @relation(fields: [service_area_id], references: [id])
  serviceType     ServiceType? @relation(fields: [service_type_id], references: [id])
  technician      User?        @relation(fields: [technician_id], references: [id])
  tenant          Tenant       @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@map("service_analytics")
  @@schema("public")
}

model CommunicationTemplate {
  id                      String                   @id @default(uuid()) @db.Uuid
  tenant_id               String                   @db.Uuid
  template_name           String                   @db.VarChar(100)
  template_type           String                   @db.VarChar(50)
  subject                 String?                  @db.VarChar(255)
  content                 String
  variables               Json?
  applicable_segments     Json?
  is_active               Boolean                  @default(true)
  created_at              DateTime                 @default(now()) @db.Timestamptz(6)
  automatedCommunications AutomatedCommunication[]
  tenant                  Tenant                   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@map("communication_templates")
  @@schema("public")
}

model AutomatedCommunication {
  id                   String                 @id @default(uuid()) @db.Uuid
  tenant_id            String                 @db.Uuid
  account_id           String                 @db.Uuid
  template_id          String?                @db.Uuid
  trigger_type         String                 @db.VarChar(50)
  trigger_conditions   Json?
  scheduled_date       DateTime?              @db.Timestamptz(6)
  sent_date            DateTime?              @db.Timestamptz(6)
  status               String                 @default("pending") @db.VarChar(20)
  recipient_contact_id String?                @db.Uuid
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  recipientContact     CustomerContact?       @relation(fields: [recipient_contact_id], references: [id])
  template             CommunicationTemplate? @relation(fields: [template_id], references: [id])
  tenant               Tenant                 @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@map("automated_communications")
  @@schema("public")
}

model ComplianceRequirement {
  id                       String             @id @default(uuid()) @db.Uuid
  tenant_id                String             @db.Uuid
  requirement_name         String             @db.VarChar(255)
  requirement_type         String             @db.VarChar(50)
  applicable_segments      Json?
  applicable_service_types Json?
  frequency                String             @db.VarChar(20)
  documentation_required   Boolean            @default(true)
  auto_reminder            Boolean            @default(true)
  reminder_days            Int                @default(30)
  is_active                Boolean            @default(true)
  created_at               DateTime           @default(now()) @db.Timestamptz(6)
  complianceRecords        ComplianceRecord[]
  tenant                   Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@map("compliance_requirements")
  @@schema("public")
}

model ComplianceRecord {
  id                String                @id @default(uuid()) @db.Uuid
  tenant_id         String                @db.Uuid
  account_id        String                @db.Uuid
  requirement_id    String                @db.Uuid
  service_id        String?               @db.Uuid
  status            String                @default("pending") @db.VarChar(20)
  due_date          DateTime              @db.Date
  completion_date   DateTime?             @db.Date
  completed_by      String?               @db.Uuid
  documentation_url String?               @db.VarChar(500)
  notes             String?
  created_at        DateTime              @default(now()) @db.Timestamptz(6)
  completedByUser   User?                 @relation(fields: [completed_by], references: [id])
  requirement       ComplianceRequirement @relation(fields: [requirement_id], references: [id])
  tenant            Tenant                @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@map("compliance_records")
  @@schema("public")
}

model ServiceHistory {
  id                 String   @id @default(uuid()) @db.Uuid
  tenant_id          String   @db.Uuid
  customer_id        String   @db.Uuid
  service_date       DateTime @db.Date
  service_type       String   @db.VarChar(100)
  treatments_applied String?
  technician_id      String?  @db.Uuid
  technician_notes   String?
  before_photos      Json?
  after_photos       Json?
  cost               Decimal  @db.Decimal(10, 2)
  status             String   @default("completed") @db.VarChar(20)
  created_at         DateTime @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, id])
  @@map("service_history")
  @@schema("public")
}

model ContractsSubscription {
  id                String    @id @default(uuid()) @db.Uuid
  tenant_id         String    @db.Uuid
  customer_id       String    @db.Uuid
  contract_type     String    @db.VarChar(50)
  service_frequency String    @db.VarChar(50)
  start_date        DateTime  @db.Date
  end_date          DateTime? @db.Date
  auto_renewal      Boolean   @default(true)
  contract_value    Decimal   @db.Decimal(10, 2)
  payment_schedule  String?   @db.VarChar(50)
  terms_conditions  String?
  signed_date       DateTime? @db.Date
  status            String    @default("active") @db.VarChar(20)
  created_at        DateTime  @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, id])
  @@map("contracts_subscriptions")
  @@schema("public")
}

model CommunicationLog {
  id                 String    @id @default(uuid()) @db.Uuid
  tenant_id          String    @db.Uuid
  customer_id        String    @db.Uuid
  communication_type String    @db.VarChar(50)
  direction          String    @db.VarChar(20)
  subject            String?   @db.VarChar(255)
  message_content    String?
  staff_member       String?   @db.VarChar(100)
  timestamp          DateTime  @default(now()) @db.Timestamptz(6)
  follow_up_required Boolean   @default(false)
  follow_up_date     DateTime? @db.Date

  @@unique([tenant_id, id])
  @@map("communication_logs")
  @@schema("public")
}

model CustomerNote {
  id              String   @id @default(uuid()) @db.Uuid
  tenant_id       String   @db.Uuid
  customer_id     String   @db.Uuid
  note_type       String   @db.VarChar(50)
  note_source     String   @db.VarChar(50)
  note_content    String
  created_by      String   @db.VarChar(100)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  priority        String   @default("low") @db.VarChar(20)
  is_alert        Boolean  @default(false)
  is_internal     Boolean  @default(false)
  technician_id   String?  @db.Uuid
  work_order_id   String?  @db.Uuid
  location_coords String?  @db.VarChar(100)

  @@unique([tenant_id, id])
  @@map("customer_notes")
  @@schema("public")
}

model PestActivityTracking {
  id                   String   @id @default(uuid()) @db.Uuid
  tenant_id            String   @db.Uuid
  customer_id          String   @db.Uuid
  pest_type            String   @db.VarChar(100)
  severity_level       Int
  location_on_property String?  @db.VarChar(255)
  weather_conditions   String?  @db.VarChar(100)
  temperature          Decimal? @db.Decimal(5, 2)
  humidity             Decimal? @db.Decimal(5, 2)
  season               String?  @db.VarChar(20)
  treatment_applied    String?  @db.VarChar(255)
  effectiveness_score  Int?
  recorded_by          String?  @db.VarChar(100)
  recorded_at          DateTime @default(now()) @db.Timestamptz(6)
  gps_coordinates      String?  @db.VarChar(100)
  photo_evidence_ids   Json?

  @@unique([tenant_id, id])
  @@map("pest_activity_tracking")
  @@schema("public")
}

model ComplianceTracking {
  id                String    @id @default(uuid()) @db.Uuid
  tenant_id         String    @db.Uuid
  customer_id       String    @db.Uuid
  compliance_type   String    @db.VarChar(50)
  requirement       String    @db.VarChar(255)
  due_date          DateTime  @db.Date
  completion_date   DateTime? @db.Date
  status            String    @default("pending") @db.VarChar(20)
  assigned_to       String?   @db.VarChar(100)
  notes             String?
  documentation_url String?   @db.VarChar(500)

  @@unique([tenant_id, id])
  @@map("compliance_tracking")
  @@schema("public")
}

model TechnicianCertification {
  id                    String   @id @default(uuid()) @db.Uuid
  tenant_id             String   @db.Uuid
  technician_id         String   @db.Uuid
  certification_type    String   @db.VarChar(100)
  issuing_authority     String   @db.VarChar(100)
  issue_date            DateTime @db.Date
  expiration_date       DateTime @db.Date
  status                String   @default("active") @db.VarChar(20)
  renewal_reminder_sent Boolean  @default(false)
  created_at            DateTime @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, id])
  @@map("technician_certifications")
  @@schema("public")
}

model ChemicalUsageLog {
  id                 String   @id @default(uuid()) @db.Uuid
  tenant_id          String   @db.Uuid
  customer_id        String   @db.Uuid
  service_id         String?  @db.Uuid
  chemical_name      String   @db.VarChar(255)
  epa_number         String?  @db.VarChar(50)
  application_rate   Decimal? @db.Decimal(8, 4)
  total_amount_used  Decimal? @db.Decimal(8, 4)
  application_method String?  @db.VarChar(100)
  target_pest        String?  @db.VarChar(100)
  technician_id      String?  @db.Uuid
  application_date   DateTime @default(now()) @db.Timestamptz(6)
  weather_conditions String?  @db.VarChar(100)
  safety_precautions String?

  @@unique([tenant_id, id])
  @@map("chemical_usage_log")
  @@schema("public")
}

model CustomerPhoto {
  id                 String   @id @default(uuid()) @db.Uuid
  tenant_id          String   @db.Uuid
  customer_id        String   @db.Uuid
  photo_type         String   @db.VarChar(50)
  photo_category     String   @db.VarChar(50)
  file_url           String   @db.VarChar(500)
  thumbnail_url      String?  @db.VarChar(500)
  file_size          Int?
  taken_by           String?  @db.VarChar(100)
  taken_at           DateTime @default(now()) @db.Timestamptz(6)
  work_order_id      String?  @db.Uuid
  location_coords    String?  @db.VarChar(100)
  description        String?
  is_before_photo    Boolean  @default(false)
  is_customer_facing Boolean  @default(true)
  pest_type          String?  @db.VarChar(100)
  treatment_area     String?  @db.VarChar(255)

  @@unique([tenant_id, id])
  @@map("customer_photos")
  @@schema("public")
}

model BusinessAnalytics {
  id                    String    @id @default(uuid()) @db.Uuid
  tenant_id             String    @db.Uuid
  customer_id           String    @db.Uuid
  metric_type           String    @db.VarChar(50)
  metric_value          Decimal   @db.Decimal(10, 4)
  calculated_date       DateTime  @default(now()) @db.Timestamptz(6)
  factors               Json?
  prediction_confidence Decimal?  @db.Decimal(5, 4)
  next_review_date      DateTime? @db.Date

  @@unique([tenant_id, id])
  @@map("business_analytics")
  @@schema("public")
}

model CustomerDocument {
  id            String    @id @default(uuid()) @db.Uuid
  tenant_id     String    @db.Uuid
  customer_id   String    @db.Uuid
  document_type String    @db.VarChar(50)
  document_name String    @db.VarChar(255)
  file_url      String    @db.VarChar(500)
  file_size     Int?
  mime_type     String?   @db.VarChar(100)
  uploaded_by   String?   @db.VarChar(100)
  uploaded_at   DateTime  @default(now()) @db.Timestamptz(6)
  document_date DateTime? @db.Date

  @@unique([tenant_id, id])
  @@map("customer_documents")
  @@schema("public")
}

model TenantBranding {
  id               String   @id @default(uuid()) @db.Uuid
  tenant_id        String   @unique @db.Uuid
  theme_json       Json     @default("{}")
  logo_url         String?  @db.VarChar(500)
  version          String   @default("1.0.0") @db.VarChar(20)
  status           String   @default("published") @db.VarChar(20)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @updatedAt @db.Timestamptz(6)
  company_name     String?  @db.VarChar(255)
  address          String?
  city             String?  @db.VarChar(100)
  state            String?  @db.VarChar(50)
  zip_code         String?  @db.VarChar(20)
  country          String?  @default("USA") @db.VarChar(50)
  phone            String?  @db.VarChar(20)
  email            String?  @db.VarChar(255)
  website          String?  @db.VarChar(255)
  header_logo_url  String?
  invoice_logo_url String?
  tenant           Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, header_logo_url, invoice_logo_url], map: "idx_tenant_branding_logos")
  @@map("tenant_branding")
  @@schema("public")
}

model AuditLog {
  id            String   @id @default(uuid()) @db.Uuid
  tenant_id     String   @db.Uuid
  user_id       String?  @db.Uuid
  action        String   @db.VarChar(50)
  resource_type String   @db.VarChar(50)
  resource_id   String?  @db.Uuid
  before_state  Json?
  after_state   Json?
  request_id    String   @db.Uuid
  ip_address    String?  @db.Inet
  user_agent    String?
  timestamp     DateTime @default(now()) @db.Timestamptz(6)
  tenant        Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, timestamp(sort: Desc)])
  @@index([tenant_id, timestamp(sort: Desc)], map: "idx_audit_logs_tenant_timestamp")
  @@map("audit_logs")
  @@schema("public")
}

model Invoice {
  id                              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                       String            @db.Uuid
  account_id                      String            @db.Uuid
  service_agreement_id            String?           @db.Uuid
  work_order_id                   String?           @db.Uuid
  job_id                          String?           @db.Uuid
  invoice_number                  String
  status                          InvoiceStatus     @default(draft)
  issue_date                      DateTime
  due_date                        DateTime
  subtotal                        Decimal           @default(0) @db.Decimal(10, 2)
  tax_amount                      Decimal           @default(0) @db.Decimal(10, 2)
  total_amount                    Decimal           @default(0) @db.Decimal(10, 2)
  notes                           String?
  created_at                      DateTime          @default(now())
  updated_at                      DateTime
  created_by                      String            @db.Uuid
  updated_by                      String            @db.Uuid
  users_Invoice_created_byTousers User              @relation("Invoice_created_byTousers", fields: [created_by], references: [id])
  jobs                            Job?              @relation(fields: [job_id], references: [id])
  ServiceAgreement                ServiceAgreement? @relation(fields: [service_agreement_id], references: [id])
  tenants                         Tenant            @relation(fields: [tenant_id], references: [id])
  users_Invoice_updated_byTousers User              @relation("Invoice_updated_byTousers", fields: [updated_by], references: [id])
  work_orders                     WorkOrder?        @relation(fields: [work_order_id], references: [id])
  InvoiceItem                     InvoiceItem[]
  Payment                         Payment[]
  account                         Account           @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([invoice_number, tenant_id])
  @@index([account_id])
  @@index([due_date])
  @@index([status])
  @@index([tenant_id])
  @@map("Invoice")
  @@schema("public")
}

model InvoiceItem {
  id              String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  invoice_id      String      @db.Uuid
  service_type_id String      @db.Uuid
  description     String
  quantity        Int         @default(1)
  unit_price      Decimal     @db.Decimal(10, 2)
  total_price     Decimal     @db.Decimal(10, 2)
  created_at      DateTime    @default(now())
  Invoice         Invoice     @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  service_types   ServiceType @relation(fields: [service_type_id], references: [id])

  @@index([invoice_id])
  @@map("InvoiceItem")
  @@schema("public")
}

model Payment {
  id                String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String        @db.Uuid
  invoice_id        String        @db.Uuid
  payment_method_id String        @db.Uuid
  amount            Decimal       @db.Decimal(10, 2)
  payment_date      DateTime
  reference_number  String?
  notes             String?
  created_at        DateTime      @default(now())
  created_by        String        @db.Uuid
  users             User          @relation(fields: [created_by], references: [id])
  Invoice           Invoice       @relation(fields: [invoice_id], references: [id], onDelete: Cascade)
  payment_methods   PaymentMethod @relation(fields: [payment_method_id], references: [id])
  tenants           Tenant        @relation(fields: [tenant_id], references: [id])

  @@index([invoice_id])
  @@index([payment_date])
  @@index([tenant_id])
  @@map("Payment")
  @@schema("public")
}

model ServiceAgreement {
  id                                       String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                String                 @db.Uuid
  account_id                               String                 @db.Uuid
  service_type_id                          String                 @db.Uuid
  agreement_number                         String
  title                                    String
  description                              String?
  start_date                               DateTime
  end_date                                 DateTime?
  status                                   ServiceAgreementStatus @default(active)
  terms                                    String?
  pricing                                  Decimal?               @db.Decimal(10, 2)
  billing_frequency                        BillingFrequency       @default(monthly)
  created_at                               DateTime               @default(now())
  updated_at                               DateTime
  created_by                               String                 @db.Uuid
  updated_by                               String                 @db.Uuid
  Invoice                                  Invoice[]
  users_ServiceAgreement_created_byTousers User                   @relation("ServiceAgreement_created_byTousers", fields: [created_by], references: [id])
  service_types                            ServiceType            @relation(fields: [service_type_id], references: [id])
  tenants                                  Tenant                 @relation(fields: [tenant_id], references: [id])
  users_ServiceAgreement_updated_byTousers User                   @relation("ServiceAgreement_updated_byTousers", fields: [updated_by], references: [id])
  account                                  Account                @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([agreement_number, tenant_id])
  @@index([account_id])
  @@index([status])
  @@index([tenant_id])
  @@map("ServiceAgreement")
  @@schema("public")
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model ext_exists {
  exists Boolean?

  @@ignore
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model knowledge_articles {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  category_id  String    @db.Uuid
  title        String
  author       String?
  publish_date DateTime? @db.Date
  last_updated DateTime? @db.Date
  read_time    String?
  difficulty   String?
  rating       Decimal?  @db.Decimal
  views        Int?      @default(0)
  tags         String[]  @default([])
  content      String
  featured     Boolean?  @default(false)
  created_at   DateTime? @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

model knowledge_categories {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  slug        String    @unique
  name        String
  description String?
  icon        String?
  created_at  DateTime? @default(now()) @db.Timestamptz(6)

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model popular_searches {
  id                 String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id          String?   @db.Uuid
  query_text         String
  query_hash         String    @db.VarChar(64)
  search_count       Int       @default(1)
  unique_users       Int       @default(1)
  last_searched_at   DateTime? @default(now()) @db.Timestamptz(6)
  success_rate       Decimal   @default(1.0) @db.Decimal(5, 4)
  avg_results_count  Decimal   @default(0) @db.Decimal(5, 2)
  click_through_rate Decimal   @default(0.0) @db.Decimal(5, 4)
  query_length       Int
  word_count         Int
  has_numbers        Boolean   @default(false)
  has_special_chars  Boolean   @default(false)
  is_trending        Boolean   @default(false)
  trend_score        Decimal   @default(0.0) @db.Decimal(5, 4)
  created_at         DateTime? @default(now()) @db.Timestamptz(6)
  updated_at         DateTime? @default(now()) @db.Timestamptz(6)
  success_count      Int       @default(0)
  total_results      Int       @default(0)
  query              String?

  @@unique([tenant_id, query_hash])
  @@index([tenant_id], map: "idx_popular_searches_tenant")
  @@index([tenant_id, is_trending, trend_score], map: "idx_popular_searches_trending")
  @@index([tenant_id, search_count(sort: Desc)], map: "idx_popular_searches_usage")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model search_corrections {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id        String    @db.Uuid
  original_query   String
  corrected_query  String
  success_count    Int?      @default(0)
  total_attempts   Int?      @default(0)
  confidence_score Decimal?  @default(0.0) @db.Decimal(3, 2)
  created_at       DateTime? @default(now()) @db.Timestamptz(6)
  updated_at       DateTime? @default(now()) @db.Timestamptz(6)

  @@index([confidence_score(sort: Desc)], map: "idx_search_corrections_confidence")
  @@index([original_query], map: "idx_search_corrections_original_query")
  @@index([tenant_id], map: "idx_search_corrections_tenant_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model search_performance_metrics {
  id                       String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id                String    @db.Uuid
  metric_date              DateTime  @db.Date
  metric_hour              Int
  total_searches           Int       @default(0)
  unique_users             Int       @default(0)
  unique_queries           Int       @default(0)
  avg_execution_time_ms    Decimal   @default(0) @db.Decimal(10, 2)
  median_execution_time_ms Decimal   @default(0) @db.Decimal(10, 2)
  p95_execution_time_ms    Decimal   @default(0) @db.Decimal(10, 2)
  p99_execution_time_ms    Decimal   @default(0) @db.Decimal(10, 2)
  success_rate             Decimal   @default(1.0) @db.Decimal(5, 4)
  error_count              Int       @default(0)
  cache_hit_rate           Decimal   @default(0.0) @db.Decimal(5, 4)
  cache_hits               Int       @default(0)
  cache_misses             Int       @default(0)
  avg_results_per_search   Decimal   @default(0) @db.Decimal(5, 2)
  click_through_rate       Decimal   @default(0.0) @db.Decimal(5, 4)
  avg_time_to_click_ms     Decimal   @default(0) @db.Decimal(10, 2)
  standard_searches        Int       @default(0)
  fuzzy_searches           Int       @default(0)
  hybrid_searches          Int       @default(0)
  vector_searches          Int       @default(0)
  created_at               DateTime? @default(now()) @db.Timestamptz(6)
  updated_at               DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, metric_date, metric_hour])
  @@index([created_at], map: "idx_search_performance_created")
  @@index([tenant_id, metric_date], map: "idx_search_performance_tenant_date")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model search_suggestions_analytics {
  id                      String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id               String?   @db.Uuid
  original_query          String
  suggested_query         String
  suggestion_type         String    @db.VarChar(50)
  confidence_score        Decimal   @db.Decimal(5, 4)
  times_suggested         Int       @default(1)
  times_accepted          Int       @default(0)
  times_rejected          Int       @default(0)
  avg_time_to_accept_ms   Decimal   @default(0) @db.Decimal(10, 2)
  acceptance_rate         Decimal   @default(0.0) @db.Decimal(5, 4)
  avg_original_results    Int       @default(0)
  avg_suggested_results   Int       @default(0)
  result_improvement_rate Decimal   @default(0.0) @db.Decimal(5, 4)
  created_at              DateTime? @default(now()) @db.Timestamptz(6)
  updated_at              DateTime? @default(now()) @db.Timestamptz(6)

  @@index([tenant_id, confidence_score(sort: Desc)], map: "idx_search_suggestions_confidence")
  @@index([tenant_id], map: "idx_search_suggestions_tenant")
  @@index([tenant_id, suggestion_type], map: "idx_search_suggestions_type")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model search_trends {
  id                     String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id              String?   @db.Uuid
  trend_period           String    @db.VarChar(20)
  trend_date             DateTime  @db.Date
  trending_queries       Json
  emerging_queries       Json
  declining_queries      Json
  total_trending_queries Int       @default(0)
  avg_trend_score        Decimal   @default(0.0) @db.Decimal(5, 4)
  trend_volatility       Decimal   @default(0.0) @db.Decimal(5, 4)
  is_seasonal            Boolean   @default(false)
  season_name            String?   @db.VarChar(50)
  seasonal_multiplier    Decimal   @default(1.0) @db.Decimal(5, 4)
  created_at             DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, trend_period, trend_date])
  @@index([tenant_id, trend_period, trend_date], map: "idx_search_trends_period_date")
  @@index([tenant_id], map: "idx_search_trends_tenant")
  @@schema("public")
}

model search_typo_corrections {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String    @db.Uuid
  original_query  String
  corrected_query String
  user_accepted   Boolean?  @default(false)
  frequency       Int?      @default(1)
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, original_query, corrected_query])
  @@index([tenant_id, original_query], map: "idx_typo_corrections_tenant_query")
  @@schema("public")
}

model TechnicianProfile {
  id                             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                      String    @db.Uuid
  user_id                        String    @db.Uuid
  employee_id                    String?   @db.VarChar(20)
  hire_date                      DateTime  @db.Date
  position                       String?   @db.VarChar(100)
  department                     String?   @db.VarChar(100)
  employment_type                String    @default("full_time") @db.VarChar(20)
  status                         String    @default("active") @db.VarChar(20)
  emergency_contact_name         String?   @db.VarChar(100)
  emergency_contact_phone        String?   @db.VarChar(20)
  emergency_contact_relationship String?   @db.VarChar(50)
  address_line1                  String?   @db.VarChar(255)
  address_line2                  String?   @db.VarChar(255)
  city                           String?   @db.VarChar(100)
  state                          String?   @db.VarChar(20)
  postal_code                    String?   @db.VarChar(20)
  country                        String    @default("US") @db.VarChar(10)
  date_of_birth                  DateTime? @db.Date
  social_security_number         String?   @db.VarChar(11)
  driver_license_number          String?   @db.VarChar(50)
  driver_license_state           String?   @db.VarChar(20)
  driver_license_expiry          DateTime? @db.Date
  created_at                     DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  tenant                         Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  user                           User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, user_id])
  @@index([tenant_id, department])
  @@index([tenant_id, position])
  @@index([tenant_id, status])
  @@map("technician_profiles")
  @@schema("public")
}

model TechnicianPayroll {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id           String    @db.Uuid
  technician_id       String    @db.Uuid
  employment_type     String    @default("hourly") @db.VarChar(20)
  pay_rate            Decimal?  @db.Decimal(10, 2)
  overtime_rate       Decimal?  @db.Decimal(10, 2)
  benefits_enrolled   Json?
  direct_deposit_info Json?
  tax_withholding     Json?
  start_date          DateTime? @db.Date
  end_date            DateTime? @db.Date
  is_active           Boolean   @default(true)
  created_at          DateTime  @default(now()) @db.Timestamptz(6)
  updated_at          DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  technician          User      @relation(fields: [technician_id], references: [id], onDelete: Cascade)
  tenant              Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, technician_id])
  @@map("technician_payroll")
  @@schema("public")
}

model TechnicianDocument {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String    @db.Uuid
  technician_id   String    @db.Uuid
  document_type   String    @db.VarChar(50)
  document_name   String    @db.VarChar(255)
  file_url        String    @db.VarChar(500)
  file_size       Int?
  mime_type       String?   @db.VarChar(100)
  expiration_date DateTime? @db.Date
  upload_date     DateTime  @default(now()) @db.Timestamptz(6)
  uploaded_by     String?   @db.Uuid
  is_verified     Boolean   @default(false)
  verified_by     String?   @db.Uuid
  verified_at     DateTime? @db.Timestamptz(6)
  notes           String?
  technician      User      @relation(fields: [technician_id], references: [id], onDelete: Cascade)
  tenant          Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade)
  uploader        User?     @relation("DocumentUploader", fields: [uploaded_by], references: [id])
  verifier        User?     @relation("DocumentVerifier", fields: [verified_by], references: [id])

  @@index([expiration_date])
  @@index([tenant_id, document_type])
  @@index([tenant_id, technician_id])
  @@map("technician_documents")
  @@schema("public")
}

model TechnicianPerformance {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id               String   @db.Uuid
  technician_id           String   @db.Uuid
  period_start            DateTime @db.Date
  period_end              DateTime @db.Date
  jobs_completed          Int      @default(0)
  jobs_cancelled          Int      @default(0)
  total_revenue           Decimal  @default(0) @db.Decimal(10, 2)
  average_rating          Decimal? @db.Decimal(3, 2)
  customer_feedback_count Int      @default(0)
  on_time_percentage      Decimal? @db.Decimal(5, 2)
  completion_rate         Decimal? @db.Decimal(5, 2)
  created_at              DateTime @default(now()) @db.Timestamptz(6)
  technician              User     @relation(fields: [technician_id], references: [id], onDelete: Cascade)
  tenant                  Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade)

  @@unique([tenant_id, technician_id, period_start, period_end], map: "technician_performance_tenant_id_technician_id_period_start_per")
  @@index([period_start, period_end])
  @@index([tenant_id, technician_id])
  @@map("technician_performance")
  @@schema("public")
}

model KpiTemplate {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id          String             @db.Uuid
  name               String             @db.VarChar(255)
  description        String?
  category           String?            @default("user") @db.VarChar(50)
  template_type      String?            @default("user") @db.VarChar(50)
  formula_expression String
  formula_fields     Json?              @default("[]")
  threshold_config   Json?              @default("{}")
  chart_config       Json?              @default("{}")
  data_source_config Json?              @default("{}")
  tags               String[]           @default([])
  is_public          Boolean?           @default(false)
  is_featured        Boolean?           @default(false)
  usage_count        Int?               @default(0)
  version            String?            @default("1.0.0") @db.VarChar(20)
  status             String?            @default("published") @db.VarChar(20)
  created_by         String?            @db.Uuid
  approved_by        String?            @db.Uuid
  created_at         DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?          @default(now()) @updatedAt @db.Timestamptz(6)
  dashboard_cards    dashboard_cards[]
  templateFields     KpiTemplateField[]
  templateUsage      KpiTemplateUsage[]
  approver           User?              @relation("KpiTemplateApprover", fields: [approved_by], references: [id], onUpdate: NoAction)
  creator            User?              @relation("KpiTemplateCreator", fields: [created_by], references: [id], onUpdate: NoAction)
  tenant             Tenant             @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  userKpis           UserKpi[]

  @@index([category], map: "idx_kpi_templates_category")
  @@index([created_at(sort: Desc)], map: "idx_kpi_templates_created_at_desc")
  @@index([is_public], map: "idx_kpi_templates_is_public")
  @@index([template_type], map: "idx_kpi_templates_template_type")
  @@index([tenant_id], map: "idx_kpi_templates_tenant_id")
  @@index([usage_count(sort: Desc)], map: "idx_kpi_templates_usage_count_desc")
  @@map("kpi_templates")
  @@schema("public")
}

model KpiTemplateField {
  id               String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  template_id      String      @db.Uuid
  field_name       String      @db.VarChar(255)
  field_type       String      @db.VarChar(50)
  table_name       String      @db.VarChar(255)
  column_name      String      @db.VarChar(255)
  aggregation_type String?     @db.VarChar(50)
  display_name     String      @db.VarChar(255)
  description      String?
  is_required      Boolean?    @default(false)
  sort_order       Int?        @default(0)
  template         KpiTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sort_order], map: "idx_kpi_template_fields_sort_order")
  @@index([template_id], map: "idx_kpi_template_fields_template_id")
  @@map("kpi_template_fields")
  @@schema("public")
}

model UserKpi {
  id                 String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id          String            @db.Uuid
  user_id            String            @db.Uuid
  template_id        String?           @db.Uuid
  name               String            @db.VarChar(255)
  description        String?
  formula_expression String
  formula_fields     Json?             @default("[]")
  threshold_config   Json?             @default("{}")
  chart_config       Json?             @default("{}")
  data_source_config Json?             @default("{}")
  is_active          Boolean?          @default(true)
  last_calculated    DateTime?         @db.Timestamptz(6)
  last_value         Decimal?          @db.Decimal(15, 4)
  created_at         DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?         @default(now()) @updatedAt @db.Timestamptz(6)
  dashboard_cards    dashboard_cards[]
  template           KpiTemplate?      @relation(fields: [template_id], references: [id], onUpdate: NoAction)
  tenant             Tenant            @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user               User              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_user_kpis_is_active")
  @@index([template_id], map: "idx_user_kpis_template_id")
  @@index([tenant_id, user_id], map: "idx_user_kpis_tenant_user")
  @@map("user_kpis")
  @@schema("public")
}

model KpiTemplateUsage {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  template_id String      @db.Uuid
  user_id     String      @db.Uuid
  tenant_id   String      @db.Uuid
  action      String      @db.VarChar(50)
  created_at  DateTime?   @default(now()) @db.Timestamptz(6)
  template    KpiTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenant      Tenant      @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        User        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([action], map: "idx_kpi_template_usage_action")
  @@index([created_at(sort: Desc)], map: "idx_kpi_template_usage_created_at_desc")
  @@index([template_id], map: "idx_kpi_template_usage_template_id")
  @@index([tenant_id], map: "idx_kpi_template_usage_tenant_id")
  @@index([user_id], map: "idx_kpi_template_usage_user_id")
  @@map("kpi_template_usage")
  @@schema("public")
}

model DashboardLayout {
  id              String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String                   @db.Uuid
  user_id         String?                  @db.Uuid
  name            String
  is_default      Boolean                  @default(false)
  created_at      DateTime                 @default(now()) @db.Timestamptz(6)
  updated_at      DateTime                 @default(now()) @updatedAt @db.Timestamptz(6)
  deleted_at      DateTime?                @db.Timestamptz(6)
  dashboard_cards dashboard_cards[]
  versions        DashboardLayoutVersion[]
  regions         DashboardRegion[]

  @@index([tenant_id], map: "idx_dashboard_layouts_tenant")
  @@index([user_id], map: "idx_dashboard_layouts_user")
  @@map("dashboard_layouts")
  @@schema("public")
}

model DashboardRegion {
  id               String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  layout_id        String                    @db.Uuid
  tenant_id        String                    @db.Uuid
  user_id          String                    @db.Uuid
  region_type      String                    @db.VarChar(50)
  grid_row         Int                       @default(0)
  grid_col         Int                       @default(0)
  row_span         Int                       @default(1)
  col_span         Int                       @default(1)
  min_width        Int?                      @default(200)
  min_height       Int?                      @default(150)
  is_collapsed     Boolean?                  @default(false)
  is_locked        Boolean?                  @default(false)
  is_hidden_mobile Boolean?                  @default(false)
  config           Json?                     @default("{}")
  widget_type      String?                   @db.VarChar(100)
  widget_config    Json?                     @default("{}")
  display_order    Int?                      @default(0)
  created_at       DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?                 @default(now()) @updatedAt @db.Timestamptz(6)
  deleted_at       DateTime?                 @db.Timestamptz(6)
  version          Int                       @default(1)
  acls             DashboardRegionAcl[]
  presences        DashboardRegionPresence[]
  layout           DashboardLayout           @relation(fields: [layout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([config], map: "idx_dashboard_regions_config", type: Gin)
  @@index([display_order], map: "idx_dashboard_regions_display_order")
  @@index([grid_row, grid_col], map: "idx_dashboard_regions_grid_position")
  @@index([layout_id], map: "idx_dashboard_regions_layout_id")
  @@index([layout_id, tenant_id, user_id], map: "idx_dashboard_regions_layout_tenant_user")
  @@index([tenant_id], map: "idx_dashboard_regions_tenant_id")
  @@index([user_id], map: "idx_dashboard_regions_user_id")
  @@index([id, version], map: "idx_dashboard_regions_version")
  @@index([widget_config], map: "idx_dashboard_regions_widget_config", type: Gin)
  @@map("dashboard_regions")
  @@schema("public")
}

model DashboardLayoutVersion {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  layout_id      String          @db.Uuid
  version_number Int
  status         String          @db.VarChar(20)
  created_by     String          @db.Uuid
  created_at     DateTime?       @default(now()) @db.Timestamptz(6)
  payload        Json
  diff           Json?
  notes          String?
  tenant_id      String          @db.Uuid
  layout         DashboardLayout @relation(fields: [layout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([layout_id, version_number])
  @@index([created_at(sort: Desc)], map: "idx_layout_versions_created_at")
  @@index([diff], map: "idx_layout_versions_diff", type: Gin)
  @@index([layout_id], map: "idx_layout_versions_layout_id")
  @@index([payload], map: "idx_layout_versions_payload", type: Gin)
  @@index([status], map: "idx_layout_versions_status")
  @@index([tenant_id], map: "idx_layout_versions_tenant_id")
  @@map("dashboard_layout_versions")
  @@schema("public")
}

model DashboardRegionAcl {
  id             String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  region_id      String          @db.Uuid
  principal_type String          @db.VarChar(20)
  principal_id   String          @db.Uuid
  permission_set Json            @default("{\"edit\": false, \"read\": true, \"share\": false}")
  tenant_id      String          @db.Uuid
  created_at     DateTime?       @default(now()) @db.Timestamptz(6)
  region         DashboardRegion @relation(fields: [region_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([region_id, principal_type, principal_id])
  @@index([permission_set], map: "idx_region_acls_permission_set", type: Gin)
  @@index([principal_type, principal_id], map: "idx_region_acls_principal")
  @@index([region_id], map: "idx_region_acls_region_id")
  @@index([tenant_id], map: "idx_region_acls_tenant_id")
  @@map("dashboard_region_acls")
  @@schema("public")
}

model DashboardWidgetRegistry {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  widget_id       String    @unique @db.VarChar(100)
  manifest        Json
  signature       String?
  allowed_tenants String[]  @db.Uuid
  is_public       Boolean?  @default(false)
  is_approved     Boolean?  @default(false)
  created_by      String?   @db.Uuid
  created_at      DateTime? @default(now()) @db.Timestamptz(6)
  updated_at      DateTime? @default(now()) @updatedAt @db.Timestamptz(6)

  @@index([allowed_tenants], map: "idx_widget_registry_allowed_tenants", type: Gin)
  @@index([manifest], map: "idx_widget_registry_manifest", type: Gin)
  @@index([widget_id], map: "idx_widget_registry_widget_id")
  @@map("dashboard_widget_registry")
  @@schema("public")
}

model DashboardMigrationLog {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id           String    @db.Uuid
  layout_id         String    @db.Uuid
  migration_payload Json
  status            String    @db.VarChar(20)
  errors            Json?
  created_at        DateTime? @default(now()) @db.Timestamptz(6)
  tenant_id         String    @db.Uuid

  @@index([created_at(sort: Desc)], map: "idx_migration_logs_created_at")
  @@index([layout_id], map: "idx_migration_logs_layout_id")
  @@index([migration_payload], map: "idx_migration_logs_payload", type: Gin)
  @@index([status], map: "idx_migration_logs_status")
  @@index([tenant_id], map: "idx_migration_logs_tenant_id")
  @@index([user_id], map: "idx_migration_logs_user_id")
  @@map("dashboard_migration_logs")
  @@schema("public")
}

model DashboardRegionPresence {
  id         String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  region_id  String          @db.Uuid
  user_id    String          @db.Uuid
  session_id String          @db.VarChar(255)
  is_editing Boolean?        @default(false)
  last_seen  DateTime?       @default(now()) @db.Timestamptz(6)
  tenant_id  String          @db.Uuid
  region     DashboardRegion @relation(fields: [region_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([region_id, user_id, session_id])
  @@index([last_seen], map: "idx_region_presence_last_seen")
  @@index([region_id], map: "idx_region_presence_region_id")
  @@index([tenant_id], map: "idx_region_presence_tenant_id")
  @@index([user_id], map: "idx_region_presence_user_id")
  @@map("dashboard_region_presence")
  @@schema("public")
}

model DashboardLayoutAudit {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  layout_id  String    @db.Uuid
  user_id    String    @db.Uuid
  action     String    @db.VarChar(50)
  changes    Json?
  metadata   Json?
  tenant_id  String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)

  @@index([action], map: "idx_layout_audit_action")
  @@index([changes], map: "idx_layout_audit_changes", type: Gin)
  @@index([created_at(sort: Desc)], map: "idx_layout_audit_created_at")
  @@index([layout_id], map: "idx_layout_audit_layout_id")
  @@index([metadata], map: "idx_layout_audit_metadata", type: Gin)
  @@index([tenant_id], map: "idx_layout_audit_tenant_id")
  @@index([user_id], map: "idx_layout_audit_user_id")
  @@map("dashboard_layout_audit")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model audit_log_entries {
  instance_id String?   @db.Uuid
  id          String    @id @db.Uuid
  payload     Json?     @db.Json
  created_at  DateTime? @db.Timestamptz(6)
  ip_address  String    @default("") @db.VarChar(64)

  @@index([instance_id], map: "audit_logs_instance_id_idx")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model flow_state {
  id                     String                @id @db.Uuid
  user_id                String?               @db.Uuid
  auth_code              String
  code_challenge_method  code_challenge_method
  code_challenge         String
  provider_type          String
  provider_access_token  String?
  provider_refresh_token String?
  created_at             DateTime?             @db.Timestamptz(6)
  updated_at             DateTime?             @db.Timestamptz(6)
  authentication_method  String
  auth_code_issued_at    DateTime?             @db.Timestamptz(6)
  saml_relay_states      saml_relay_states[]

  @@index([created_at(sort: Desc)])
  @@index([auth_code], map: "idx_auth_code")
  @@index([user_id, authentication_method], map: "idx_user_id_auth_method")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model identities {
  provider_id     String
  user_id         String    @db.Uuid
  identity_data   Json
  provider        String
  last_sign_in_at DateTime? @db.Timestamptz(6)
  created_at      DateTime? @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)
  email           String?   @default(dbgenerated("lower((identity_data ->> 'email'::text))"))
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  users           users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider_id, provider], map: "identities_provider_id_provider_unique")
  @@index([email])
  @@index([user_id])
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model instances {
  id              String    @id @db.Uuid
  uuid            String?   @db.Uuid
  raw_base_config String?
  created_at      DateTime? @db.Timestamptz(6)
  updated_at      DateTime? @db.Timestamptz(6)

  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_amr_claims {
  session_id            String   @db.Uuid
  created_at            DateTime @db.Timestamptz(6)
  updated_at            DateTime @db.Timestamptz(6)
  authentication_method String
  id                    String   @id(map: "amr_id_pk") @db.Uuid
  sessions              sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([session_id, authentication_method], map: "mfa_amr_claims_session_id_authentication_method_pkey")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_challenges {
  id                     String      @id @db.Uuid
  factor_id              String      @db.Uuid
  created_at             DateTime    @db.Timestamptz(6)
  verified_at            DateTime?   @db.Timestamptz(6)
  ip_address             String      @db.Inet
  otp_code               String?
  web_authn_session_data Json?
  mfa_factors            mfa_factors @relation(fields: [factor_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "mfa_challenges_auth_factor_id_fkey")

  @@index([created_at(sort: Desc)], map: "mfa_challenge_created_at_idx")
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model mfa_factors {
  id                           String           @id @db.Uuid
  user_id                      String           @db.Uuid
  friendly_name                String?
  factor_type                  factor_type
  status                       factor_status
  created_at                   DateTime         @db.Timestamptz(6)
  updated_at                   DateTime         @db.Timestamptz(6)
  secret                       String?
  phone                        String?
  last_challenged_at           DateTime?        @unique @db.Timestamptz(6)
  web_authn_credential         Json?
  web_authn_aaguid             String?          @db.Uuid
  last_webauthn_challenge_data Json?
  mfa_challenges               mfa_challenges[]
  users                        users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, phone], map: "unique_phone_factor_per_user")
  @@index([user_id, created_at], map: "factor_id_created_at_idx")
  @@index([user_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_authorizations {
  id                    String                     @id @db.Uuid
  authorization_id      String                     @unique
  client_id             String                     @db.Uuid
  user_id               String?                    @db.Uuid
  redirect_uri          String
  scope                 String
  state                 String?
  resource              String?
  code_challenge        String?
  code_challenge_method code_challenge_method?
  response_type         oauth_response_type        @default(code)
  status                oauth_authorization_status @default(pending)
  authorization_code    String?                    @unique
  created_at            DateTime                   @default(now()) @db.Timestamptz(6)
  expires_at            DateTime                   @default(dbgenerated("(now() + '00:03:00'::interval)")) @db.Timestamptz(6)
  approved_at           DateTime?                  @db.Timestamptz(6)
  oauth_clients         oauth_clients              @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                 users?                     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_clients {
  id                   String                  @id @db.Uuid
  client_secret_hash   String?
  registration_type    oauth_registration_type
  redirect_uris        String
  grant_types          String
  client_name          String?
  client_uri           String?
  logo_uri             String?
  created_at           DateTime                @default(now()) @db.Timestamptz(6)
  updated_at           DateTime                @default(now()) @db.Timestamptz(6)
  deleted_at           DateTime?               @db.Timestamptz(6)
  client_type          oauth_client_type       @default(confidential)
  oauth_authorizations oauth_authorizations[]
  oauth_consents       oauth_consents[]
  sessions             sessions[]

  @@index([deleted_at])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model oauth_consents {
  id            String        @id @db.Uuid
  user_id       String        @db.Uuid
  client_id     String        @db.Uuid
  scopes        String
  granted_at    DateTime      @default(now()) @db.Timestamptz(6)
  revoked_at    DateTime?     @db.Timestamptz(6)
  oauth_clients oauth_clients @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users         @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, client_id], map: "oauth_consents_user_client_unique")
  @@index([user_id, granted_at(sort: Desc)], map: "oauth_consents_user_order_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model one_time_tokens {
  id         String              @id @db.Uuid
  user_id    String              @db.Uuid
  token_type one_time_token_type
  token_hash String
  relates_to String
  created_at DateTime            @default(now()) @db.Timestamp(6)
  updated_at DateTime            @default(now()) @db.Timestamp(6)
  users      users               @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, token_type])
  @@index([relates_to], map: "one_time_tokens_relates_to_hash_idx", type: Hash)
  @@index([token_hash], map: "one_time_tokens_token_hash_hash_idx", type: Hash)
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model refresh_tokens {
  instance_id String?   @db.Uuid
  id          BigInt    @id @default(autoincrement())
  token       String?   @unique(map: "refresh_tokens_token_unique") @db.VarChar(255)
  user_id     String?   @db.VarChar(255)
  revoked     Boolean?
  created_at  DateTime? @db.Timestamptz(6)
  updated_at  DateTime? @db.Timestamptz(6)
  parent      String?   @db.VarChar(255)
  session_id  String?   @db.Uuid
  sessions    sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([instance_id])
  @@index([instance_id, user_id])
  @@index([parent])
  @@index([session_id, revoked])
  @@index([updated_at(sort: Desc)])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saml_providers {
  id                String        @id @db.Uuid
  sso_provider_id   String        @db.Uuid
  entity_id         String        @unique
  metadata_xml      String
  metadata_url      String?
  attribute_mapping Json?
  created_at        DateTime?     @db.Timestamptz(6)
  updated_at        DateTime?     @db.Timestamptz(6)
  name_id_format    String?
  sso_providers     sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sso_provider_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saml_relay_states {
  id              String        @id @db.Uuid
  sso_provider_id String        @db.Uuid
  request_id      String
  for_email       String?
  redirect_to     String?
  created_at      DateTime?     @db.Timestamptz(6)
  updated_at      DateTime?     @db.Timestamptz(6)
  flow_state_id   String?       @db.Uuid
  flow_state      flow_state?   @relation(fields: [flow_state_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sso_providers   sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)])
  @@index([for_email])
  @@index([sso_provider_id])
  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model schema_migrations {
  version String @id @db.VarChar(255)

  @@schema("auth")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sessions {
  id                     String           @id @db.Uuid
  user_id                String           @db.Uuid
  created_at             DateTime?        @db.Timestamptz(6)
  updated_at             DateTime?        @db.Timestamptz(6)
  factor_id              String?          @db.Uuid
  aal                    aal_level?
  not_after              DateTime?        @db.Timestamptz(6)
  refreshed_at           DateTime?        @db.Timestamp(6)
  user_agent             String?
  ip                     String?          @db.Inet
  tag                    String?
  oauth_client_id        String?          @db.Uuid
  refresh_token_hmac_key String?
  refresh_token_counter  BigInt?
  mfa_amr_claims         mfa_amr_claims[]
  refresh_tokens         refresh_tokens[]
  oauth_clients          oauth_clients?   @relation(fields: [oauth_client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                  users            @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([not_after(sort: Desc)])
  @@index([oauth_client_id])
  @@index([user_id])
  @@index([user_id, created_at], map: "user_id_created_at_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model sso_domains {
  id              String        @id @db.Uuid
  sso_provider_id String        @db.Uuid
  domain          String
  created_at      DateTime?     @db.Timestamptz(6)
  updated_at      DateTime?     @db.Timestamptz(6)
  sso_providers   sso_providers @relation(fields: [sso_provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([sso_provider_id])
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model sso_providers {
  id                String              @id @db.Uuid
  resource_id       String?
  created_at        DateTime?           @db.Timestamptz(6)
  updated_at        DateTime?           @db.Timestamptz(6)
  disabled          Boolean?
  saml_providers    saml_providers[]
  saml_relay_states saml_relay_states[]
  sso_domains       sso_domains[]

  @@index([resource_id], map: "sso_providers_resource_id_pattern_idx")
  @@schema("auth")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  instance_id                 String?                @db.Uuid
  id                          String                 @id @db.Uuid
  aud                         String?                @db.VarChar(255)
  role                        String?                @db.VarChar(255)
  email                       String?                @db.VarChar(255)
  encrypted_password          String?                @db.VarChar(255)
  email_confirmed_at          DateTime?              @db.Timestamptz(6)
  invited_at                  DateTime?              @db.Timestamptz(6)
  confirmation_token          String?                @db.VarChar(255)
  confirmation_sent_at        DateTime?              @db.Timestamptz(6)
  recovery_token              String?                @db.VarChar(255)
  recovery_sent_at            DateTime?              @db.Timestamptz(6)
  email_change_token_new      String?                @db.VarChar(255)
  email_change                String?                @db.VarChar(255)
  email_change_sent_at        DateTime?              @db.Timestamptz(6)
  last_sign_in_at             DateTime?              @db.Timestamptz(6)
  raw_app_meta_data           Json?
  raw_user_meta_data          Json?
  is_super_admin              Boolean?
  created_at                  DateTime?              @db.Timestamptz(6)
  updated_at                  DateTime?              @db.Timestamptz(6)
  phone                       String?                @unique
  phone_confirmed_at          DateTime?              @db.Timestamptz(6)
  phone_change                String?                @default("")
  phone_change_token          String?                @default("") @db.VarChar(255)
  phone_change_sent_at        DateTime?              @db.Timestamptz(6)
  confirmed_at                DateTime?              @default(dbgenerated("LEAST(email_confirmed_at, phone_confirmed_at)")) @db.Timestamptz(6)
  email_change_token_current  String?                @default("") @db.VarChar(255)
  email_change_confirm_status Int?                   @default(0) @db.SmallInt
  banned_until                DateTime?              @db.Timestamptz(6)
  reauthentication_token      String?                @default("") @db.VarChar(255)
  reauthentication_sent_at    DateTime?              @db.Timestamptz(6)
  is_sso_user                 Boolean                @default(false)
  deleted_at                  DateTime?              @db.Timestamptz(6)
  is_anonymous                Boolean                @default(false)
  identities                  identities[]
  mfa_factors                 mfa_factors[]
  oauth_authorizations        oauth_authorizations[]
  oauth_consents              oauth_consents[]
  one_time_tokens             one_time_tokens[]
  sessions                    sessions[]
  saved_layouts               saved_layouts[]
  search_user_behavior        search_user_behavior[]

  @@index([instance_id])
  @@index([is_anonymous])
  @@schema("auth")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model customers {
  id           String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id    String    @db.Uuid
  first_name   String
  last_name    String
  email        String?
  phone        String?
  address      String?
  city         String?
  state        String?
  zip_code     String?
  country      String?   @default("USA")
  status       String?   @default("active")
  account_type String?   @default("residential")
  notes        String?
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  created_by   String?   @db.Uuid
  updated_by   String?   @db.Uuid

  @@index([address(ops: raw("gin_trgm_ops"))], map: "idx_customers_address", type: Gin)
  @@index([email], map: "idx_customers_email")
  @@index([phone], map: "idx_customers_phone")
  @@index([tenant_id], map: "idx_customers_tenant_id")
  @@index([tenant_id, first_name, last_name, email, phone, address], map: "idx_customers_tenant_search")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model dashboard_cards {
  id                String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id         String          @db.Uuid
  user_id           String?         @db.Uuid
  layout_id         String          @db.Uuid
  card_uid          String
  type              String
  x                 Int             @default(0)
  y                 Int             @default(0)
  width             Int             @default(300)
  height            Int             @default(200)
  config            Json            @default("{}")
  user_kpi_id       String?         @db.Uuid
  template_id       String?         @db.Uuid
  is_active         Boolean         @default(true)
  created_at        DateTime        @default(now()) @db.Timestamptz(6)
  updated_at        DateTime        @default(now()) @db.Timestamptz(6)
  deleted_at        DateTime?       @db.Timestamptz(6)
  dashboard_layouts DashboardLayout @relation(fields: [layout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  kpi_templates     KpiTemplate?    @relation(fields: [template_id], references: [id], onUpdate: NoAction)
  user_kpis         UserKpi?        @relation(fields: [user_kpi_id], references: [id], onUpdate: NoAction)

  @@index([layout_id], map: "idx_dashboard_cards_layout")
  @@index([template_id], map: "idx_dashboard_cards_template")
  @@index([tenant_id], map: "idx_dashboard_cards_tenant")
  @@index([type], map: "idx_dashboard_cards_type")
  @@index([user_id], map: "idx_dashboard_cards_user")
  @@index([user_kpi_id], map: "idx_dashboard_cards_user_kpi")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model dashboard_events {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  event_type  String   @db.VarChar(100)
  entity_type String   @db.VarChar(50)
  entity_id   String   @db.Uuid
  tenant_id   String   @db.Uuid
  user_id     String   @db.Uuid
  payload     Json     @default("{}")
  metadata    Json?    @default("{}")
  timestamp   DateTime @default(now()) @db.Timestamptz(6)
  version     Int?     @default(1)
  created_at  DateTime @default(now()) @db.Timestamptz(6)

  @@index([entity_type, entity_id, tenant_id], map: "idx_dashboard_events_entity")
  @@index([tenant_id, timestamp(sort: Desc)], map: "idx_dashboard_events_tenant")
  @@index([timestamp(sort: Desc)], map: "idx_dashboard_events_timestamp")
  @@index([event_type, timestamp(sort: Desc)], map: "idx_dashboard_events_type")
  @@index([user_id, tenant_id, timestamp(sort: Desc)], map: "idx_dashboard_events_user")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model dashboard_templates {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String    @db.VarChar(255)
  description String?
  thumbnail   String?
  tenant_id   String    @db.Uuid
  user_id     String    @db.Uuid
  is_system   Boolean?  @default(false)
  is_public   Boolean?  @default(false)
  regions     Json      @default("[]")
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
  updated_at  DateTime? @default(now()) @db.Timestamptz(6)
  deleted_at  DateTime? @db.Timestamptz(6)

  @@index([created_at(sort: Desc)], map: "idx_dashboard_templates_created_at")
  @@index([tenant_id], map: "idx_dashboard_templates_tenant_id")
  @@index([user_id], map: "idx_dashboard_templates_user_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model idempotency_keys {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  idempotency_key String   @db.VarChar(255)
  user_id         String   @db.Uuid
  tenant_id       String   @db.Uuid
  response_data   Json
  status_code     Int      @default(200)
  created_at      DateTime @default(now()) @db.Timestamptz(6)

  @@unique([idempotency_key, user_id, tenant_id], map: "idempotency_keys_unique")
  @@index([created_at], map: "idx_idempotency_keys_created_at")
  @@index([idempotency_key, user_id, tenant_id], map: "idx_idempotency_keys_lookup")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model kpi_configs {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String     @db.VarChar(255)
  description String?
  category    String     @db.VarChar(50)
  threshold   Json
  drill_down  Json?
  real_time   Boolean?   @default(false)
  enabled     Boolean?   @default(true)
  tags        String[]   @default([])
  tenant_id   String     @db.Uuid
  user_id     String     @db.Uuid
  created_at  DateTime?  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?  @default(now()) @db.Timestamptz(6)
  kpi_data    kpi_data[]

  @@index([category], map: "idx_kpi_configs_category")
  @@index([created_at], map: "idx_kpi_configs_created_at")
  @@index([enabled], map: "idx_kpi_configs_enabled")
  @@index([tenant_id], map: "idx_kpi_configs_tenant_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model kpi_data {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  kpi_id      String?      @db.Uuid
  metric      String       @db.VarChar(255)
  value       Decimal      @db.Decimal(15, 4)
  timestamp   DateTime?    @default(now()) @db.Timestamptz(6)
  metadata    Json?
  tenant_id   String       @db.Uuid
  created_at  DateTime?    @default(now()) @db.Timestamptz(6)
  kpi_configs kpi_configs? @relation(fields: [kpi_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([kpi_id], map: "idx_kpi_data_kpi_id")
  @@index([metric], map: "idx_kpi_data_metric")
  @@index([metric, timestamp], map: "idx_kpi_data_metric_timestamp")
  @@index([tenant_id], map: "idx_kpi_data_tenant_id")
  @@index([timestamp], map: "idx_kpi_data_timestamp")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leads {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  first_name     String
  last_name      String
  email          String
  phone          String?
  company        String?
  message        String?
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)
  user_timezone  String?
  user_timestamp DateTime? @db.Timestamptz(6)

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recurring_job_instances {
  id                      String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id               String                  @db.Uuid
  recurring_template_id   String                  @db.Uuid
  job_id                  String                  @db.Uuid
  scheduled_date          DateTime                @db.Date
  occurrence_number       Int
  is_exception            Boolean?                @default(false)
  exception_type          String?                 @db.VarChar(50)
  exception_notes         String?
  created_at              DateTime                @default(now()) @db.Timestamptz(6)
  updated_at              DateTime                @default(now()) @db.Timestamptz(6)
  jobs                    Job                     @relation(fields: [job_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recurring_job_templates recurring_job_templates @relation(fields: [recurring_template_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants                 Tenant                  @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, job_id])
  @@unique([tenant_id, recurring_template_id, scheduled_date])
  @@index([scheduled_date], map: "idx_recurring_instances_date")
  @@index([tenant_id, job_id], map: "idx_recurring_instances_job")
  @@index([tenant_id, recurring_template_id], map: "idx_recurring_instances_template")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recurring_job_templates {
  id                          String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                   String                    @db.Uuid
  name                        String                    @db.VarChar(255)
  description                 String?
  recurrence_type             String                    @db.VarChar(50)
  recurrence_interval         Int?                      @default(1)
  recurrence_days_of_week     Int[]
  recurrence_day_of_month     Int?
  recurrence_weekday_of_month String?                   @db.VarChar(20)
  start_time                  DateTime                  @db.Time(6)
  end_time                    DateTime?                 @db.Time(6)
  estimated_duration          Int?
  start_date                  DateTime                  @db.Date
  end_date                    DateTime?                 @db.Date
  max_occurrences             Int?
  job_template                Json
  is_active                   Boolean?                  @default(true)
  last_generated_date         DateTime?                 @db.Date
  created_at                  DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime                  @default(now()) @db.Timestamptz(6)
  created_by                  String?                   @db.Uuid
  jobs                        Job[]
  recurring_job_instances     recurring_job_instances[]
  users                       User?                     @relation(fields: [created_by], references: [id], onUpdate: NoAction)
  tenants                     Tenant                    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model saved_layouts {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String    @db.VarChar(255)
  description  String?
  storage_path String
  file_size    BigInt?
  user_id      String    @db.Uuid
  tenant_id    String    @db.Uuid
  is_public    Boolean?  @default(false)
  tags         String[]  @default([])
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  updated_at   DateTime? @default(now()) @db.Timestamptz(6)
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at], map: "idx_saved_layouts_created_at")
  @@index([is_public], map: "idx_saved_layouts_is_public")
  @@index([storage_path], map: "idx_saved_layouts_storage_path")
  @@index([tags], map: "idx_saved_layouts_tags", type: Gin)
  @@index([tenant_id], map: "idx_saved_layouts_tenant_id")
  @@index([updated_at], map: "idx_saved_layouts_updated_at")
  @@index([user_id], map: "idx_saved_layouts_user_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model search_errors {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id     String?   @db.Uuid
  user_id       String?   @db.Uuid
  error_type    String
  error_message String
  error_stack   String?
  query_text    String?
  user_agent    String?
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  is_resolved   Boolean?  @default(false)
  resolved_at   DateTime? @db.Timestamptz(6)
  operation     String?
  severity      String?
  context       Json?
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)

  @@index([created_at], map: "idx_search_errors_created_at")
  @@index([tenant_id], map: "idx_search_errors_tenant_id")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model search_logs {
  id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id        String    @db.Uuid
  user_id          String?   @db.Uuid
  query_text       String
  result_count     Int?      @default(0)
  response_time_ms Int?
  search_type      String?
  created_at       DateTime? @default(now()) @db.Timestamptz(6)

  @@index([created_at], map: "idx_search_logs_created_at")
  @@index([tenant_id], map: "idx_search_logs_tenant_id")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model search_user_behavior {
  id                         String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  tenant_id                  String    @db.Uuid
  user_id                    String    @db.Uuid
  preferred_search_mode      String?   @db.VarChar(50)
  preferred_result_count     Int?
  avg_session_searches       Decimal   @default(0) @db.Decimal(5, 2)
  most_common_queries        String[]
  search_time_preferences    Int[]
  avg_query_length           Decimal   @default(0) @db.Decimal(5, 2)
  total_searches             Int       @default(0)
  successful_searches        Int       @default(0)
  avg_time_to_click_ms       Decimal   @default(0) @db.Decimal(10, 2)
  click_through_rate         Decimal   @default(0.0) @db.Decimal(5, 4)
  accepts_suggestions        Boolean   @default(false)
  suggestion_acceptance_rate Decimal   @default(0.0) @db.Decimal(5, 4)
  learns_from_corrections    Boolean   @default(false)
  avg_search_success_rate    Decimal   @default(1.0) @db.Decimal(5, 4)
  last_search_at             DateTime? @db.Timestamptz(6)
  created_at                 DateTime? @default(now()) @db.Timestamptz(6)
  updated_at                 DateTime? @default(now()) @db.Timestamptz(6)
  tenants                    Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_search_user_behavior_tenant")
  users                      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_search_user_behavior_user")

  @@unique([tenant_id, user_id])
  @@index([tenant_id], map: "idx_search_user_behavior_tenant")
  @@index([tenant_id, user_id], map: "idx_search_user_behavior_user")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model technician_availability {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String   @db.Uuid
  technician_id String   @db.Uuid
  day_of_week   Int
  start_time    DateTime @db.Time(6)
  end_time      DateTime @db.Time(6)
  is_active     Boolean? @default(true)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @default(now()) @db.Timestamptz(6)
  users         User     @relation(fields: [technician_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants       Tenant   @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, technician_id, day_of_week])
  @@index([tenant_id, technician_id], map: "idx_technician_availability_tenant_tech")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model technician_schedules {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String    @db.Uuid
  technician_id String    @db.Uuid
  schedule_date DateTime  @db.Date
  start_time    DateTime? @db.Time(6)
  end_time      DateTime? @db.Time(6)
  is_available  Boolean?  @default(true)
  notes         String?
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at    DateTime  @default(now()) @db.Timestamptz(6)
  users         User      @relation(fields: [technician_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants       Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tenant_id, technician_id, schedule_date])
  @@index([tenant_id, technician_id, schedule_date], map: "idx_technician_schedules_tenant_tech_date")
  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model time_off_requests {
  id                                           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                                    String    @db.Uuid
  technician_id                                String    @db.Uuid
  start_date                                   DateTime  @db.Date
  end_date                                     DateTime  @db.Date
  request_type                                 String    @default("pto") @db.VarChar(50)
  status                                       String    @default("pending") @db.VarChar(20)
  reason                                       String?
  requested_by                                 String?   @db.Uuid
  approved_by                                  String?   @db.Uuid
  approved_at                                  DateTime? @db.Timestamptz(6)
  created_at                                   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                                   DateTime  @default(now()) @db.Timestamptz(6)
  users_time_off_requests_approved_byTousers   User?     @relation("time_off_requests_approved_byTousers", fields: [approved_by], references: [id], onUpdate: NoAction)
  users_time_off_requests_requested_byTousers  User?     @relation("time_off_requests_requested_byTousers", fields: [requested_by], references: [id], onUpdate: NoAction)
  users_time_off_requests_technician_idTousers User      @relation("time_off_requests_technician_idTousers", fields: [technician_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tenants                                      Tenant    @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenant_id, status], map: "idx_time_off_requests_status")
  @@index([tenant_id, technician_id], map: "idx_time_off_requests_tenant_tech")
  @@schema("public")
}

enum BillingFrequency {
  monthly
  quarterly
  annually
  one_time

  @@schema("public")
}

enum InvoiceStatus {
  draft
  sent
  paid
  overdue
  cancelled

  @@schema("public")
}

// Compliance Schema Models (Phase 3)
model RuleDefinition {
  id          String   @id @db.VarChar(10)
  name        String   @db.VarChar(255)
  description String?
  tier        String   @db.VarChar(20)
  category    String?  @db.VarChar(100)
  file_path   String?  @db.VarChar(500)
  opa_policy  String?  @db.VarChar(255)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @default(now()) @updatedAt @db.Timestamptz(6)

  complianceChecks ComplianceCheck[]
  complianceTrends ComplianceTrend[]

  @@map("rule_definitions")
  @@schema("compliance")
}

model ComplianceCheck {
  id                  String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id           String          @db.Uuid
  pr_number           Int
  commit_sha          String          @db.VarChar(40)
  rule_id             String          @db.VarChar(10)
  status              String          @db.VarChar(20)
  severity            String          @db.VarChar(20)
  file_path           String?         @db.VarChar(500)
  line_number         Int?
  violation_message   String?
  context             Json?
  created_at          DateTime        @default(now()) @db.Timestamptz(6)
  resolved_at        DateTime?       @db.Timestamptz(6)
  resolved_by         String?         @db.Uuid
  override_reason     String?
  override_approved_by String?        @db.Uuid

  rule                RuleDefinition @relation(fields: [rule_id], references: [id], onDelete: Restrict, onUpdate: Cascade)
  tenant              Tenant          @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  overrideRequests    OverrideRequest[]
  alertHistory        AlertHistory[]

  @@index([tenant_id])
  @@index([pr_number])
  @@index([rule_id])
  @@index([status])
  @@index([severity])
  @@index([created_at(sort: Desc)])
  @@index([tenant_id, pr_number])
  @@index([tenant_id, rule_id])
  @@index([tenant_id, status])
  // Note: Partial indexes (idx_checks_unresolved, idx_checks_tenant_unresolved) 
  // are created in migration SQL but not supported in Prisma schema
  @@map("compliance_checks")
  @@schema("compliance")
}

model ComplianceTrend {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String          @db.Uuid
  date            DateTime        @db.Date
  rule_id         String?         @db.VarChar(10)
  violation_count Int             @default(0)
  compliance_rate Decimal?        @db.Decimal(5, 2)
  created_at      DateTime        @default(now()) @db.Timestamptz(6)

  rule            RuleDefinition? @relation(fields: [rule_id], references: [id], onDelete: SetNull, onUpdate: Cascade)
  tenant          Tenant          @relation(fields: [tenant_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([tenant_id, date, rule_id], map: "compliance_trends_tenant_id_date_rule_id_key")
  @@index([tenant_id, date(sort: Desc)], map: "idx_trends_tenant_date")
  @@index([rule_id], map: "idx_trends_rule")
  @@map("compliance_trends")
  @@schema("compliance")
}

model OverrideRequest {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String          @db.Uuid
  violation_id    String          @db.Uuid
  requested_by    String          @db.Uuid
  requested_at    DateTime        @default(now()) @db.Timestamptz(6)
  reason          String
  status          String          @db.VarChar(20)
  approved_by     String?         @db.Uuid
  approved_at     DateTime?       @db.Timestamptz(6)
  rejection_reason String?

  violation       ComplianceCheck @relation(fields: [violation_id], references: [id], onDelete: Cascade)

  @@index([tenant_id, status], map: "idx_override_tenant_status")
  @@index([violation_id], map: "idx_override_violation")
  @@map("override_requests")
  @@schema("compliance")
}

model AlertHistory {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id       String          @db.Uuid
  violation_id    String          @db.Uuid
  alert_type      String          @db.VarChar(50)
  sent_at         DateTime        @default(now()) @db.Timestamptz(6)
  acknowledged_at DateTime?       @db.Timestamptz(6)
  acknowledged_by String?         @db.Uuid
  status          String          @db.VarChar(20)
  delivery_error  String?

  violation       ComplianceCheck @relation(fields: [violation_id], references: [id], onDelete: Cascade)

  @@index([violation_id], map: "idx_alert_violation")
  @@index([status], map: "idx_alert_status")
  // Note: Partial index filter is created in migration SQL but not supported in Prisma schema
  @@map("alert_history")
  @@schema("compliance")
}

model ComplianceAuditLog {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id     String   @db.Uuid
  user_id       String   @db.Uuid
  action        String   @db.VarChar(100)
  resource_type String?  @db.VarChar(50)
  resource_id   String?  @db.Uuid
  before_state  Json?
  after_state   Json?
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  @@index([tenant_id], map: "idx_audit_tenant")
  @@index([user_id], map: "idx_audit_user")
  @@index([created_at(sort: Desc)], map: "idx_audit_created")
  @@map("audit_log")
  @@schema("compliance")
}

model WriteQueue {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  job_type      String   @db.VarChar(50)
  job_data      Json
  status        String   @default("pending") @db.VarChar(20)
  attempts      Int      @default(0)
  max_attempts  Int      @default(3)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  processed_at  DateTime? @db.Timestamptz(6)
  error_message String?

  @@index([status, created_at], map: "idx_write_queue_status")
  @@map("write_queue")
  @@schema("compliance")
}

// VeroScore V3 Schema Models (Phase 1)
model VeroScoreSession {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id            String    @unique
  author                String
  branch_name           String?
  started               DateTime  @default(now()) @db.Timestamptz(6)
  last_activity         DateTime  @default(now()) @db.Timestamptz(6)
  completed_at          DateTime? @db.Timestamptz(6)
  total_files           Int       @default(0)
  total_lines_added     Int       @default(0)
  total_lines_removed   Int       @default(0)
  prs                   Json      @default("[]")
  status                String    @default("active") @db.VarChar(20)
  reward_score_eligible Boolean   @default(false)
  last_reward_score     Decimal?  @db.Decimal(5, 2)
  reward_scored_at      DateTime? @db.Timestamptz(6)
  config                Json      @default("{}")
  metadata              Json      @default("{}")
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  updated_at            DateTime  @default(now()) @updatedAt @db.Timestamptz(6)

  changesQueue          VeroScoreChangesQueue[]
  prScores              VeroScorePrScore[]

  @@index([author], map: "idx_veroscore_sessions_author")
  @@index([status], map: "idx_veroscore_sessions_status")
  @@index([last_activity], map: "idx_veroscore_sessions_last_activity")
  @@index([reward_score_eligible], map: "idx_veroscore_sessions_reward_eligible")
  @@map("sessions")
  @@schema("veroscore")
}

model VeroScoreChangesQueue {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id  String
  file_path   String
  change_type String          @db.VarChar(20)
  old_path    String?
  lines_added Int             @default(0)
  lines_removed Int           @default(0)
  commit_hash String?
  processed   Boolean         @default(false)
  processed_at DateTime?      @db.Timestamptz(6)
  metadata    Json            @default("{}")
  timestamp   DateTime        @default(now()) @db.Timestamptz(6)

  session     VeroScoreSession @relation(fields: [session_id], references: [session_id], onDelete: Cascade)

  @@index([session_id], map: "idx_veroscore_changes_session")
  @@index([processed], map: "idx_veroscore_changes_processed")
  @@index([timestamp(sort: Desc)], map: "idx_veroscore_changes_timestamp")
  @@map("changes_queue")
  @@schema("veroscore")
}

model VeroScorePrScore {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pr_number               Int
  repository              String
  session_id              String?
  author                  String
  code_quality            Decimal   @default(0) @db.Decimal(4, 2)
  test_coverage           Decimal   @default(0) @db.Decimal(4, 2)
  documentation           Decimal   @default(0) @db.Decimal(4, 2)
  architecture            Decimal   @default(0) @db.Decimal(4, 2)
  security                Decimal   @default(0) @db.Decimal(4, 2)
  rule_compliance         Decimal   @default(0) @db.Decimal(5, 2)
  code_quality_weighted   Decimal?  @db.Decimal(5, 2)
  test_coverage_weighted  Decimal?  @db.Decimal(5, 2)
  documentation_weighted  Decimal?  @db.Decimal(5, 2)
  architecture_weighted  Decimal?  @db.Decimal(5, 2)
  security_weighted       Decimal?  @db.Decimal(5, 2)
  rule_compliance_weighted Decimal? @db.Decimal(5, 2)
  raw_score               Decimal   @db.Decimal(6, 2)
  stabilized_score        Decimal   @db.Decimal(5, 2)
  violations              Json      @default("[]")
  warnings                Json      @default("[]")
  pipeline_complete       Boolean   @default(false)
  pipeline_bonus          Decimal   @default(0) @db.Decimal(3, 2)
  decision                String?   @db.VarChar(20)
  decision_reason         String?
  reward_score            Decimal?  @db.Decimal(5, 2)
  reward_score_timestamp  DateTime? @db.Timestamptz(6)
  scan_duration_ms        Int?
  detector_versions       Json      @default("{}")
  created_at              DateTime  @default(now()) @db.Timestamptz(6)

  session                 VeroScoreSession? @relation(fields: [session_id], references: [session_id])
  detectionResults        VeroScoreDetectionResult[]

  @@unique([pr_number, repository, created_at], map: "veroscore_pr_scores_pr_number_repository_created_at_key")
  @@index([pr_number, repository], map: "idx_veroscore_pr_scores_pr")
  @@index([session_id], map: "idx_veroscore_pr_scores_session")
  @@index([decision], map: "idx_veroscore_pr_scores_decision")
  @@index([created_at(sort: Desc)], map: "idx_veroscore_pr_scores_created")
  @@map("pr_scores")
  @@schema("veroscore")
}

model VeroScoreDetectionResult {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  pr_score_id     String            @db.Uuid
  detector_name   String
  detector_version String?
  severity        String            @db.VarChar(20)
  rule_id         String?
  message         String
  file_path       String?
  line_number     Int?
  code_snippet    String?
  suggested_fix   String?
  penalty_applied Decimal           @default(0) @db.Decimal(5, 2)
  metadata        Json              @default("{}")
  created_at      DateTime          @default(now()) @db.Timestamptz(6)

  prScore         VeroScorePrScore  @relation(fields: [pr_score_id], references: [id], onDelete: Cascade)

  @@index([pr_score_id], map: "idx_veroscore_detection_pr_score")
  @@index([severity], map: "idx_veroscore_detection_severity")
  @@index([detector_name], map: "idx_veroscore_detection_detector")
  @@map("detection_results")
  @@schema("veroscore")
}

model VeroScoreIdempotencyKey {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  key           String    @unique
  operation_type String
  status        String    @db.VarChar(20)
  result        Json      @default("{}")
  expires_at    DateTime  @db.Timestamptz(6)
  created_at    DateTime  @default(now()) @db.Timestamptz(6)

  @@index([key], map: "idx_veroscore_idempotency_key")
  @@index([expires_at], map: "idx_veroscore_idempotency_expires")
  @@map("idempotency_keys")
  @@schema("veroscore")
}

model VeroScoreSystemMetric {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  metric_name  String
  metric_value Decimal   @db.Decimal
  metric_type  String    @db.VarChar(20)
  labels       Json      @default("{}")
  timestamp    DateTime  @default(now()) @db.Timestamptz(6)

  @@index([metric_name], map: "idx_veroscore_metrics_name")
  @@index([timestamp(sort: Desc)], map: "idx_veroscore_metrics_timestamp")
  @@map("system_metrics")
  @@schema("veroscore")
}

model VeroScoreAuditLog {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  event_type  String
  event_action String
  actor       String
  session_id  String?
  pr_number   Int?
  old_state   Json?
  new_state   Json?
  metadata    Json      @default("{}")
  timestamp    DateTime  @default(now()) @db.Timestamptz(6)

  @@index([event_type], map: "idx_veroscore_audit_type")
  @@index([actor], map: "idx_veroscore_audit_actor")
  @@index([timestamp(sort: Desc)], map: "idx_veroscore_audit_timestamp")
  @@map("audit_log")
  @@schema("veroscore")
}

enum ServiceAgreementStatus {
  active
  inactive
  expired
  cancelled

  @@schema("public")
}

enum aal_level {
  aal1
  aal2
  aal3

  @@schema("auth")
}

enum code_challenge_method {
  s256
  plain

  @@schema("auth")
}

enum factor_status {
  unverified
  verified

  @@schema("auth")
}

enum factor_type {
  totp
  webauthn
  phone

  @@schema("auth")
}

enum oauth_authorization_status {
  pending
  approved
  denied
  expired

  @@schema("auth")
}

enum oauth_client_type {
  public
  confidential

  @@schema("auth")
}

enum oauth_registration_type {
  dynamic
  manual

  @@schema("auth")
}

enum oauth_response_type {
  code

  @@schema("auth")
}

enum one_time_token_type {
  confirmation_token
  reauthentication_token
  recovery_token
  email_change_token_new
  email_change_token_current
  phone_change_token

  @@schema("auth")
}
