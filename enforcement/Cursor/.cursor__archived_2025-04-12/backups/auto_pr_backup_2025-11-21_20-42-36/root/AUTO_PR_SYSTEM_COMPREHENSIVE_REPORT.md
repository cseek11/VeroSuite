
# AUTO-PR SYSTEM COMPREHENSIVE ANALYSIS REPORT

**Generated:** 2025-11-19T16:28:48.509671

**Total PRs in Database:** 117

**Report Scope:** Last 40 PRs analyzed in detail


# 1. Recent Reward Score Samples (Last 40 PRs)

### Detailed Breakdown for Each PR

For each PR, the following information is provided:

- PR number

- Total Reward Score

- Score breakdown (tests, security, penalties, bug_fix, docs, performance)

- Test scores (1 or 0)

- Coverage numbers (backend/frontend)

- Penalties applied (which ones)

- Security score

- Whether CI actually failed (penalty -4)

- Whether test files were added

- Timestamp

#### PR #323 (Sample 1/40)

- **Timestamp:** `2025-11-19T18:19:44`
- **Total Score:** `1.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #319 (Sample 2/40)

- **Timestamp:** `2025-11-19T18:18:53`
- **Total Score:** `1.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `1.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `1`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #317 (Sample 3/40)

- **Timestamp:** `2025-11-19T18:18:51`
- **Total Score:** `0.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `1.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #324 (Sample 4/40)

- **Timestamp:** `2025-11-19T18:18:27`
- **Total Score:** `2.0`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `1.0`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #325 (Sample 5/40)

- **Timestamp:** `2025-11-19T18:18:15`
- **Total Score:** `3.0`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `1`
  - Docs: `1.0`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #320 (Sample 6/40)

- **Timestamp:** `2025-11-19T18:17:38`
- **Total Score:** `1.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #321 (Sample 7/40)

- **Timestamp:** `2025-11-19T18:17:28`
- **Total Score:** `1.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #322 (Sample 8/40)

- **Timestamp:** `2025-11-19T18:17:22`
- **Total Score:** `1.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #318 (Sample 9/40)

- **Timestamp:** `2025-11-19T18:17:05`
- **Total Score:** `0.25`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `1.0`
  - Security: `2`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0.25`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #316 (Sample 10/40)

- **Timestamp:** `2025-11-19T18:16:38`
- **Total Score:** `-2.0`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `1.0`
  - Security: `1`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #315 (Sample 11/40)

- **Timestamp:** `2025-11-19T18:16:03`
- **Total Score:** `-1.5`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0.5`
  - Security: `1`
  - Penalties: `-4` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #314 (Sample 12/40)

- **Timestamp:** `2025-11-19T18:15:48`
- **Total Score:** `-3`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `1`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** Yes

#### PR #313 (Sample 13/40)

- **Timestamp:** `2025-11-19T18:15:46`
- **Total Score:** `-3`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `1`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** Yes

#### PR #310 (Sample 14/40)

- **Timestamp:** `2025-11-19T17:25:39`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #308 (Sample 15/40)

- **Timestamp:** `2025-11-19T17:25:08`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #303 (Sample 16/40)

- **Timestamp:** `2025-11-19T17:24:23`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #300 (Sample 17/40)

- **Timestamp:** `2025-11-19T17:23:43`
- **Total Score:** `-8`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #297 (Sample 18/40)

- **Timestamp:** `2025-11-19T17:23:17`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #295 (Sample 19/40)

- **Timestamp:** `2025-11-19T17:22:51`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #292 (Sample 20/40)

- **Timestamp:** `2025-11-19T17:13:30`
- **Total Score:** `3.5`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `2.5`
  - Security: `3`
  - Penalties: `-4` ()
  - Bug Fix: `0`
  - Docs: `1.0`
  - Performance: `1`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** Yes
- **CI Failed (penalty -4):** Yes

#### PR #293 (Sample 21/40)

- **Timestamp:** `2025-11-19T17:11:45`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #291 (Sample 22/40)

- **Timestamp:** `2025-11-19T17:11:15`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #284 (Sample 23/40)

- **Timestamp:** `2025-11-19T17:01:21`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #288 (Sample 24/40)

- **Timestamp:** `2025-11-19T17:00:34`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #286 (Sample 25/40)

- **Timestamp:** `2025-11-19T17:00:03`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #282 (Sample 26/40)

- **Timestamp:** `2025-11-19T16:59:19`
- **Total Score:** `-8`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #279 (Sample 27/40)

- **Timestamp:** `2025-11-19T16:58:40`
- **Total Score:** `-8`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #277 (Sample 28/40)

- **Timestamp:** `2025-11-19T16:58:13`
- **Total Score:** `-8`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #274 (Sample 29/40)

- **Timestamp:** `2025-11-19T16:57:40`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #272 (Sample 30/40)

- **Timestamp:** `2025-11-19T16:57:13`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #268 (Sample 31/40)

- **Timestamp:** `2025-11-19T16:56:38`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #265 (Sample 32/40)

- **Timestamp:** `2025-11-19T16:56:02`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #263 (Sample 33/40)

- **Timestamp:** `2025-11-19T16:55:33`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #261 (Sample 34/40)

- **Timestamp:** `2025-11-19T16:55:02`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #260 (Sample 35/40)

- **Timestamp:** `2025-11-19T16:49:25`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #258 (Sample 36/40)

- **Timestamp:** `2025-11-19T16:48:54`
- **Total Score:** `-8`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `1`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #255 (Sample 37/40)

- **Timestamp:** `2025-11-19T16:48:21`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #252 (Sample 38/40)

- **Timestamp:** `2025-11-19T16:44:07`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #253 (Sample 39/40)

- **Timestamp:** `2025-11-19T16:42:50`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No

#### PR #250 (Sample 40/40)

- **Timestamp:** `2025-11-19T16:42:19`
- **Total Score:** `-9`
- **Files Changed:** `0`
- **Breakdown:**
  - Tests: `0`
  - Security: `-3`
  - Penalties: `-6` ()
  - Bug Fix: `0`
  - Docs: `0`
  - Performance: `0`
- **Coverage Info:** N/A
- **Frontend Coverage:** N/A
- **Backend Coverage:** N/A
- **Test Files Added:** No
- **CI Failed (penalty -4):** No


# 2. Auto-PR Statistics (Simple Metrics)

- **Total PRs Analyzed:** 117

- **PRs with Test Files:** 40 (34.2%)

- **PRs with Docs Changes:** 38 (32.5%)

- **PRs with Coverage Data:** 40 (34.2%)

### Penalty Distribution

- **Penalty -6:** 95 PRs ( 81.2%)

- **Penalty -4:** 22 PRs ( 18.8%)

### Score Distribution

- **Negative Scores (< 0):** 107 PRs

- **Low Scores (0-3):** 8 PRs

- **Medium Scores (3-6):** 2 PRs

- **High Scores (> 6):** 0 PRs

- **Average Time Between PRs:** 0.22 hours

- **Min Time Between PRs:** 0.00 hours

- **Max Time Between PRs:** 5.90 hours

- **PRs per Day (estimated):** 107.16


# 3. Coverage JSON Output (Raw CI Artifacts)

### Frontend Coverage Format (Vitest)

**Structure:** `coverage-final.json`

**Location:** `frontend/coverage/coverage-final.json`

**Format:** Object with file paths as keys, each containing coverage data

```json
{
  "file1.ts": {
    "s": {
      "1": 1,  // line 1 covered (count > 0)
      "2": 0,  // line 2 not covered
      "3": 1   // line 3 covered
    }
  },
  "file2.ts": {
    "s": {
      "4": 1,
      "5": 1
    }
  }
}
```

**Parsing Logic:**

- Iterates through all files

- Counts total statements (lines) and covered statements (count > 0)

- Calculates percentage: `(covered_lines / total_lines * 100)`

- Returns: `{total, covered, percentage}`

### Backend Coverage Format (Pytest)

**Structure:** `coverage-summary.json`

**Location:** `backend/coverage/coverage-summary.json`

**Format:** Object with `totals` key containing summary

```json
{
  "totals": {
    "num_statements": 1000,
    "covered_lines": 750,
    "percent_covered": 75.0
  }
}
```

**Parsing Logic:**

- Extracts `totals.num_statements` for total lines

- Extracts `totals.covered_lines` for covered lines

- Extracts `totals.percent_covered` for percentage (direct)

- Returns: `{total, covered, percentage}`

### Coverage Extraction Code

```python
def safe_get_percentage(cov_dict: dict, default: float = 0.0) -> float:
    """Safely extract percentage, handling None, missing keys, and type issues."""
    if not cov_dict or not isinstance(cov_dict, dict):
        return default
    pct = cov_dict.get("percentage")
    if pct is None:
        return default
    try:
        return float(pct)
    except (ValueError, TypeError):
        return default
```

### Coverage Scenarios

1. **Coverage = 0%:** Both frontend and backend coverage are 0.0

   - May indicate CI failure or tests not run

   - Triggers `failing_ci` penalty (-4) if coverage data structure exists

2. **Coverage Missing:** Coverage data structure is empty or missing

   - No penalty applied (fallback logic)

   - Handles malformed PR workflows gracefully

3. **Coverage < 20%:** Coverage exists but is low

   - Triggers `missing_tests` penalty (-2) if both < 20%

4. **Coverage >= 20%:** Good coverage

   - No penalty applied


# 4. Sample Semgrep Output (Raw JSON)

### Semgrep JSON Structure

**Command:** `semgrep --config=auto --json -o artifacts/semgrep-output.json`

**Location:** `artifacts/semgrep-output.json`

**Format:** Object with `results` array

```json
{
  "results": [
    {
      "check_id": "python.lang.security.audit.insecure-temp-file.insecure-temp-file",
      "path": "backend/src/utils/file.py",
      "start": {
        "line": 42,
        "col": 5
      },
      "end": {
        "line": 42,
        "col": 20
      },
      "message": "Insecure use of tempfile.mktemp()",
      "severity": "ERROR",
      "extra": {
        "metadata": {
          "category": "security",
          "owasp": "A03:2021 – Injection",
          "cwe": "CWE-22",
          "tags": ["security", "injection"],
          "mode": "taint"
        },
        "severity": "ERROR"
      }
    }
  ]
}
```

### Security Rule Detection

A result is considered a security rule if ANY of the following match:

1. **Category/OWASP/CWE:** Contains 'security', 'owasp', 'cwe', 'taint', 'injection', 'crypto'

2. **Tags:** Contains security-related tags

3. **Rule ID:** Matches security rule patterns (e.g., `lang.security.*`)

4. **Mode:** Set to 'taint'

5. **Message:** Contains security keywords

### Severity Classification

- **CRITICAL:** `severity == 'ERROR'` → Score: -3

- **HIGH:** `severity == 'WARNING'` → Score: -1 (or -2 if sensitive paths)

- **LOW/INFO:** Filtered out by confidence threshold

### Diff-Based Filtering

**CRITICAL FIX:** Only results in changed files are counted

- Normalizes paths (handles Windows/Unix differences)

- Matches if result path starts with changed file path or vice versa

- Prevents repo-wide issues from being counted as new findings

### Baseline Filtering

**Baseline File:** `.security-baseline.json` (if exists)

- Each result is fingerprinted: `{check_id}::{path}::{line}`

- Results in baseline are skipped (not counted as new findings)

### Example Scenarios

1. **No Findings:** `results: []` → Score: +1 (base)

2. **Low Findings:** Filtered by confidence → Score: +1

3. **High Findings:** `severity: 'WARNING'` → Score: -1

4. **Critical Findings:** `severity: 'ERROR'` → Score: -3

5. **Findings in Baseline:** Skipped → Not counted


# 5. Reward Score Code Snippets

### Penalty Calculation Block

```python
def calculate_penalties(coverage: dict, static_analysis: dict, rubric: dict) -> Tuple[int, str]:
    """
    Calculate penalties for failing CI, missing tests, regressions.
    
    CRITICAL: Conditions are mutually exclusive to prevent double-penalty bugs.
    Only one penalty type applies per PR.
    """
    penalties = rubric.get("penalties", {})
    total_penalty = 0
    notes = []
    
    # Safely extract coverage percentages
    def safe_get_percentage(cov_dict: dict, default: float = 0.0) -> float:
        if not cov_dict or not isinstance(cov_dict, dict):
            return default
        pct = cov_dict.get("percentage")
        if pct is None:
            return default
        try:
            return float(pct)
        except (ValueError, TypeError):
            return default
    
    frontend_coverage = safe_get_percentage(coverage.get("frontend", {}))
    backend_coverage = safe_get_percentage(coverage.get("backend", {}))
    
    # MUTUALLY EXCLUSIVE CONDITIONS (if/elif ensures only one applies)
    # Priority: failing_ci > missing_tests > no penalty
    
    # Check if coverage is completely missing (indicates CI failure)
    if frontend_coverage == 0.0 and backend_coverage == 0.0:
        has_coverage_data = (
            "frontend" in coverage or 
            "backend" in coverage or
            len(coverage) > 0
        )
        
        if not has_coverage_data:
            # Coverage entirely missing - do NOT penalize (fallback logic)
            notes.append("Coverage data missing (no penalty applied)")
        else:
            # Coverage exists but is 0% - likely CI failure
            penalty = penalties.get("failing_ci", -4)
            total_penalty += penalty
            notes.append(f"No test coverage detected (possible CI failure): {penalty} penalty")
    
    # Only check low coverage if we didn't already apply failing_ci penalty
    elif frontend_coverage > 0 or backend_coverage > 0:
        # Coverage exists but is low (< 20%)
        if frontend_coverage < 20.0 and backend_coverage < 20.0:
            penalty = penalties.get("missing_tests", -2)
            total_penalty += penalty
            notes.append(f"Low test coverage (<20%): {penalty} penalty")
    
    return total_penalty, "; ".join(notes)
```

### Test Scoring Block

```python
def score_tests(coverage: dict, rubric: dict, diff: str = "") -> Tuple[int, str]:
    """
    Score based on test coverage, new test files, test types, quality, and impact.
    
    Scoring breakdown:
    - +1 for new test files (max +1)
    - +1 for coverage increase >5%
    - +0.5 bonus for integration tests
    - +0.5 bonus for test quality
    - +0.5 bonus for test impact
    """
    weight = rubric.get("tests", 3)
    score = 0
    notes = []

    # Check frontend coverage
    frontend_coverage = coverage.get("frontend", {})
    frontend_percentage = frontend_coverage.get("percentage", 0)

    # Check backend coverage
    backend_coverage = coverage.get("backend", {})
    backend_percentage = backend_coverage.get("percentage", 0)

    # 1. Check for new test files (+1 per test file, max +1)
    new_test_count = detect_new_test_files(diff)
    if new_test_count > 0:
        score += 1
        notes.append(f"New test files added: {new_test_count}")

    # 2. Check for coverage increase >5% (+1)
    coverage_increase = calculate_coverage_increase(coverage, diff)
    if coverage_increase >= 5.0:
        score += 1
        notes.append(f"Coverage increase: {coverage_increase:.1f}%")

    # 3. Test type detection and bonus for integration tests (+0.5)
    test_types = detect_test_types(diff)
    if test_types["integration"] > 0 or test_types["e2e"] > 0:
        score += 0.5
        notes.append("Integration/e2e tests detected (+0.5)")

    # 4. Test quality assessment (+0.5)
    quality_score, quality_indicators = assess_test_quality(diff)
    if quality_score > 0:
        score += 0.5
        notes.append(f"Test quality: {', '.join(quality_indicators[:2])} (+0.5)")

    # 5. Test impact scoring (+0.5 for critical modules)
    has_critical_impact = detect_test_impact(diff)
    if has_critical_impact:
        score += 0.5
        notes.append("Tests cover critical modules (+0.5)")

    # Cap at maximum weight
    score = min(score, weight)

    return score, "; ".join(notes)
```

### Security Scoring Code

```python
def score_security(
    static_analysis: Dict[str, Any],
    rubric: Dict[str, int],
    changed_files: Optional[List[str]] = None,
    baseline_path: Optional[str] = None,
    diff: str = "",
    pr_desc: str = ""
) -> Tuple[int, str]:
    """
    Score based on security analysis (Semgrep JSON) with granular components.
    
    Scoring breakdown:
    - +1 for no issues detected (base)
    - +1 for security improvements
    - +1 for security documentation
    - Negative scores for issues (high: -1, critical: -3)
    """
    results = static_analysis.get("results", []) or []
    baseline = load_baseline(baseline_path or SECURITY_BASELINE_FILE)
    
    # CRITICAL FIX: Filter results to only changed files in this PR
    def result_in_changed_files(result: Dict[str, Any], changed_files_list: Optional[List[str]]) -> bool:
        if not changed_files_list:
            return True
        result_path = result.get("path") or result.get("extra", {}).get("metadata", {}).get("path") or ""
        if not result_path:
            return True
        # Normalize paths and match
        result_path_normalized = result_path.replace("\\", "/").lstrip("./")
        for changed_file in changed_files_list:
            changed_file_normalized = changed_file.replace("\\", "/").lstrip("./")
            if (result_path_normalized.startswith(changed_file_normalized) or
                changed_file_normalized.startswith(result_path_normalized)):
                return True
        return False
    
    security_results = []
    for r in results:
        # Filter by baseline
        fp = result_fingerprint(r)
        if fp in baseline:
            continue
        
        # Filter by security rule type
        if not is_security_rule(r):
            continue
        
        # CRITICAL: Filter by changed files
        if not result_in_changed_files(r, changed_files):
            continue
        
        # Filter by confidence threshold
        if not confidence_meets_threshold(r):
            continue
        
        security_results.append(r)
    
    # Categorize by severity
    critical = [r for r in security_results if (r.get("extra", {}).get("severity") or "").upper() == "ERROR"]
    high = [r for r in security_results if (r.get("extra", {}).get("severity") or "").upper() == "WARNING"]
    
    score = 0
    if critical:
        score = -3
    elif high:
        score = -2 if touches_sensitive_path(changed_files) else -1
    else:
        score += 1  # Base score for no issues
        # Check for improvements (+1)
        if detect_security_improvements(diff, pr_desc)[0]:
            score += 1
        # Check for documentation (+1)
        if detect_security_documentation(diff, pr_desc):
            score += 1
    
    return score, notes
```

### Coverage Parsing Code

```python
def parse_frontend_coverage(coverage_path: str) -> Dict:
    """Parse frontend Vitest coverage JSON."""
    coverage = load_json(coverage_path)
    if not coverage:
        return {"total": 0, "covered": 0, "percentage": 0}
    
    # Vitest coverage format: coverage-final.json
    total_lines = 0
    covered_lines = 0
    
    for file_path, file_data in coverage.items():
        if isinstance(file_data, dict) and "s" in file_data:
            statements = file_data["s"]
            for line_num, count in statements.items():
                total_lines += 1
                if count > 0:
                    covered_lines += 1
    
    percentage = (covered_lines / total_lines * 100) if total_lines > 0 else 0
    return {
        "total": total_lines,
        "covered": covered_lines,
        "percentage": percentage
    }

def parse_backend_coverage(coverage_path: str) -> Dict:
    """Parse backend pytest coverage JSON."""
    coverage = load_json(coverage_path)
    if not coverage:
        return {"total": 0, "covered": 0, "percentage": 0}
    
    # Pytest coverage format
    total_lines = coverage.get("totals", {}).get("num_statements", 0)
    covered_lines = coverage.get("totals", {}).get("covered_lines", 0)
    percentage = coverage.get("totals", {}).get("percent_covered", 0)
    
    return {
        "total": total_lines,
        "covered": covered_lines,
        "percentage": percentage
    }
```

### Threshold Logic

- **Coverage == 0.0 (both):** Check if coverage data structure exists

  - If missing: No penalty (fallback)

  - If exists: `failing_ci` penalty (-4)

- **Coverage > 0 (either):** Check if both < 20%

  - If both < 20%: `missing_tests` penalty (-2)

  - If either >= 20%: No penalty

- **Priority:** `failing_ci` > `missing_tests` > no penalty (mutually exclusive)


# 6. GitHub CI Workflows (Coverage Generation)

### CI Workflow: `.github/workflows/ci.yml`

**Triggers:** Push to main/master, Pull requests

#### Frontend Job

```yaml
jobs:
  frontend:
    name: Frontend Lint, Typecheck, Test & Build
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: frontend
    steps:
      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: Run unit tests with coverage
        run: npm run test:ci
      
      - name: Upload frontend coverage artifact
        uses: actions/upload-artifact@v4
        with:
          name: frontend-coverage
          path: frontend/coverage/coverage-final.json
          retention-days: 7
```

#### Backend Job

```yaml
  backend:
    name: Backend Lint, Unit & E2E
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: backend
    steps:
      - name: Use Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: Run unit tests
        run: npm test -- --ci --reporters=default
      
      - name: Upload backend coverage artifact
        uses: actions/upload-artifact@v4
        with:
          name: backend-coverage
          path: backend/coverage/coverage-summary.json
          retention-days: 7
        continue-on-error: true
```

### Reward Score Workflow: `.github/workflows/swarm_compute_reward_score.yml`

**Triggers:** PR opened/synchronized, CI workflow completed

#### Coverage Download Steps

```yaml
      - name: Download frontend coverage artifact
        uses: actions/download-artifact@v4
        with:
          name: frontend-coverage
          path: artifacts/frontend
        continue-on-error: true

      - name: Download backend coverage artifact
        uses: actions/download-artifact@v4
        with:
          name: backend-coverage
          path: artifacts/backend
        continue-on-error: true

      - name: Download frontend coverage from CI workflow
        if: github.event_name == 'workflow_run'
        uses: actions/download-artifact@v4
        with:
          name: frontend-coverage
          path: artifacts/frontend
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}
        continue-on-error: true
```

#### Coverage File Detection

```bash
      - name: Find coverage files
        id: coverage
        run: |
          # Check for frontend coverage (prioritize artifacts from CI workflow)
          if [ -f "artifacts/frontend/coverage-final.json" ]; then
            FRONTEND_COV="artifacts/frontend/coverage-final.json"
          elif [ -f "frontend/coverage/coverage-final.json" ]; then
            FRONTEND_COV="frontend/coverage/coverage-final.json"
          fi
          
          # Check for backend coverage
          if [ -f "artifacts/backend/coverage-summary.json" ]; then
            BACKEND_COV="artifacts/backend/coverage-summary.json"
          elif [ -f "backend/coverage/coverage-summary.json" ]; then
            BACKEND_COV="backend/coverage/coverage-summary.json"
          fi
          
          # Combine paths (comma-separated for script
          if [ -n "$FRONTEND_COV" ] && [ -n "$BACKEND_COV" ]; then
            echo "paths=$FRONTEND_COV,$BACKEND_COV" >> "$GITHUB_OUTPUT"
          elif [ -n "$FRONTEND_COV" ]; then
            echo "paths=$FRONTEND_COV" >> "$GITHUB_OUTPUT"
          elif [ -n "$BACKEND_COV" ]; then
            echo "paths=$BACKEND_COV" >> "$GITHUB_OUTPUT"
          else
            echo "paths=" >> "$GITHUB_OUTPUT"
            echo '{}' > artifacts/empty-coverage.json
          fi
```

### Key Observations

1. **Separate Jobs:** Frontend and backend tests run in separate jobs

2. **Artifact Names:** `frontend-coverage` and `backend-coverage`

3. **File Paths:**

   - Frontend: `frontend/coverage/coverage-final.json`

   - Backend: `backend/coverage/coverage-summary.json`

4. **Fallback:** If no coverage found, creates empty JSON `{}`

5. **Continue-on-Error:** Coverage download failures don't block workflow


# 7. Reward Score History File

### File Location

**Path:** `docs/metrics/reward_scores.json`

**Format:** JSON object with version, last_updated, and scores array

### Structure

```json
{
  "version": "1.0",
  "last_updated": "2025-11-19T18:20:15.098469Z",
  "scores": [
    {
      "pr": "56",
      "score": -5,
      "breakdown": {
        "tests": 1,
        "bug_fix": 1,
        "docs": 1,
        "performance": 1,
        "security": -3,
        "penalties": -6
      },
      "timestamp": "2025-11-18T22:01:50.302871Z",
      "rubric_version": "unknown",
      "author": null,
      "files_changed": 0,
      "coverage_delta": null,
      "file_scores": {
        ".cursor/BUG_LOG.md": {
          "score": 1,
          "breakdown": {...},
          "notes": "..."
        }
      },
      "notes": "Full scoring notes..."
    }
  ]
}
```

### Statistics

- **Total PRs:** 117

- **Last Updated:** 2025-11-19T18:20:15.098469Z

- **Version:** 1.0

- **Recent PRs (last 10):** 323, 319, 317, 324, 325, 320, 321, 322, 318, 316


# 8. Scoring Rubric File

### File Location

**Path:** `.cursor/reward_rubric.yaml`

### Content

```yaml
# REWARD_SCORE Rubric
version: 1
weights:
  tests: 3
  bug_fix: 2
  docs: 1
  performance: 1
  security: 2
penalties:
  failing_ci: -4
  missing_tests: -2
  regression: -3
rules:
  - id: tests_pass
    description: Award when automated tests are added/updated and pass CI.
  - id: bug_fix
    description: Documented bugs fixed with regression coverage.
  - id: docs_updated
    description: User-facing docs or ADRs updated.
  - id: security_blocker
    description: If CI reports critical security issue, auto set score ≤ -3.
notes: >
  CI pipelines must emit reward.json containing score, breakdown, and comment body
  using `.cursor/ci/reward_score_comment_template.md`.


```


# 9. Key Findings & Recommendations

### Current Issues Identified

1. **-4 Penalty Trend:** PRs with test files but 0% coverage are getting `failing_ci` penalty

   - **Root Cause:** Tests added but coverage not yet collected (new tests not run)

   - **Impact:** 22 PRs affected in recent analysis

   - **Recommendation:** Adjust penalty logic to check if test files exist before applying `failing_ci`

2. **Coverage Collection Timing:** Coverage may be 0% if:

   - Tests are added but CI hasn't run yet

   - Coverage collection fails silently

   - Artifacts are not uploaded correctly

3. **Security Scoring:** Currently working correctly with diff-based filtering

   - Only counts findings in changed files

   - Baseline filtering prevents duplicate counting

### System Strengths

1. **Mutually Exclusive Penalties:** Fixed double-penalty bug

2. **Type-Safe Coverage Extraction:** Handles missing/None values gracefully

3. **Diff-Based Security Filtering:** Prevents repo-wide issue counting

4. **Fallback Logic:** Missing coverage data doesn't trigger false penalties


# 10. Appendix: Code Locations

### Key Files

- **Reward Score Computation:** `.cursor/scripts/compute_reward_score.py`

- **Metrics Collection:** `.cursor/scripts/collect_metrics.py`

- **Trend Analysis:** `.cursor/scripts/analyze_reward_trends.py`

- **Auto-PR Daemon:** `.cursor/scripts/auto_pr_daemon.py`

- **CI Workflow:** `.github/workflows/ci.yml`

- **Reward Score Workflow:** `.github/workflows/swarm_compute_reward_score.yml`

- **Rubric:** `.cursor/reward_rubric.yaml`

- **History:** `docs/metrics/reward_scores.json`

### Key Functions

- **Penalty Calculation:** `calculate_penalties()` (line ~1178)

- **Test Scoring:** `score_tests()` (line ~478)

- **Security Scoring:** `score_security()` (line ~1000)

- **Frontend Coverage Parsing:** `parse_frontend_coverage()` (line ~123)

- **Backend Coverage Parsing:** `parse_backend_coverage()` (line ~149)

---

**Report Generated:** 2025-11-19T16:28:48.518426

**End of Report**

