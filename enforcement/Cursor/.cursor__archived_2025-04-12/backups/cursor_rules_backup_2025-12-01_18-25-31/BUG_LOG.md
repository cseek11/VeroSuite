# BUG LOG

| Date | Area | Description | Status | Owner | Notes |      
|------|------|-------------|--------|-------|-------|      
| 2025-12-04 | Frontend/TypeScript | TYPESCRIPT_ANY_TYPES - Components used TypeScript `any` types instead of proper types, reducing type safety and potentially causing runtime errors. Found in event handlers, type assertions, and function return types. | fixed | AI Agent | Fixed in PaymentForm.tsx (5 `any` types) and SavedPaymentMethods.tsx (1 `any` type). Added proper type imports from @stripe/react-stripe-js, replaced type assertions with type guards, fixed return types to match union types. Error pattern documented in docs/error-patterns.md#TYPESCRIPT_ANY_TYPES. |
| 2025-12-04 | Backend/Database | TENANT_CONTEXT_NOT_FOUND - Backend service methods failed to retrieve tenant context when using `getCurrentTenantId()` due to Prisma connection pooling not preserving `SET LOCAL` session variables set by middleware. | fixed | AI Agent | Fixed by requiring `tenantId` parameter explicitly in service methods, removing `getCurrentTenantId()` fallback, and using `req.user?.tenantId || req.tenantId` pattern in controllers. Error pattern documented in docs/error-patterns.md#TENANT_CONTEXT_NOT_FOUND. |
| 2025-12-04 | Backend/Validation | INVALID_UUID_FORMAT - Frontend passed `accountId` parameter with malformed format (leading `:` and trailing `}` characters), causing Prisma UUID parsing errors. | fixed | AI Agent | Fixed by adding UUID validation and cleaning logic in service methods. Removes formatting characters, validates UUID format with regex, and gracefully skips account filter if UUID is invalid. Error pattern documented in docs/error-patterns.md#INVALID_UUID_FORMAT. |
| 2025-12-04 | Frontend/UI | TABS_COMPONENT_MISSING_CONTENT - Frontend component showed white page because `Tabs` component only renders navigation buttons, not the tab content. Component was missing logic to render active tab content. | fixed | AI Agent | Fixed by adding loading state, fixing Tabs prop (onChange to onValueChange), and adding tab content rendering logic. Error pattern documented in docs/error-patterns.md#TABS_COMPONENT_MISSING_CONTENT. |
| 2025-12-04 | Frontend/Testing | TEST_SELECTOR_MISMATCH - Frontend tests failed because they used incorrect selectors to find tab elements. Tests used `getByRole('button')` to find tabs, but tabs may not have `role="tab"` when using certain Tabs component implementations. | fixed | AI Agent | Fixed by using semantic ARIA roles (`getByRole('tab')`), adding fallback selectors, and making tests flexible to handle component implementation variations. Error pattern documented in docs/error-patterns.md#TEST_SELECTOR_MISMATCH. |
| 2025-12-04 | Frontend/Testing | TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS - Frontend tests failed with timeouts and "Found multiple elements" errors when testing async operations and button interactions. Tests used `getByText()` or `getByRole()` which fail when multiple elements match. | fixed | AI Agent | Fixed by using `queryAllBy*` for multiple elements, adding proper timeouts (3000-5000ms), using fallback strategies, and handling conditional rendering. Error pattern documented in docs/error-patterns.md#TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS. Regression tests added (53+ tests across 4 test files). |
| 2025-12-04 | Frontend/Scheduling | REACT_QUERY_API_FETCH_ERROR - ResourceTimeline component missing error handling for React Query API fetch failures. Errors from enhancedApi.technicians.list, enhancedApi.users.list, and enhancedApi.jobs.getByDateRange were not caught and displayed to users, causing silent failures. | fixed | AI Agent | Fixed during implementation. Error pattern documented in docs/error-patterns.md#REACT_QUERY_API_FETCH_ERROR. All errors now use structured logging (logger.error) and display user-friendly error messages. Regression tests added (4 error handling tests). |
| 2025-12-04 | CI/Reward Score Calculation | PENALTY_DOUBLE_APPLICATION - Penalty calculation applying both `failing_ci` (-4) and `missing_tests` (-2) penalties, resulting in -6 instead of -4. Type coercion issues in coverage percentage extraction and missing fallback logic for malformed coverage data. | fixed | AI Agent | Fixed in compute_reward_score.py calculate_penalties(). Made conditions mutually exclusive using if/elif. Added safe_get_percentage() helper with proper type coercion. Added fallback for missing coverage data. Improved condition logic to only apply penalties when appropriate. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-12-04 | CI/Security Scoring | SECURITY_REPO_WIDE_ISSUES - All PRs scored -3 for security, even when no new security issues were introduced. Semgrep scans entire repository, not just changed files, causing security findings from unchanged files to be counted as new issues. | fixed | AI Agent | Fixed by adding `result_in_changed_files()` function to filter Semgrep results. Only counts security findings in files actually changed by the PR. Added `skipped_by_diff_filter` counter for transparency. Normalized file paths for cross-platform compatibility. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-12-04 | CI/Workflows | PR_SYSTEM_ARTIFACT_PIPELINE_FAILURE - PR reward system had multiple silent failure points causing dashboard to never update. Scripts didn't verify file creation, verification steps didn't validate JSON, artifact downloads used continue-on-error: true, and no error propagation from scripts to workflows. | fixed | AI Agent | Fixed by adding file verification, JSON validation, proper exit codes, removing continue-on-error from critical steps, adding artifact verification, and using proper cross-workflow artifact download action. Related: docs/planning/PR_SYSTEM_FIX_AUDIT_REPORT.md. |
| 2025-12-04 | Backend/Auth | JWT_SECRET_LOADING_TIMING - JWT_SECRET environment variable checked at module load time (auth.module.ts line 14) before NestJS ConfigModule loads .env file, causing "JWT_SECRET environment variable is required" error even when variable is set. | fixed | AI Agent | Fixed by changing from JwtModule.register() to JwtModule.registerAsync() with ConfigService. This ensures environment variables are loaded before JWT module initialization. Error now includes traceId for debugging. Regression tests added (auth.module.spec.ts). |
| 2025-12-04 | Backend/Build | START_SCRIPT_PATH_MISMATCH - Start script in package.json looking for dist/main.js but NestJS build outputs to dist/apps/api/src/main.js due to monorepo structure preservation. | fixed | AI Agent | Fixed by updating package.json start scripts to use correct path: dist/apps/api/src/main.js. This ensures API server can start after build. Documented in API_START_SCRIPT_FIX.md. |
| 2025-12-04 | OPA/Testing | TECH_DEBT_R14_TEST_FAILURES - R14 tech debt policy test suite has 5/12 tests failing. Policy pattern detection not working correctly for workarounds, deferred fixes, deprecated patterns, hardcoded dates, and incomplete remediation plans. Import fix applied (tech_debt.warn usage), but policy logic needs debugging. | open | AI Agent | Fixed import usage in test file (tech_debt.warn instead of warn). Policy pattern detection logic needs investigation. Tests: test_missing_debt_entry_for_workaround, test_missing_debt_entry_for_deferred_fix, test_hardcoded_date_in_tech_debt, test_incomplete_remediation_plan, test_missing_debt_entry_for_deprecated_pattern all failing. Related: docs/compliance-reports/TASK5-R14-IMPLEMENTATION-COMPLETE.md. |
| 2025-12-04 | OPA/Testing | REGO_STRING_LITERAL_INTERPRETATION - R15 tech debt policy tests failed because `\n` in Rego test strings is literal (backslash+n), not actual newline, unlike JSON inputs where `\n` is decoded to newline. Regex patterns expecting newlines failed. Required >1 hour to diagnose root cause. Tests passed with `opa eval --input JSON` but failed with `opa test` due to string literal difference. | fixed | AI Agent | Fixed by converting multi-line test inputs to raw strings (backticks) which preserve actual newlines. Updated 3 test cases (test_todo_without_clear_action, test_fixme_added_without_reference, test_meaningful_todo_not_logged). Also fixed test evaluation context (variable binding pattern) and case sensitivity issues. Prevention strategies added to Rego OPA Bible (Section 7.7). Error pattern documented in docs/error-patterns.md#REGO_STRING_LITERAL_INTERPRETATION. Related: docs/compliance-reports/R15-FINAL-IMPLEMENTATION-SUMMARY.md. |
| 2025-12-04 | OPA/Testing | REGO_UNSAFE_VAR_BARE_RULE_NAMES - sample_test.rego had 6 unsafe variable errors because tests used bare rule names (deny, warn, override, metadata) instead of qualified names (sample.deny, sample.warn, etc.) and direct operations on rules instead of variable binding. Tests failed with `rego_unsafe_var_error` even though import was present. | fixed | AI Agent | Fixed by using qualified rule names (sample.deny, sample.warn, sample.override, sample.metadata) and binding rule results to variables before operations (denials := sample.deny with input as test_input; count(denials) == 0). All 7 tests now pass. Pattern matches security_r01_test.rego. Error pattern documented in docs/error-patterns.md#REGO_UNSAFE_VAR_BARE_RULE_NAMES. Related: docs/reference/rego_opa_bible.md (Section 7.8, 7.8.1). |
| 2025-12-04 | OPA/Policy | REGO_REGEX_LINE_ANCHOR_FAILURE - R06 breaking change policy tests failed (5/11) because regex patterns used line anchors (`^`) which don't work as expected in Rego multiline strings. Patterns like `regex.match(".*^\\-.*export...")` failed to match breaking changes in diffs. Also used complex regex with `\n` which doesn't work in Rego string literals. | fixed | AI Agent | Fixed by replacing regex line anchors with simpler `contains()` checks (e.g., `contains(file.diff, "-export")`). Split HTTP method detection into multiple rule bodies (one per method: `-@Get`, `-@Post`, etc.) since Rego doesn't support `or` in single expressions. Fixed version bump detection using `regex.find_all_string_submatch_n()` and `to_number()` comparison. Fixed CHANGELOG detection using case-insensitive `contains()` checks. All 11 tests now pass. Error pattern documented in docs/error-patterns.md#REGO_REGEX_LINE_ANCHOR_FAILURE. Related: docs/reference/rego_opa_bible.md (Section 6.8). |
| 2025-12-04 | OPA/Testing | REGO_TEST_WITH_CLAUSE_MISSING - R06 breaking change policy tests failed because test evaluations were missing `with input as test_input` clauses. Tests used `violations := data.compliance.data_integrity.deny` without `with` clause, causing policy to evaluate with empty/default input instead of test input. | fixed | AI Agent | Fixed by adding `with input as test_input` to all test evaluations (5 test cases). Pattern: `violations := data.compliance.data_integrity.deny with input as test_input`. This ensures test inputs are properly passed to policy evaluation. All tests now pass. Related: docs/error-patterns.md#REGO_TEST_EVALUATION_CONTEXT (similar pattern). |
| 2025-12-04 | OPA/Testing | REGO_CONTAINS_TYPE_ERROR - quality_r16_test.rego had 11 type errors with `contains()` function receiving boolean instead of string. Tests used `quality.additional_testing_warnings` directly which returned boolean values instead of strings. Required OPA upgrade to 1.10.1 and pattern change to use `quality.warn` with comprehension pattern. | fixed | AI Agent | Fixed by upgrading OPA to 1.10.1, changing tests to use `quality.warn` (aggregated warnings) instead of `quality.additional_testing_warnings` directly, and using comprehension pattern `count([msg | msg := result[_]; contains(msg, "R16"); contains(msg, "error path")])`. All 16 tests now pass. Error pattern documented in docs/error-patterns.md#REGO_CONTAINS_TYPE_ERROR. Related: .cursor/BUG_LOG.md (2025-12-04). |
| 2025-12-04 | OPA/Policy | REGO_POLICY_TEST_FILE_WARNINGS - Quality policy (R16) generating warnings for test files themselves (e.g., auth.service.spec.ts, migration.test.sql) because `needs_security_tests` and `needs_data_migration_tests` didn't exclude test files. Policy checked if test file paths contained "auth" or "migration" and generated warnings for test files. Required trace debugging to identify root cause. | fixed | AI Agent | Fixed by adding `not is_test_file(file.path)` checks to `needs_security_tests` and `needs_data_migration_tests` functions, and extending `is_test_file` to recognize `.test.sql` files. Pattern matches `needs_error_path_tests` which correctly excludes test files. All 16 tests now pass. Error pattern documented in docs/error-patterns.md#REGO_POLICY_TEST_FILE_WARNINGS. Related: .cursor/BUG_LOG.md (2025-12-04). |
| 2025-12-04 | OPA/Testing | REGO_TEST_WITH_CLAUSE_MISSING_R05 - R05 data integrity policy tests failed (8/13 tests) because test evaluations were missing `with input as test_input` clauses. Tests used `violations := data.compliance.data_integrity.deny` or `count(data.compliance.data_integrity.deny) == 0` without `with` clause, causing policy to evaluate with empty/default input instead of test input. Same pattern as R06 bug (entry #21) but in different test file. | fixed | AI Agent | Fixed by adding `with input as test_input` to all test evaluations (8 test cases). Pattern: `violations := data.compliance.data_integrity.deny with input as test_input` or `count(data.compliance.data_integrity.deny) == 0 with input as test_input`. This ensures test inputs are properly passed to policy evaluation. All 13 tests now pass. Error pattern already documented in docs/error-patterns.md#REGO_TEST_WITH_CLAUSE_MISSING (same pattern as R06). Related: .cursor/BUG_LOG.md (2025-12-04), docs/error-patterns.md#REGO_TEST_WITH_CLAUSE_MISSING. |
| 2025-12-04 | OPA/Policy | REGO_POLICY_ENUM_MATCH_FIRST_ONLY - R05 data integrity policy only processed first enum match found in diff instead of all matches. Policy used `entity_name := entity_matches[0][1]` which only checked first match, causing missed violations when multiple stateful entities were modified in same PR. Edge case test `test_r05_edge_case_multiple_entities` failed because second entity violation was not detected. | fixed | AI Agent | Fixed by changing policy to iterate over all enum matches using `some match in entity_matches` pattern. Changed from `entity_name := entity_matches[0][1]` to `some match in entity_matches; entity_name := match[1]`. This ensures all enum definitions in diff are checked for state machine documentation requirements. Edge case test now passes. Error pattern documented in docs/error-patterns.md#REGO_POLICY_ENUM_MATCH_FIRST_ONLY. Related: .cursor/BUG_LOG.md (2025-12-04). |
| 2025-12-04 | SSM Compiler/Phase 7 | METRICS_COLLECTOR_IMPORT_ERROR - Compiler failed with `NameError: name 'MetricsCollector' is not defined` when running compilation. MetricsCollector import was added but not properly imported in the try/except block, and the check `if MetricsCollector:` was incorrect (should be `if MetricsCollector is not None:`). Also, compile_document function didn't accept namespace parameter and compile_markdown_to_ssm_v3 didn't return diagnostics tuple. | fixed | AI Agent | Fixed by adding MetricsCollector import in try/except block, changing check to `if MetricsCollector is not None:`, updating compile_document to accept namespace parameter, updating compile_markdown_to_ssm_v3 to return Tuple[str, Dict[str, Any]], and fixing command-line argument parsing to handle --namespace flag. Compiler now successfully compiles documents with metrics collection. Related: docs/error-patterns.md#METRICS_COLLECTOR_IMPORT_ERROR. |
| 2025-12-04 | SSM Compiler/Table Extraction | TABLE_EXTRACTION_EMBEDDED_TABLES - Comparison report indicated 4 tables in source but only 3 were extracted. Investigation revealed only 3 real markdown tables exist; line 242 was incorrectly identified as a table (it's EBNF grammar syntax using `|` as "or" operator). Enhanced table detection to handle embedded tables after text without blank lines and improved paragraph/code block scanning. All 3 real tables now extracted correctly (100% preservation). Related: docs/error-patterns.md#TABLE_EXTRACTION_EMBEDDED_TABLES. |
| 2025-12-04 | SSM Compiler/Table Extraction | TABLE_EXTRACTION_ONLY_PARAGRAPHS - Table extractor only scanned paragraph nodes for tables, but markdown tables are typically standalone blocks. Parser didn't detect tables as a separate node type, causing standalone tables to be lost during compilation. Only tables embedded in paragraphs were extracted, not standalone tables. | fixed | AI Agent | Fixed by adding table detection to markdown parser (parser_markdown.py) to create `table` node types for standalone tables. Updated extractor_tables.py to scan all nodes (not just paragraphs) and prioritize table nodes. Changed parser from for-loop to while-loop with index-based iteration to allow skipping processed table lines. All standalone tables now correctly detected and extracted. Related: docs/error-patterns.md#TABLE_EXTRACTION_ONLY_PARAGRAPHS. |
| 2025-12-04 | SSM Compiler/Chapter Detection | DUPLICATE_CHAPTER_CODES - Chapter code "CH-03" appeared twice in output (legitimate chapter + diagram chapter). Diagram titles like "Evaluation Flow (Diagram)" were being detected as chapters because they matched the chapter heading pattern. This violated V3 requirement that chapter codes must be globally unique. | fixed | AI Agent | Fixed by adding diagram detection logic in parser_markdown.py to exclude diagram titles from chapter detection. Diagrams are now treated as sections (level 3) instead of chapters. Added duplicate chapter code handling in parser_ssm.py to append suffixes (CH-03-A, CH-03-B) when duplicates are detected. Related: docs/error-patterns.md#DUPLICATE_CHAPTER_CODES. |
| 2025-12-04 | SSM Compiler/Summary Generation | CONCEPT_SUMMARY_LIST_MARKERS - Concept block summaries were single numbers (1, 4, etc.) because summary generation used naive text splitting that captured list markers. When text started with "1. " or "- ", the summary became just the number/bullet. This produced invalid summaries that didn't represent the actual content. | fixed | AI Agent | Fixed by adding regex to strip list markers (numbers, bullets) before generating summary in parser_ssm.py. Improved fallback logic to extract first meaningful sentence when summary is too short. Added minimum length check and better sentence extraction. All numeric-only summaries now fixed. Related: docs/error-patterns.md#CONCEPT_SUMMARY_LIST_MARKERS. |
| 2025-12-04 | SSM Compiler/Term Extraction | TERM_EXTRACTION_TRUNCATION - Term definitions were truncated at backticks or first period because regex pattern `([^.\n]+)` stopped at first period or newline. Definitions containing code blocks or multi-sentence explanations were cut off, losing important context. | fixed | AI Agent | Fixed by improving TERM_DEF_RE and QUOTED_TERM_RE regex patterns in utils/patterns.py to use `(.+?)(?=\n\n|\*\*|$)` with DOTALL flag, capturing multi-line definitions including code blocks. Regex now stops at paragraph boundaries (double newline) or next term definition, not first period. Related: docs/error-patterns.md#TERM_EXTRACTION_TRUNCATION. |
| 2025-12-04 | SSM Compiler/Error Handling | SILENT_EXCEPTION_SWALLOWING - Compiler silently swallowed exceptions when loading cache (compiler.py:163-164), making debugging impossible. Exception was caught with `except Exception: pass` without any logging or error reporting. This violated Python Bible anti-pattern D.13 (bare except blocks) and error handling best practices. | fixed | AI Agent | Fixed by adding proper error logging using ErrorBus.warning() when cache loading fails. Exception context is now captured and logged with error code "CACHE_LOAD_FAILED" and full exception message. Cache loading remains optional (non-critical), but failures are now visible for debugging. Related: docs/error-patterns.md#SILENT_EXCEPTION_SWALLOWING. |
| 2025-12-04 | SSM Compiler/Performance | UNCOMPILED_REGEX_PATTERNS - Regex patterns in summary_generator.py were compiled on every method call instead of being pre-compiled at module level, causing unnecessary performance overhead. Patterns like `r'^[\d]+\.\s+'` were compiled repeatedly in hot paths (_normalize_text, _split_sentences, etc.). | fixed | AI Agent | Fixed by moving all regex patterns to module level and pre-compiling them as constants (LIST_MARKER_ORDERED_RE, LIST_MARKER_UNORDERED_RE, WHITESPACE_RE, BOLD_RE, CODE_RE, SENTENCE_SPLIT_RE, etc.). Pattern matches existing code in modules/utils/patterns.py. All regex operations now use pre-compiled patterns, improving performance. Related: docs/error-patterns.md#UNCOMPILED_REGEX_PATTERNS. |
| 2025-12-04 | SSM Compiler/Code Quality | MAGIC_NUMBERS_IN_CODE - Multiple files contained magic numbers (hardcoded numeric literals) without named constants, reducing code readability and maintainability. Found in summary_generator.py (3, 5, 10, 100, 150) and v3_metadata.py (1, 10, 20, 80). | fixed | AI Agent | Fixed by extracting all magic numbers to named constants at module level. summary_generator.py: MIN_TEXT_LENGTH=5, MIN_WORD_COUNT=2, MIN_SENTENCE_LENGTH=10, MIN_WORD_COUNT_FOR_SUMMARY=3, MIN_WORD_COUNT_PREFERRED=5, MAX_WORD_COUNT_PREFERRED=20, MAX_SUMMARY_LENGTH=150, TRUNCATE_LENGTH=100, TRUNCATE_MIN_LENGTH=50, POSITION_BONUS_MULTIPLIER=0.5, KEYWORD_BONUS=2. v3_metadata.py: MIN_SYMBOL_LENGTH=1, MAX_SYMBOL_REFS_UNVALIDATED=10, MAX_SYMBOL_REFS_LIMIT=20, CHARS_PER_LINE_ESTIMATE=80. Related: docs/error-patterns.md#MAGIC_NUMBERS_IN_CODE. |
| 2025-12-04 | Python/Error Handling | BARE_EXCEPT_CLAUSES - Two files contained bare `except:` clauses that silently swallowed all exceptions, violating Python Bible anti-pattern D.13 and error handling best practices (R07). Found in tools/bible_pipeline.py:486 and generate_comprehensive_report.py:133. | fixed | AI Agent | Fixed by replacing bare `except:` with specific exception types (ValueError, IndexError) and proper error logging with StructuredLogger. Added fallback `except Exception as e:` with `exc_info=True` and re-raising for unexpected errors. All errors now logged with context, operation, errorCode, rootCause, and traceId. Related: docs/error-patterns.md#BARE_EXCEPT_CLAUSES. |
| 2025-12-04 | Python/Observability | EXCESSIVE_PRINT_STATEMENTS - 45+ Python files contained 972+ `print()` statements instead of structured logging, violating R08 observability rules and Python Bible anti-pattern BLK-13.16. Production code used `print()` for info, progress, warnings, and errors instead of StructuredLogger. | fixed | AI Agent | Fixed by replacing all `print()` statements with StructuredLogger calls (logger.info, logger.warn, logger.error, logger.progress) across 45+ main source files. All logs now include required fields: level, message, timestamp, traceId, context, operation, severity. Test files still have print() but are lower priority. Related: docs/error-patterns.md#EXCESSIVE_PRINT_STATEMENTS. |
| 2025-12-04 | Python/Type Hints | TYPE_HINT_OPTIONAL_MISSING - check_pr_scores.py had invalid type hint `pr_numbers: list[int] = None` which violates Python type system. Cannot assign None to non-optional type. Also missing Optional import and fallback error handling for logger_util and supabase imports. | fixed | AI Agent | Fixed by changing type hint to `Optional[list[int]] = None`, adding `from typing import Optional`, adding try/except fallback for logger_util import with standard logging fallback, adding try/except for supabase import with clear error message, and adding "Last Updated: 2025-12-04" to docstring. Pattern matches other scripts (auto-enforcer.py, watch-files.py). |
| 2025-12-04 | Python/Error Handling | MISSING_LOGGER_FALLBACK - test_file_watcher_integration.py had direct logger_util import without fallback, causing script to fail if logger_util unavailable. Also had hardcoded dates (2025-12-04) in docstring and test data, and unused imports (time, tempfile). | fixed | AI Agent | Fixed by adding try/except fallback for logger_util import with standard logging fallback, updating "Last Updated" date to 2025-12-04, replacing hardcoded test date with datetime.now(timezone.utc).isoformat(), and removing unused imports. Pattern matches other scripts (check_pr_scores.py, auto-enforcer.py). |

