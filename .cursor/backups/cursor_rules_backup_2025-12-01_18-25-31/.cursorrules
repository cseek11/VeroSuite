# VeroField Hybrid Rule System v2.0
# This file loads all .mdc rule files from .cursor/rules/

# CRITICAL: Auto-Enforcement System

**‚ö†Ô∏è MANDATORY PRE-TASK CHECK - YOU MUST COMPLETE THIS BEFORE IMPLEMENTING ANY TASK:**

1. **READ** `.cursor/enforcement/ENFORCEMENT_BLOCK.md` FIRST (use `read_file` tool)
   - **IF FILE EXISTS:** You are BLOCKED - read the entire message and STOP immediately
   - **IF FILE DOES NOT EXIST:** Continue to step 2
2. **READ** `.cursor/enforcement/AGENT_STATUS.md` (use `read_file` tool)
3. **IF STATUS IS üî¥ BLOCKED:**
   - **STOP IMMEDIATELY** - Do NOT proceed with any task implementation
   - **CHECK** the "BLOCKING INSTRUCTIONS" section in AGENT_STATUS.md
   - **IF violations are "Current Session" (üîß):**
     - Auto-fix these violations NOW before proceeding
     - Update dates to current system date
     - Fix "Last Updated" fields if file was modified
     - Re-run enforcement check to verify fixes
   - **IF violations are "Historical" (üìã):**
     - List ALL blockers clearly in your response
     - Request human input/guidance before proceeding
     - DO NOT attempt to fix historical violations automatically
   - **ONLY proceed** after all current session violations are fixed OR human guidance is provided
3. **REVIEW** `.cursor/enforcement/AGENT_REMINDERS.md` for active reminders
4. **CHECK** `.cursor/enforcement/VIOLATIONS.md` for recent violations

## Hard Stop Conditions

The following violations trigger üî¥ BLOCKED status:

1. **Hardcoded Dates** (02-core.mdc) - HARD STOP
2. **Missing Memory Bank Context** (01-enforcement.mdc Step 0) - HARD STOP
3. **Security Violations** (03-security.mdc) - HARD STOP
4. **Missing activeContext.md Update** (01-enforcement.mdc Step 5) - HARD STOP
5. **Silent Failures** (06-error-resilience.mdc) - HARD STOP
6. **Missing Bug Logging** (01-enforcement.mdc Step 4.5) - HARD STOP

## Response Template

Every response MUST include:

1. **Status Check:** "‚úì Read AGENT_STATUS.md - Status: [BLOCKED/WARNING/COMPLIANT]"
2. **If BLOCKED:**
   - List all current session violations (üîß) that you will auto-fix
   - List all historical violations (üìã) requiring human input
   - Confirm you will NOT proceed until violations are addressed
3. **Active Reminders:** List any active reminders from AGENT_REMINDERS.md
4. **Compliance Confirmation:** Confirm compliance with applicable rules

## Blocking Behavior

**When status is üî¥ BLOCKED:**

- **DO NOT** implement the requested task
- **DO NOT** create or modify files (except to fix violations)
- **DO NOT** proceed with Step 1 (Search & Discovery) until violations are resolved
- **MUST** either:
  - Auto-fix current session violations immediately, OR
  - List historical violations and request human guidance

**Example BLOCKED Response:**

```
‚ö†Ô∏è BLOCKED - Cannot Proceed

Status: üî¥ BLOCKED

Current Session Violations (Auto-Fixing):
- Hardcoded date in file.ts:123 - Updating to current date now
- "Last Updated" not updated in docs.md - Updating now

Historical Violations (Requiring Human Input):
- Hardcoded date in legacy-file.ts:45 (from previous session)
- Hardcoded date in old-docs.md:12 (from previous session)

Action: Fixing current session violations now, then requesting guidance on historical violations.
```

## Session End Trigger - Step 5 Audit

**‚ö†Ô∏è MANDATORY: When user types "exit" or session end commands, you MUST:**

1. **DETECT** session end commands:
   - User types: `exit`, `done`, `complete`, `finish`, `end session`, `session complete`
   - User indicates they're done with the current task/session
   - User asks to wrap up or finalize work

2. **TRIGGER Step 5 (Post-Implementation Audit):**
   - **MUST** run complete Step 5 audit checklist (see 01-enforcement.mdc Step 5)
   - **MUST** fill out the complete Step 5 audit template
   - **MUST** verify all compliance checks
   - **MUST** update Memory Bank files (activeContext.md, progress.md, systemPatterns.md)
   - **MUST** list all files created/modified
   - **MUST** verify bug logging (if bugs were fixed)
   - **MUST** provide compliance status

3. **BEFORE ending session:**
   - Complete Step 5 audit
   - Fix any blocking issues found
   - Update Memory Bank files
   - Provide final compliance status

## Auto-Fix Display Requirement

**When you auto-fix violations during a task, you MUST:**

1. **Track the fix** using the enforcement system (automatic)
2. **Display fix summary** at the end of the task completion
3. **Reference AUTO_FIXES.md** for detailed fix information

**Fix Summary Format:**

```
## Auto-Fixes Applied During This Task

The following violations were auto-fixed:

1. **02-core.mdc** - Hardcoded date corrected
   - File: `docs/example.md:12`
   - Changed: `2025-01-27` ‚Üí `2025-11-30`

2. **06-error-resilience.mdc** - Empty catch block fixed
   - File: `apps/api/src/service.ts:45`
   - Added: Error logging and proper error handling

See `.cursor/enforcement/AUTO_FIXES.md` for complete details.
```

## Post-Task Auto-Fix Summary

**After completing any task where violations were auto-fixed:**

1. **Read** `.cursor/enforcement/AUTO_FIXES.md`
2. **Display** a summary of fixes in your response
3. **Explain** what violations were corrected and why

This helps track when rules are being broken and corrected automatically.

**Response Format when "exit" is detected:**

```
Session End Detected - Running Step 5 Audit

[Complete Step 5 audit template from 01-enforcement.mdc]

Session Complete - Compliance Status: [COMPLIANT/NON-COMPLIANT]
```

## Workflow

1. **Pre-Flight:** Read AGENT_STATUS.md FIRST (MANDATORY)
2. **If BLOCKED:** Follow blocking instructions above
3. **If COMPLIANT/WARNING:** Proceed with Step 0 (Memory Bank loading)
4. **Steps 1-5:** Follow enforcement pipeline (01-enforcement.mdc)
5. **Session End:** If user types "exit" or similar ‚Üí Run Step 5 audit
6. **Post-Action:** Verify status updated and no new violations

---

# Cursor automatically loads all .mdc files from .cursor/rules/ directory
# Rule files are loaded in alphabetical order (00-master.mdc first, then 01-enforcement.mdc, etc.)

# For manual reference, the rule files are:
# - .cursor/rules/00-master.mdc (Master rule with CI integration, REWARD_SCORE, pattern extraction)
# - .cursor/rules/01-enforcement.mdc (Mandatory 5-step enforcement pipeline)
# - .cursor/rules/02-core.mdc (Core philosophy, date handling, tech stack)
# - .cursor/rules/03-security.mdc (Security rules: tenant isolation, RLS, auth)
# - .cursor/rules/04-architecture.mdc (Monorepo structure, service boundaries)
# - .cursor/rules/05-data.mdc (Data contracts, state machines, layer sync)
# - .cursor/rules/06-error-resilience.mdc (Error handling, no silent failures)
# - .cursor/rules/07-observability.mdc (Structured logging, tracing, metrics)
# - .cursor/rules/08-backend.mdc (NestJS/Prisma patterns)
# - .cursor/rules/09-frontend.mdc (React/React Native architecture)
# - .cursor/rules/10-quality.mdc (Testing, coverage, performance)
# - .cursor/rules/11-operations.mdc (CI/CD, workflows, reward score)
# - .cursor/rules/12-tech-debt.mdc (Tech debt logging, TODO/FIXME)
# - .cursor/rules/13-ux-consistency.mdc (UI/UX coherence)
# - .cursor/rules/14-verification.mdc (Verification & testing standards)

# All rules are automatically loaded from .cursor/rules/*.mdc
# See .cursor/README.md for complete system documentation
