# ============================================================================
# VeroScore V3 - Auto-PR Configuration
# ============================================================================
# Main configuration file for Auto-PR system
# Last Updated: 2025-11-24
#
# This file contains team defaults. Individual developers can override
# settings in auto_pr_config.local.yaml (gitignored)
# ============================================================================

# VeroScore V3 System Configuration
veroscore:
  enabled: true  # Set to false to disable for specific developer
  version: "V3"
  fallback_to_legacy: false  # Use old system if VeroScore V3 fails

# PR Creation Thresholds
thresholds:
  min_files: 3  # Minimum files changed before creating PR
  min_lines: 50  # Minimum lines changed before creating PR
  max_wait_seconds: 300  # Maximum wait time (5 minutes) before creating PR
  debounce_seconds: 2.0  # Debounce time for file changes
  batch_size: 10  # Maximum changes to batch before creating PR

# File Exclusions
exclusions:
  patterns:
    # Build artifacts
    - "*.log"
    - "*.tmp"
    - "*.cache"
    - "dist/**"
    - "build/**"
    - ".next/**"
    - ".nuxt/**"
    - ".output/**"
    
    # Dependencies
    - "node_modules/**"
    - ".venv/**"
    - "venv/**"
    - "__pycache__/**"
    - "*.pyc"
    - "*.pyo"
    - ".pytest_cache/**"
    
    # Version control
    - ".git/**"
    - ".svn/**"
    - ".hg/**"
    
    # IDE files
    - ".idea/**"
    - ".vscode/**"
    - "*.swp"
    - "*.swo"
    - "*~"
    - ".DS_Store"
    
    # Environment files
    - ".env"
    - ".env.local"
    - ".env.*.local"
    
    # Test artifacts
    - "coverage/**"
    - ".nyc_output/**"
    - "*.lcov"
    
    # Documentation builds
    - "docs/_build/**"
    - "docs/.vuepress/dist/**"
    - "docs/.docusaurus/**"

# Author Detection
author:
  auto_detect: true  # Automatically detect author from git config
  fallback: "unknown"  # Fallback if detection fails

# GitHub Integration
github:
  # Branch naming format: auto-pr-{author}-{timestamp}-{uuid4[:8]}
  branch_prefix: "auto-pr"
  include_author: true
  include_timestamp: true
  include_uuid: true
  
  # PR Settings
  auto_merge:
    enabled: false  # MUST be explicitly set to true to enable
    min_score: 8.0  # Minimum score for auto-merge
    requirements:
      - pipeline_complete
      - no_critical_violations
      - branch_protected
      - approvals_required: 1
      - ci_checks_passing
    exclusions:
      - "**/migrations/**"
      - "**/auth/**"
      - "**/billing/**"
      - ".github/workflows/**"

# Supabase Configuration
supabase:
  # Connection will use environment variables:
  # - SUPABASE_URL
  # - SUPABASE_SECRET_KEY (for service role)
  # - SUPABASE_PUBLISHABLE_KEY (for client access)
  project_ref: ""  # Optional: for reference only
  schema_prefix: "veroscore_"  # Table prefix for VeroScore tables

# Scoring Configuration
scoring:
  # Category weights (must sum to reasonable total)
  weights:
    code_quality: 3
    test_coverage: 4
    documentation: 2
    architecture: 4
    security: 5
    rule_compliance: 5
  
  # Decision thresholds
  thresholds:
    auto_block: 0  # Score < 0 = auto-block
    review_required: 6  # Score 0-6 = review required
    auto_approve: 7  # Score 7+ = auto-approve (if pipeline complete)
  
  # Pipeline bonus
  pipeline_bonus: 5  # Bonus points for complete enforcement pipeline

# Detection Configuration
detection:
  # Detector penalties
  penalties:
    rls_violation: -100  # CRITICAL
    architecture_drift: -75  # CRITICAL
    hardcoded_secrets: -60  # CRITICAL
    security_vulnerability: -50  # CRITICAL
    logging_compliance: -30  # MEDIUM (missing structured logging)
    trace_propagation: -20  # MEDIUM (missing trace ID)
  
  # Performance targets
  performance:
    max_time_per_file_ms: 1000  # 1 second per file
    max_total_time_ms: 30000  # 30 seconds total
    cache_enabled: true
    parallel_execution: true
    max_workers: 4

# Reward Score Integration
reward_score:
  enabled: true  # Enable Reward Score integration
  auto_mark_eligible: true  # Automatically mark sessions as eligible when complete
  cross_reference: true  # Store Reward Score in VeroScore database

# Error Handling
error_handling:
  max_retries: 3
  retry_delays:
    - 5  # First retry after 5 seconds
    - 15  # Second retry after 15 seconds
    - 30  # Third retry after 30 seconds
  dead_letter_queue: true  # Store failed operations for manual review

# Orphaned Session Handling
orphan_handling:
  timeout_minutes: 30  # Auto-timeout after 30 minutes of inactivity
  auto_create_pr: true  # Create PR for orphaned sessions with changes
  cleanup_completed: true  # Auto-cleanup completed sessions after 90 days

# Logging Configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  structured: true  # Use structured JSON logging
  include_trace_id: true  # Include trace ID in all logs
  file: ".cursor/logs/auto_pr.log"  # Log file location

# Dashboard Configuration
dashboard:
  enabled: true
  port: 8080  # Dashboard API port
  refresh_interval_seconds: 5  # Real-time update interval
