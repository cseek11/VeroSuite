# BUG LOG

| Date | Area | Description | Status | Owner | Notes |      
|------|------|-------------|--------|-------|-------|      
| 2025-11-16 | Frontend/TypeScript | TYPESCRIPT_ANY_TYPES - Components used TypeScript `any` types instead of proper types, reducing type safety and potentially causing runtime errors. Found in event handlers, type assertions, and function return types. | fixed | AI Agent | Fixed in PaymentForm.tsx (5 `any` types) and SavedPaymentMethods.tsx (1 `any` type). Added proper type imports from @stripe/react-stripe-js, replaced type assertions with type guards, fixed return types to match union types. Error pattern documented in docs/error-patterns.md#TYPESCRIPT_ANY_TYPES. |
| 2025-11-16 | Backend/Database | TENANT_CONTEXT_NOT_FOUND - Backend service methods failed to retrieve tenant context when using `getCurrentTenantId()` due to Prisma connection pooling not preserving `SET LOCAL` session variables set by middleware. | fixed | AI Agent | Fixed by requiring `tenantId` parameter explicitly in service methods, removing `getCurrentTenantId()` fallback, and using `req.user?.tenantId || req.tenantId` pattern in controllers. Error pattern documented in docs/error-patterns.md#TENANT_CONTEXT_NOT_FOUND. |
| 2025-11-16 | Backend/Validation | INVALID_UUID_FORMAT - Frontend passed `accountId` parameter with malformed format (leading `:` and trailing `}` characters), causing Prisma UUID parsing errors. | fixed | AI Agent | Fixed by adding UUID validation and cleaning logic in service methods. Removes formatting characters, validates UUID format with regex, and gracefully skips account filter if UUID is invalid. Error pattern documented in docs/error-patterns.md#INVALID_UUID_FORMAT. |
| 2025-11-16 | Frontend/UI | TABS_COMPONENT_MISSING_CONTENT - Frontend component showed white page because `Tabs` component only renders navigation buttons, not the tab content. Component was missing logic to render active tab content. | fixed | AI Agent | Fixed by adding loading state, fixing Tabs prop (onChange to onValueChange), and adding tab content rendering logic. Error pattern documented in docs/error-patterns.md#TABS_COMPONENT_MISSING_CONTENT. |
| 2025-11-16 | Frontend/Testing | TEST_SELECTOR_MISMATCH - Frontend tests failed because they used incorrect selectors to find tab elements. Tests used `getByRole('button')` to find tabs, but tabs may not have `role="tab"` when using certain Tabs component implementations. | fixed | AI Agent | Fixed by using semantic ARIA roles (`getByRole('tab')`), adding fallback selectors, and making tests flexible to handle component implementation variations. Error pattern documented in docs/error-patterns.md#TEST_SELECTOR_MISMATCH. |
| 2025-11-17 | Frontend/Testing | TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS - Frontend tests failed with timeouts and "Found multiple elements" errors when testing async operations and button interactions. Tests used `getByText()` or `getByRole()` which fail when multiple elements match. | fixed | AI Agent | Fixed by using `queryAllBy*` for multiple elements, adding proper timeouts (3000-5000ms), using fallback strategies, and handling conditional rendering. Error pattern documented in docs/error-patterns.md#TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS. Regression tests added (53+ tests across 4 test files). |
| 2025-11-17 | Frontend/Scheduling | REACT_QUERY_API_FETCH_ERROR - ResourceTimeline component missing error handling for React Query API fetch failures. Errors from enhancedApi.technicians.list, enhancedApi.users.list, and enhancedApi.jobs.getByDateRange were not caught and displayed to users, causing silent failures. | fixed | AI Agent | Fixed during implementation. Error pattern documented in docs/error-patterns.md#REACT_QUERY_API_FETCH_ERROR. All errors now use structured logging (logger.error) and display user-friendly error messages. Regression tests added (4 error handling tests). |
| 2025-11-19 | CI/Reward Score Calculation | PENALTY_DOUBLE_APPLICATION - Penalty calculation applying both `failing_ci` (-4) and `missing_tests` (-2) penalties, resulting in -6 instead of -4. Type coercion issues in coverage percentage extraction and missing fallback logic for malformed coverage data. | fixed | AI Agent | Fixed in compute_reward_score.py calculate_penalties(). Made conditions mutually exclusive using if/elif. Added safe_get_percentage() helper with proper type coercion. Added fallback for missing coverage data. Improved condition logic to only apply penalties when appropriate. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-11-19 | CI/Security Scoring | SECURITY_REPO_WIDE_ISSUES - All PRs scored -3 for security, even when no new security issues were introduced. Semgrep scans entire repository, not just changed files, causing security findings from unchanged files to be counted as new issues. | fixed | AI Agent | Fixed by adding `result_in_changed_files()` function to filter Semgrep results. Only counts security findings in files actually changed by the PR. Added `skipped_by_diff_filter` counter for transparency. Normalized file paths for cross-platform compatibility. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-01-27 | CI/Workflows | PR_SYSTEM_ARTIFACT_PIPELINE_FAILURE - PR reward system had multiple silent failure points causing dashboard to never update. Scripts didn't verify file creation, verification steps didn't validate JSON, artifact downloads used continue-on-error: true, and no error propagation from scripts to workflows. | fixed | AI Agent | Fixed by adding file verification, JSON validation, proper exit codes, removing continue-on-error from critical steps, adding artifact verification, and using proper cross-workflow artifact download action. Related: docs/planning/PR_SYSTEM_FIX_AUDIT_REPORT.md. |
| 2025-11-22 | Backend/Auth | JWT_SECRET_LOADING_TIMING - JWT_SECRET environment variable checked at module load time (auth.module.ts line 14) before NestJS ConfigModule loads .env file, causing "JWT_SECRET environment variable is required" error even when variable is set. | fixed | AI Agent | Fixed by changing from JwtModule.register() to JwtModule.registerAsync() with ConfigService. This ensures environment variables are loaded before JWT module initialization. Error now includes traceId for debugging. Regression tests added (auth.module.spec.ts). |
| 2025-11-22 | Backend/Build | START_SCRIPT_PATH_MISMATCH - Start script in package.json looking for dist/main.js but NestJS build outputs to dist/apps/api/src/main.js due to monorepo structure preservation. | fixed | AI Agent | Fixed by updating package.json start scripts to use correct path: dist/apps/api/src/main.js. This ensures API server can start after build. Documented in API_START_SCRIPT_FIX.md. |
| 2025-11-22 | Frontend/TypeScript | TYPESCRIPT_ERROR_CLEANUP - Fixed 276 TypeScript compilation errors including unused React imports (60+), implicit any types (18), React UMD global errors (5), and unused variables (150+). Errors reduced from 2143 to 1867. | fixed | AI Agent | Fixed unused React imports after JSX transform, added explicit types for callback parameters, replaced React.* with direct imports, prefixed intentionally unused variables with _. Error pattern documented in docs/error-patterns.md#TYPESCRIPT_ERROR_CLEANUP. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_ABS_FUNCTION_SYNTAX - abs() function in quality.rego used old Rego syntax with multiple definitions (`abs(x) := x if { x >= 0 }`), causing "unexpected assign token" errors. Rego doesn't support multiple function definitions with conditions. | fixed | AI Agent | Removed abs() function entirely and inlined absolute value calculation where used (`decrease_abs := file.delta.statements * -1`). Error pattern documented in docs/error-patterns.md#OPA_REGO_ABS_FUNCTION_SYNTAX. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_MISSING_IMPORT_IN - 13 files (7 policy files + 6 test files) used `some x in xs` syntax without `import future.keywords.in`, causing "unexpected identifier token" errors. Required for modern Rego syntax. | fixed | AI Agent | Added `import future.keywords.in` to all affected files: architecture.rego, security.rego, data-integrity.rego, tech-debt.rego, infrastructure.rego, sample.rego, _template.rego, and 6 test files. Error pattern documented in docs/error-patterns.md#OPA_REGO_MISSING_IMPORT_IN. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_ENDSWITH_METHOD_SYNTAX - Used method syntax `file.path.endswith(".sql")` instead of function syntax `endswith(file.path, ".sql")`, causing "undefined function" errors. Rego endswith is a built-in function, not a method. | fixed | AI Agent | Fixed 3 locations in quality.rego (lines 421, 437, 441) to use function syntax: `endswith(file.path, ".sql")`. Error pattern documented in docs/error-patterns.md#OPA_REGO_ENDSWITH_METHOD_SYNTAX. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_WARN_RULE_SYNTAX - Multiple warn rules used old syntax `warn contains msg if` causing "conflicting rules" errors. Rego requires consistent rule syntax and doesn't allow multiple rules with same name using different syntax. | fixed | AI Agent | Consolidated all 4 warn rules into single location using modern syntax `warn[msg]`. Fixed R10, R16, R17, R18 warn rules. Error pattern documented in docs/error-patterns.md#OPA_REGO_WARN_RULE_SYNTAX. |
| 2025-11-23 | OPA/Rego Type Errors | OPA_REGO_SET_TO_ARRAY_CONVERSION - Violations and warnings defined as sets but concatenated as arrays, causing "invalid argument(s)" type errors. array.concat() expects arrays, not sets. | fixed | AI Agent | Fixed violations and warnings conversion using set comprehensions: `[msg | some msg in missing_unit_tests_violations]`. Fixed warnings conversion: `[msg | incomplete_test_coverage_warnings[msg]]`. Error pattern documented in docs/error-patterns.md#OPA_REGO_SET_TO_ARRAY_CONVERSION. |
| 2025-11-23 | OPA/Rego Test Syntax | OPA_REGO_DEPRECATED_ANY_FUNCTION - Test file used deprecated `any()` function (9 occurrences) causing "deprecated built-in function" errors. rego.v1 doesn't support any() function. | fixed | AI Agent | Replaced all `any([...])` calls with `count([...]) == 0` pattern in quality_r18_test.rego. Fixed 9 test cases. Error pattern documented in docs/error-patterns.md#OPA_REGO_DEPRECATED_ANY_FUNCTION. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_PYTHON_STYLE_CONDITIONAL - Used Python-style conditional (`3.0 if is_large_text else 4.5`) in ux-consistency.rego line 98, causing "unexpected if keyword" errors. Rego doesn't support ternary operators. | fixed | AI Agent | Created helper function `get_required_contrast_ratio()` with multiple rule definitions instead of ternary operator. Error pattern documented in docs/error-patterns.md#OPA_REGO_PYTHON_STYLE_CONDITIONAL. Related: docs/compliance-reports/HANDOFF-TO-NEXT-AGENT-R20.md. |
| 2025-11-23 | OPA/Rego Syntax | OPA_REGO_OR_OPERATOR - Used `||` (OR operator) in ux-consistency.rego line 189, causing "unexpected or token" errors. Rego doesn't support logical OR operators in expressions. | fixed | AI Agent | Split condition into two separate rules: one for critical components, one for user-facing components. Error pattern documented in docs/error-patterns.md#OPA_REGO_OR_OPERATOR. Related: docs/compliance-reports/HANDOFF-TO-NEXT-AGENT-R20.md. |
| 2025-11-23 | OPA/Rego Logic | OPA_REGO_EMPTY_STRING_DETECTION - Policy checked `not exemption.justification` which only detects missing fields, not empty strings (`""`). In Rego, empty strings are truthy, so missing field check fails when field exists but is empty. | fixed | AI Agent | Added separate rules to check both `not exemption.justification` (missing field) and `exemption.justification == ""` (empty string). Fixed R19-W06 and R19-W07 warnings. Error pattern documented in docs/error-patterns.md#OPA_REGO_EMPTY_STRING_DETECTION. Related: docs/compliance-reports/HANDOFF-TO-NEXT-AGENT-R20.md. |
| 2025-11-23 | OPA/Rego Set Iteration | OPA_REGO_SET_ITERATION_BUG - R21 file organization warnings not being collected correctly. Used `some warning in file_organization_warnings` which iterates over VALUES (returns `true`) instead of KEYS (warning messages). This prevented all 14 R21 warning types from being generated, causing 14/19 tests to fail. | fixed | AI Agent | Fixed by changing from `some warning in file_organization_warnings; msg := warning` to `file_organization_warnings[msg]` syntax. This correctly iterates over set keys (warning messages) instead of values. All 19 R21 tests now passing. Error pattern documented in docs/error-patterns.md#OPA_REGO_SET_ITERATION_BUG. Related: docs/compliance-reports/R21-FINAL-FIX-SUMMARY.md. |
| 2025-11-23 | OPA/Rego String Matching | OPA_REGO_CASE_SENSITIVE_CONTAINS - Test assertion `contains(warning, "reusable component")` failed because warning message used "Reusable component" (capital R). Rego `contains()` function is case-sensitive, causing test failure even though warning was generated correctly. | fixed | AI Agent | Fixed by changing warning message from "Reusable component" to "reusable component" (lowercase) to match test assertion. Alternatively could have changed test to use case-insensitive check. Error pattern documented in docs/error-patterns.md#OPA_REGO_CASE_SENSITIVE_CONTAINS. Related: docs/compliance-reports/R21-FINAL-FIX-SUMMARY.md. |
| 2025-11-23 | OPA/Rego Set Iteration | OPA_REGO_SET_ITERATION_BUG - R23 naming convention warnings not being collected correctly in documentation.rego. Used `some msg in naming_convention_warnings` which iterates over VALUES (returns `true`) instead of KEYS (warning messages). This prevented all 5 R23 warning types from being generated, causing test failures. | fixed | AI Agent | Fixed by changing from `some msg in naming_convention_warnings` to `naming_convention_warnings[msg]` syntax. This correctly iterates over set keys (warning messages) instead of values. All 15 R23 tests now passing. Error pattern documented in docs/error-patterns.md#OPA_REGO_SET_ITERATION_BUG. Related: docs/compliance-reports/R23-IMPLEMENTATION-COMPLETE.md. |

