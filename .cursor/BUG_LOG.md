# BUG LOG

| Date | Area | Description | Status | Owner | Notes |      
|------|------|-------------|--------|-------|-------|      
| 2025-11-16 | Frontend/TypeScript | TYPESCRIPT_ANY_TYPES - Components used TypeScript `any` types instead of proper types, reducing type safety and potentially causing runtime errors. Found in event handlers, type assertions, and function return types. | fixed | AI Agent | Fixed in PaymentForm.tsx (5 `any` types) and SavedPaymentMethods.tsx (1 `any` type). Added proper type imports from @stripe/react-stripe-js, replaced type assertions with type guards, fixed return types to match union types. Error pattern documented in docs/error-patterns.md#TYPESCRIPT_ANY_TYPES. |
| 2025-11-16 | Backend/Database | TENANT_CONTEXT_NOT_FOUND - Backend service methods failed to retrieve tenant context when using `getCurrentTenantId()` due to Prisma connection pooling not preserving `SET LOCAL` session variables set by middleware. | fixed | AI Agent | Fixed by requiring `tenantId` parameter explicitly in service methods, removing `getCurrentTenantId()` fallback, and using `req.user?.tenantId || req.tenantId` pattern in controllers. Error pattern documented in docs/error-patterns.md#TENANT_CONTEXT_NOT_FOUND. |
| 2025-11-16 | Backend/Validation | INVALID_UUID_FORMAT - Frontend passed `accountId` parameter with malformed format (leading `:` and trailing `}` characters), causing Prisma UUID parsing errors. | fixed | AI Agent | Fixed by adding UUID validation and cleaning logic in service methods. Removes formatting characters, validates UUID format with regex, and gracefully skips account filter if UUID is invalid. Error pattern documented in docs/error-patterns.md#INVALID_UUID_FORMAT. |
| 2025-11-16 | Frontend/UI | TABS_COMPONENT_MISSING_CONTENT - Frontend component showed white page because `Tabs` component only renders navigation buttons, not the tab content. Component was missing logic to render active tab content. | fixed | AI Agent | Fixed by adding loading state, fixing Tabs prop (onChange to onValueChange), and adding tab content rendering logic. Error pattern documented in docs/error-patterns.md#TABS_COMPONENT_MISSING_CONTENT. |
| 2025-11-16 | Frontend/Testing | TEST_SELECTOR_MISMATCH - Frontend tests failed because they used incorrect selectors to find tab elements. Tests used `getByRole('button')` to find tabs, but tabs may not have `role="tab"` when using certain Tabs component implementations. | fixed | AI Agent | Fixed by using semantic ARIA roles (`getByRole('tab')`), adding fallback selectors, and making tests flexible to handle component implementation variations. Error pattern documented in docs/error-patterns.md#TEST_SELECTOR_MISMATCH. |
| 2025-11-17 | Frontend/Testing | TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS - Frontend tests failed with timeouts and "Found multiple elements" errors when testing async operations and button interactions. Tests used `getByText()` or `getByRole()` which fail when multiple elements match. | fixed | AI Agent | Fixed by using `queryAllBy*` for multiple elements, adding proper timeouts (3000-5000ms), using fallback strategies, and handling conditional rendering. Error pattern documented in docs/error-patterns.md#TEST_ASYNC_TIMEOUT_MULTIPLE_ELEMENTS. Regression tests added (53+ tests across 4 test files). |
| 2025-11-17 | Frontend/Scheduling | REACT_QUERY_API_FETCH_ERROR - ResourceTimeline component missing error handling for React Query API fetch failures. Errors from enhancedApi.technicians.list, enhancedApi.users.list, and enhancedApi.jobs.getByDateRange were not caught and displayed to users, causing silent failures. | fixed | AI Agent | Fixed during implementation. Error pattern documented in docs/error-patterns.md#REACT_QUERY_API_FETCH_ERROR. All errors now use structured logging (logger.error) and display user-friendly error messages. Regression tests added (4 error handling tests). |
| 2025-11-19 | CI/Reward Score Calculation | PENALTY_DOUBLE_APPLICATION - Penalty calculation applying both `failing_ci` (-4) and `missing_tests` (-2) penalties, resulting in -6 instead of -4. Type coercion issues in coverage percentage extraction and missing fallback logic for malformed coverage data. | fixed | AI Agent | Fixed in compute_reward_score.py calculate_penalties(). Made conditions mutually exclusive using if/elif. Added safe_get_percentage() helper with proper type coercion. Added fallback for missing coverage data. Improved condition logic to only apply penalties when appropriate. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-11-19 | CI/Security Scoring | SECURITY_REPO_WIDE_ISSUES - All PRs scored -3 for security, even when no new security issues were introduced. Semgrep scans entire repository, not just changed files, causing security findings from unchanged files to be counted as new issues. | fixed | AI Agent | Fixed by adding `result_in_changed_files()` function to filter Semgrep results. Only counts security findings in files actually changed by the PR. Added `skipped_by_diff_filter` counter for transparency. Normalized file paths for cross-platform compatibility. Related: docs/metrics/REWARD_SCORE_FIXES.md. |
| 2025-01-27 | CI/Workflows | PR_SYSTEM_ARTIFACT_PIPELINE_FAILURE - PR reward system had multiple silent failure points causing dashboard to never update. Scripts didn't verify file creation, verification steps didn't validate JSON, artifact downloads used continue-on-error: true, and no error propagation from scripts to workflows. | fixed | AI Agent | Fixed by adding file verification, JSON validation, proper exit codes, removing continue-on-error from critical steps, adding artifact verification, and using proper cross-workflow artifact download action. Related: docs/planning/PR_SYSTEM_FIX_AUDIT_REPORT.md. |
| 2025-11-22 | Backend/Auth | JWT_SECRET_LOADING_TIMING - JWT_SECRET environment variable checked at module load time (auth.module.ts line 14) before NestJS ConfigModule loads .env file, causing "JWT_SECRET environment variable is required" error even when variable is set. | fixed | AI Agent | Fixed by changing from JwtModule.register() to JwtModule.registerAsync() with ConfigService. This ensures environment variables are loaded before JWT module initialization. Error now includes traceId for debugging. Regression tests added (auth.module.spec.ts). |
| 2025-11-22 | Backend/Build | START_SCRIPT_PATH_MISMATCH - Start script in package.json looking for dist/main.js but NestJS build outputs to dist/apps/api/src/main.js due to monorepo structure preservation. | fixed | AI Agent | Fixed by updating package.json start scripts to use correct path: dist/apps/api/src/main.js. This ensures API server can start after build. Documented in API_START_SCRIPT_FIX.md. |
| 2025-11-22 | Frontend/TypeScript | TYPESCRIPT_ERROR_CLEANUP - Fixed 276 TypeScript compilation errors including unused React imports (60+), implicit any types (18), React UMD global errors (5), and unused variables (150+). Errors reduced from 2143 to 1867. | fixed | AI Agent | Fixed unused React imports after JSX transform, added explicit types for callback parameters, replaced React.* with direct imports, prefixed intentionally unused variables with _. Error pattern documented in docs/error-patterns.md#TYPESCRIPT_ERROR_CLEANUP. |

