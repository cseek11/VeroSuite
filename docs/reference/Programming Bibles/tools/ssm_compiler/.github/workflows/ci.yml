name: CI - SSM Compiler Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # Add any required dependencies here
    
    - name: Run comprehensive tests
      working-directory: docs/reference/Rego_OPM_BIBLE/opa_ssm_compiler
      run: |
        python tests/test_comprehensive.py
    
    - name: Test compilation
      working-directory: docs/reference/Rego_OPM_BIBLE/opa_ssm_compiler
      run: |
        if [ -f ../rego_opa_bible.md ]; then
          python main.py ../rego_opa_bible.md ../test_output.ssm.md --v3
          python cli/biblec.py validate ../test_output.ssm.md
          python cli/biblec.py stats ../test_output.ssm.md
        else
          echo "Warning: rego_opa_bible.md not found, skipping full compilation test"
        fi
    
    - name: Check golden snapshots
      working-directory: docs/reference/Rego_OPM_BIBLE/opa_ssm_compiler
      run: |
        if [ -d tests/golden ]; then
          echo "Golden snapshots found"
          ls -la tests/golden/
        else
          echo "No golden snapshots yet"
        fi

