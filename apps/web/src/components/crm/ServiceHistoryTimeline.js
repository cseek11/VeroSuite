"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = ServiceHistoryTimeline;
var jsx_runtime_1 = require("react/jsx-runtime");
var react_1 = require("react");
var LoadingSpinner_1 = require("@/components/LoadingSpinner");
var Card_1 = __importDefault(require("@/components/ui/Card"));
var Button_1 = __importDefault(require("@/components/ui/Button"));
var ui_1 = require("@/components/ui");
var lucide_react_1 = require("lucide-react");
function ServiceHistoryTimeline(_a) {
    var serviceHistory = _a.serviceHistory, isLoading = _a.isLoading;
    var _b = (0, react_1.useState)(null), selectedService = _b[0], setSelectedService = _b[1];
    var _c = (0, react_1.useState)(false), showPhotoModal = _c[0], setShowPhotoModal = _c[1];
    var _d = (0, react_1.useState)([]), selectedPhotos = _d[0], setSelectedPhotos = _d[1];
    var _e = (0, react_1.useState)(0), photoIndex = _e[0], setPhotoIndex = _e[1];
    if (isLoading) {
        return ((0, jsx_runtime_1.jsx)(Card_1.default, { className: "p-6", children: (0, jsx_runtime_1.jsx)(LoadingSpinner_1.LoadingSpinner, { text: "Loading service history..." }) }));
    }
    var getServiceTypeColor = function (type) {
        switch (type.toLowerCase()) {
            case 'prevention': return 'bg-green-100 text-green-800';
            case 'treatment': return 'bg-orange-100 text-orange-800';
            case 'emergency': return 'bg-red-100 text-red-800';
            case 'inspection': return 'bg-blue-100 text-blue-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };
    var getStatusColor = function (status) {
        switch (status.toLowerCase()) {
            case 'completed': return 'bg-green-100 text-green-800';
            case 'scheduled': return 'bg-blue-100 text-blue-800';
            case 'cancelled': return 'bg-red-100 text-red-800';
            case 'in_progress': return 'bg-yellow-100 text-yellow-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };
    var getEffectivenessColor = function (score) {
        if (score >= 8)
            return 'bg-green-500';
        if (score >= 6)
            return 'bg-yellow-500';
        return 'bg-red-500';
    };
    var formatDate = function (dateString) {
        return new Date(dateString).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    };
    var formatTime = function (dateString) {
        return new Date(dateString).toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit'
        });
    };
    var handlePhotoClick = function (photos, startIndex) {
        if (startIndex === void 0) { startIndex = 0; }
        setSelectedPhotos(photos);
        setPhotoIndex(startIndex);
        setShowPhotoModal(true);
    };
    var nextPhoto = function () {
        setPhotoIndex(function (prev) { return (prev + 1) % selectedPhotos.length; });
    };
    var prevPhoto = function () {
        setPhotoIndex(function (prev) { return (prev - 1 + selectedPhotos.length) % selectedPhotos.length; });
    };
    // Mock predictive analytics data
    var predictiveData = {
        nextServiceRecommended: '2024-02-15',
        pestPressureTrend: 'increasing',
        treatmentEffectiveness: 85,
        seasonalRisk: 'medium'
    };
    return ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between mb-6", children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 3, className: "text-slate-900", children: "Service History" }), (0, jsx_runtime_1.jsxs)(Button_1.default, { variant: "outline", size: "sm", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: "h-4 w-4 mr-1" }), "Schedule Next Service"] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 mb-3", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.TrendingUp, { className: "h-5 w-5 text-blue-600" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-slate-900", children: "Predictive Insights" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Next Service" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-blue-900 font-semibold", children: formatDate(predictiveData.nextServiceRecommended) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Pest Pressure" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-center gap-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.TrendingUp, { className: "h-4 w-4 ".concat(predictiveData.pestPressureTrend === 'increasing' ? 'text-red-500' : 'text-green-500') }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-slate-900 font-semibold capitalize", children: predictiveData.pestPressureTrend })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Effectiveness" }), (0, jsx_runtime_1.jsxs)(ui_1.Heading, { level: 4, className: "text-green-900 font-semibold", children: [predictiveData.treatmentEffectiveness, "%"] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Seasonal Risk" }), (0, jsx_runtime_1.jsx)(ui_1.Badge, { variant: "outline", className: predictiveData.seasonalRisk === 'high' ? 'bg-red-100 text-red-800 border-red-300' :
                                                    predictiveData.seasonalRisk === 'medium' ? 'bg-yellow-100 text-yellow-800 border-yellow-300' :
                                                        'bg-green-100 text-green-800 border-green-300', children: predictiveData.seasonalRisk })] })] })] }), (0, jsx_runtime_1.jsx)("div", { className: "space-y-4", children: serviceHistory.length === 0 ? ((0, jsx_runtime_1.jsxs)("div", { className: "text-center py-8", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: "h-12 w-12 text-slate-400 mx-auto mb-4" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-slate-900 mb-2", children: "No Service History" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", className: "text-slate-600", children: "This customer hasn't had any services yet." })] })) : (serviceHistory.map(function (service, index) {
                            var _a, _b, _c, _d;
                            return ((0, jsx_runtime_1.jsxs)("div", { className: "relative border border-slate-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer", onClick: function () { return setSelectedService(service); }, children: [index < serviceHistory.length - 1 && ((0, jsx_runtime_1.jsx)("div", { className: "absolute left-6 top-12 w-0.5 h-8 bg-slate-300" })), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-4", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex flex-col items-center", children: (0, jsx_runtime_1.jsx)("div", { className: "w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: "h-6 w-6 text-blue-600" }) }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-start justify-between mb-2", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-slate-900", children: service.service_type }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600", children: [formatDate(service.service_date), " at ", formatTime(service.service_date)] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(ui_1.Badge, { variant: "outline", className: getServiceTypeColor(service.service_type), children: service.service_type }), (0, jsx_runtime_1.jsx)(ui_1.Badge, { variant: "outline", className: getStatusColor(service.status), children: service.status })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-4 mb-3", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.DollarSign, { className: "h-4 w-4 text-slate-400" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600", children: ["$", service.cost.toFixed(2)] })] }), service.effectiveness_score && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Star, { className: "h-4 w-4 text-yellow-500" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600", children: [service.effectiveness_score, "/10"] })] })), service.weather_conditions && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Cloud, { className: "h-4 w-4 text-slate-400" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: service.weather_conditions })] })), service.temperature && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Thermometer, { className: "h-4 w-4 text-red-400" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600", children: [service.temperature, "\u00B0F"] })] }))] }), (((_a = service.before_photos) === null || _a === void 0 ? void 0 : _a.length) || ((_b = service.after_photos) === null || _b === void 0 ? void 0 : _b.length)) && ((0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2 mb-3", children: [((_c = service.before_photos) === null || _c === void 0 ? void 0 : _c.length) && ((0, jsx_runtime_1.jsxs)(Button_1.default, { variant: "outline", size: "sm", onClick: function () { return handlePhotoClick(service.before_photos, 0); }, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Camera, { className: "h-4 w-4 mr-1" }), "Before (", service.before_photos.length, ")"] })), ((_d = service.after_photos) === null || _d === void 0 ? void 0 : _d.length) && ((0, jsx_runtime_1.jsxs)(Button_1.default, { variant: "outline", size: "sm", onClick: function () { return handlePhotoClick(service.after_photos, 0); }, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Camera, { className: "h-4 w-4 mr-1" }), "After (", service.after_photos.length, ")"] }))] })), service.treatments_applied && ((0, jsx_runtime_1.jsx)("div", { className: "bg-slate-50 p-3 rounded-lg", children: (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-700", children: [(0, jsx_runtime_1.jsx)("strong", { children: "Treatments Applied:" }), " ", service.treatments_applied] }) })), service.technician_notes && ((0, jsx_runtime_1.jsx)("div", { className: "mt-2", children: (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600 line-clamp-2", children: [(0, jsx_runtime_1.jsx)("strong", { children: "Notes:" }), " ", service.technician_notes] }) }))] })] })] }, service.id));
                        })) })] }), (0, jsx_runtime_1.jsx)(ui_1.Dialog, { open: !!selectedService, onOpenChange: function (open) { return !open && setSelectedService(null); }, children: (0, jsx_runtime_1.jsxs)(ui_1.DialogContent, { className: "max-w-2xl", children: [(0, jsx_runtime_1.jsx)(ui_1.DialogHeader, { children: (0, jsx_runtime_1.jsx)(ui_1.DialogTitle, { children: "Service Details - ".concat(selectedService === null || selectedService === void 0 ? void 0 : selectedService.service_type) }) }), selectedService && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-2 gap-4", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Date" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", children: formatDate(selectedService.service_date) })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Cost" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "body", children: ["$", selectedService.cost.toFixed(2)] })] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Status" }), (0, jsx_runtime_1.jsx)(ui_1.Badge, { variant: "default", className: getStatusColor(selectedService.status), children: selectedService.status })] }), selectedService.effectiveness_score && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600", children: "Effectiveness" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)("div", { className: "w-full bg-gray-200 rounded-full h-2 flex-1", children: (0, jsx_runtime_1.jsx)("div", { className: "h-2 rounded-full ".concat(getEffectivenessColor(selectedService.effectiveness_score)), style: { width: "".concat(selectedService.effectiveness_score * 10, "%") } }) }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", children: [selectedService.effectiveness_score, "/10"] })] })] }))] }), selectedService.treatments_applied && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600 mb-2", children: "Treatments Applied" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", children: selectedService.treatments_applied })] })), selectedService.technician_notes && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600 mb-2", children: "Technician Notes" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", children: selectedService.technician_notes })] })), (selectedService.weather_conditions || selectedService.temperature || selectedService.humidity) && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-slate-600 mb-2", children: "Weather Conditions" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-4", children: [selectedService.weather_conditions && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Cloud, { className: "h-4 w-4 text-slate-400" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", children: selectedService.weather_conditions })] })), selectedService.temperature && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Thermometer, { className: "h-4 w-4 text-red-400" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", children: [selectedService.temperature, "\u00B0F"] })] })), selectedService.humidity && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Droplets, { className: "h-4 w-4 text-blue-400" }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", children: [selectedService.humidity, "%"] })] }))] })] }))] }))] }) }), (0, jsx_runtime_1.jsx)(ui_1.Dialog, { open: showPhotoModal, onOpenChange: function (open) { return !open && setShowPhotoModal(false); }, children: (0, jsx_runtime_1.jsxs)(ui_1.DialogContent, { className: "max-w-4xl", children: [(0, jsx_runtime_1.jsx)(ui_1.DialogHeader, { children: (0, jsx_runtime_1.jsx)(ui_1.DialogTitle, { children: "Service Photos" }) }), (0, jsx_runtime_1.jsx)("div", { className: "space-y-4", children: selectedPhotos.length > 0 && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)("div", { className: "relative", children: [(0, jsx_runtime_1.jsx)("img", { src: selectedPhotos[photoIndex], alt: "Service photo ".concat(photoIndex + 1), className: "w-full h-96 object-cover rounded-lg" }), selectedPhotos.length > 1 && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(Button_1.default, { variant: "outline", size: "sm", onClick: prevPhoto, className: "absolute left-4 top-1/2 transform -translate-y-1/2", children: "\u2190" }), (0, jsx_runtime_1.jsx)(Button_1.default, { variant: "outline", size: "sm", onClick: nextPhoto, className: "absolute right-4 top-1/2 transform -translate-y-1/2", children: "\u2192" })] }))] }), (0, jsx_runtime_1.jsx)("div", { className: "text-center", children: (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-slate-600", children: ["Photo ", photoIndex + 1, " of ", selectedPhotos.length] }) }), selectedPhotos.length > 1 && ((0, jsx_runtime_1.jsx)("div", { className: "flex gap-2 justify-center", children: selectedPhotos.map(function (photo, index) { return ((0, jsx_runtime_1.jsx)("button", { onClick: function () { return setPhotoIndex(index); }, className: "w-16 h-16 rounded-lg overflow-hidden border-2 ".concat(index === photoIndex ? 'border-blue-500' : 'border-slate-200'), children: (0, jsx_runtime_1.jsx)("img", { src: photo, alt: "Thumbnail ".concat(index + 1), className: "w-full h-full object-cover" }) }, index)); }) }))] })) })] }) })] }));
}
