"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = AutoLayoutManager;
var jsx_runtime_1 = require("react/jsx-runtime");
var react_1 = require("react");
var lucide_react_1 = require("lucide-react");
var useAdvancedAutoLayout_1 = require("@/hooks/useAdvancedAutoLayout");
var Card_1 = __importDefault(require("@/components/ui/Card"));
var Button_1 = __importDefault(require("@/components/ui/Button"));
var ui_1 = require("@/components/ui");
var utils_1 = require("@/lib/utils");
function AutoLayoutManager(_a) {
    var isOpen = _a.isOpen, onClose = _a.onClose, userId = _a.userId, currentCards = _a.currentCards, onLayoutChange = _a.onLayoutChange;
    var _b = (0, react_1.useState)('insights'), activeTab = _b[0], setActiveTab = _b[1];
    var _c = (0, react_1.useState)(null), selectedSuggestion = _c[0], setSelectedSuggestion = _c[1];
    var _d = (0, useAdvancedAutoLayout_1.useAdvancedAutoLayout)({
        userId: userId,
        currentCards: currentCards,
        onLayoutChange: onLayoutChange
    }), _usagePatterns = _d.usagePatterns, cardRelationships = _d.cardRelationships, layoutSuggestions = _d.layoutSuggestions, optimizations = _d.optimizations, isLearning = _d.isLearning, learningProgress = _d.learningProgress, layoutInsights = _d.layoutInsights, trackUsage = _d.trackUsage, applyOptimization = _d.applyOptimization, autoArrange = _d.autoArrange, learnFromBehavior = _d.learnFromBehavior, getCardUsageStats = _d.getCardUsageStats, updateOptimization = _d.updateOptimization, exportUsageData = _d.exportUsageData;
    var getImpactColor = function (impact) {
        switch (impact) {
            case 'high': return 'bg-red-100 text-red-800';
            case 'medium': return 'bg-yellow-100 text-yellow-800';
            case 'low': return 'bg-green-100 text-green-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };
    var getConfidenceColor = function (confidence) {
        if (confidence >= 0.8)
            return 'bg-green-100 text-green-800';
        if (confidence >= 0.6)
            return 'bg-yellow-100 text-yellow-800';
        return 'bg-red-100 text-red-800';
    };
    var handleApplySuggestion = (0, react_1.useCallback)(function (suggestion) {
        applyOptimization(suggestion.id);
        setSelectedSuggestion(null);
    }, [applyOptimization]);
    var handleAutoArrange = (0, react_1.useCallback)(function (mode) {
        autoArrange(mode);
        trackUsage('system', 'interact');
    }, [autoArrange, trackUsage]);
    if (!isOpen)
        return null;
    return ((0, jsx_runtime_1.jsxs)("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50", children: [(0, jsx_runtime_1.jsxs)("div", { className: "bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[95vh] overflow-hidden", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between p-6 border-b border-gray-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Brain, { className: "h-6 w-6 text-purple-600" }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("h2", { className: "text-xl font-semibold text-gray-900", children: "Advanced Auto-Layout" }), (0, jsx_runtime_1.jsx)("p", { className: "text-sm text-gray-500", children: "AI-powered layout optimization and usage pattern learning" })] })] }), (0, jsx_runtime_1.jsx)("button", { onClick: onClose, className: "text-gray-400 hover:text-gray-600 transition-colors", children: (0, jsx_runtime_1.jsx)(lucide_react_1.X, { className: "w-6 h-6" }) })] }), (0, jsx_runtime_1.jsx)("div", { className: "flex border-b border-gray-200", children: [
                            { id: 'insights', name: 'Insights', icon: lucide_react_1.Eye },
                            { id: 'suggestions', name: 'Suggestions', icon: lucide_react_1.Target },
                            { id: 'optimizations', name: 'Optimizations', icon: lucide_react_1.Settings },
                            { id: 'analytics', name: 'Analytics', icon: lucide_react_1.BarChart3 }
                        ].map(function (tab) { return ((0, jsx_runtime_1.jsxs)("button", { onClick: function () { return setActiveTab(tab.id); }, className: (0, utils_1.cn)("flex items-center space-x-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors", activeTab === tab.id
                                ? "border-purple-500 text-purple-600"
                                : "border-transparent text-gray-500 hover:text-gray-700"), children: [(0, jsx_runtime_1.jsx)(tab.icon, { className: "w-4 h-4" }), (0, jsx_runtime_1.jsx)("span", { children: tab.name })] }, tab.id)); }) }), (0, jsx_runtime_1.jsxs)("div", { className: "p-6 overflow-y-auto max-h-[calc(95vh-200px)]", children: [activeTab === 'insights' && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4", children: [(0, jsx_runtime_1.jsxs)(Button_1.default, { onClick: function () { return handleAutoArrange('smart'); }, className: "h-20 flex flex-col items-center justify-center gap-2", variant: "primary", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Zap, { className: "w-6 h-6" }), (0, jsx_runtime_1.jsx)("span", { children: "Smart Arrange" })] }), (0, jsx_runtime_1.jsxs)(Button_1.default, { onClick: function () { return handleAutoArrange('grid'); }, className: "h-20 flex flex-col items-center justify-center gap-2", variant: "outline", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Grid, { className: "w-6 h-6" }), (0, jsx_runtime_1.jsx)("span", { children: "Grid Layout" })] }), (0, jsx_runtime_1.jsxs)(Button_1.default, { onClick: function () { return handleAutoArrange('compact'); }, className: "h-20 flex flex-col items-center justify-center gap-2", variant: "outline", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Layout, { className: "w-6 h-6" }), (0, jsx_runtime_1.jsx)("span", { children: "Compact Layout" })] })] }), isLearning && ((0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-6 bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-3 mb-4", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Brain, { className: "w-6 h-6 text-purple-600 animate-pulse" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-purple-900", children: "Learning from Usage Patterns" })] }), (0, jsx_runtime_1.jsx)("div", { className: "w-full bg-purple-200 rounded-full h-2 mb-2", children: (0, jsx_runtime_1.jsx)("div", { className: "bg-purple-600 h-2 rounded-full transition-all duration-300", style: { width: "".concat(learningProgress, "%") } }) }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-purple-700", children: [learningProgress.toFixed(0), "% complete"] })] })), (0, jsx_runtime_1.jsxs)("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4", children: [(0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-4 bg-blue-50 border-blue-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 mb-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Users, { className: "w-4 h-4 text-blue-600" }), (0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-blue-800", children: "Active Cards" })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-blue-900", children: layoutInsights.activeCards })] }), (0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-4 bg-green-50 border-green-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 mb-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.TrendingUp, { className: "w-4 h-4 text-green-600" }), (0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-green-800", children: "Total Interactions" })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-green-900", children: layoutInsights.totalInteractions })] }), (0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-4 bg-purple-50 border-purple-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 mb-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Target, { className: "w-4 h-4 text-purple-600" }), (0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-purple-800", children: "Suggestions" })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-purple-900", children: layoutInsights.suggestionCount })] }), (0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-4 bg-orange-50 border-orange-200", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 mb-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.BarChart3, { className: "w-4 h-4 text-orange-600" }), (0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium text-orange-800", children: "Relationships" })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-2xl font-bold text-orange-900", children: layoutInsights.relationshipCount })] })] }), layoutInsights.mostUsedCard && ((0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-6", children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900 mb-4", children: "Most Frequently Used Card" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex-1", children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", className: "font-medium text-gray-900", children: layoutInsights.mostUsedCard.id }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-600", children: ["Used ", layoutInsights.mostUsedCard.count, " times"] })] }), (0, jsx_runtime_1.jsx)(ui_1.Badge, { variant: "default", className: "bg-green-100 text-green-800", children: "Top Performer" })] })] })), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-4", children: [(0, jsx_runtime_1.jsxs)(Button_1.default, { onClick: learnFromBehavior, disabled: isLearning, className: "flex items-center gap-2", children: [isLearning ? (0, jsx_runtime_1.jsx)(lucide_react_1.Pause, { className: "w-4 h-4" }) : (0, jsx_runtime_1.jsx)(lucide_react_1.Play, { className: "w-4 h-4" }), isLearning ? 'Learning...' : 'Learn from Behavior'] }), (0, jsx_runtime_1.jsxs)(Button_1.default, { onClick: exportUsageData, variant: "outline", className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Download, { className: "w-4 h-4" }), "Export Data"] })] })] })), activeTab === 'suggestions' && ((0, jsx_runtime_1.jsx)("div", { className: "space-y-6", children: layoutSuggestions.length === 0 ? ((0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-8 text-center", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Target, { className: "w-12 h-12 text-gray-400 mx-auto mb-4" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900 mb-2", children: "No Suggestions Available" }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600 mb-4", children: "Use the dashboard more to generate intelligent layout suggestions" }), (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: learnFromBehavior, disabled: isLearning, children: "Generate Suggestions" })] })) : ((0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: layoutSuggestions.map(function (suggestion) { return ((0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-6 hover:shadow-md transition-shadow", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-start justify-between mb-4", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [suggestion.type === 'prioritize_frequent' && (0, jsx_runtime_1.jsx)(lucide_react_1.TrendingUp, { className: "w-5 h-5 text-green-600" }), suggestion.type === 'group_related' && (0, jsx_runtime_1.jsx)(lucide_react_1.Users, { className: "w-5 h-5 text-blue-600" }), suggestion.type === 'optimize_spacing' && (0, jsx_runtime_1.jsx)(lucide_react_1.Layout, { className: "w-5 h-5 text-orange-600" }), (0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900", children: suggestion.title })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsxs)(ui_1.Badge, { variant: "default", className: getImpactColor(suggestion.impact), children: [suggestion.impact, " impact"] }), (0, jsx_runtime_1.jsxs)(ui_1.Badge, { variant: "default", className: getConfidenceColor(suggestion.confidence), children: [Math.round(suggestion.confidence * 100), "% confidence"] })] })] }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600 mb-4", children: suggestion.description }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-2 mb-4", children: [(0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "font-medium text-gray-700", children: ["Changes (", suggestion.changes.length, "):"] }), suggestion.changes.slice(0, 3).map(function (change, index) { return ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2 text-sm text-gray-600", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.CheckCircle, { className: "w-3 h-3 text-green-500" }), (0, jsx_runtime_1.jsxs)("span", { children: [change.cardId, ": ", change.reason] })] }, index)); }), suggestion.changes.length > 3 && ((0, jsx_runtime_1.jsxs)("div", { className: "text-sm text-gray-500", children: ["+", suggestion.changes.length - 3, " more changes"] }))] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsx)(Button_1.default, { onClick: function () { return handleApplySuggestion(suggestion); }, size: "sm", className: "flex-1", children: "Apply" }), (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: function () { return setSelectedSuggestion(suggestion); }, variant: "outline", size: "sm", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Eye, { className: "w-4 h-4" }) })] })] }, suggestion.id)); }) })) })), activeTab === 'optimizations' && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900", children: "Layout Optimization Algorithms" }), (0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-6", children: optimizations.map(function (optimization) { return ((0, jsx_runtime_1.jsxs)(Card_1.default, { className: "p-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-start justify-between mb-4", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900 mb-2", children: optimization.name }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600", children: optimization.description })] }), (0, jsx_runtime_1.jsx)("div", { className: "flex items-center gap-2", children: (0, jsx_runtime_1.jsx)("input", { type: "checkbox", checked: optimization.enabled, onChange: function (e) { return updateOptimization(optimization.id, { enabled: e.target.checked }); }, className: "w-4 h-4 text-purple-600 rounded focus:ring-purple-500" }) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "space-y-3", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-700 mb-1", children: ["Weight: ", Math.round(optimization.weight * 100), "%"] }), (0, jsx_runtime_1.jsx)("input", { type: "range", min: "0", max: "1", step: "0.1", value: optimization.weight, onChange: function (e) { return updateOptimization(optimization.id, { weight: parseFloat(e.target.value) }); }, className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-sm text-gray-500", children: ["Algorithm: ", optimization.algorithm] })] })] }, optimization.id)); }) })] })), activeTab === 'analytics' && ((0, jsx_runtime_1.jsxs)("div", { className: "space-y-6", children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900", children: "Usage Analytics" }), (0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 gap-4", children: currentCards.map(function (card) {
                                            var stats = getCardUsageStats(card.id);
                                            return ((0, jsx_runtime_1.jsx)(Card_1.default, { className: "p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "body", className: "font-medium text-gray-900", children: [card.id, " (", card.type, ")"] }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-600", children: [stats.totalUsage, " interactions", stats.avgDuration && " \u2022 ".concat(Math.round(stats.avgDuration), "s avg")] })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-right", children: (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-600", children: ["Last used: ", stats.lastUsed ? stats.lastUsed.toLocaleDateString() : 'Never'] }) })] }) }, card.id));
                                        }) }), cardRelationships.length > 0 && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900 mb-4", children: "Card Relationships" }), (0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: cardRelationships.slice(0, 10).map(function (rel, index) { return ((0, jsx_runtime_1.jsx)(Card_1.default, { className: "p-4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "body", className: "font-medium text-gray-900", children: [rel.cardA, " \u2194 ", rel.cardB] }), (0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-600", children: [rel.type, " relationship"] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-right", children: [(0, jsx_runtime_1.jsxs)(ui_1.Text, { variant: "small", className: "text-gray-900", children: [Math.round(rel.strength * 100), "%"] }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600", children: "confidence" })] })] }) }, index)); }) })] }))] }))] })] }), selectedSuggestion && ((0, jsx_runtime_1.jsx)("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60", children: (0, jsx_runtime_1.jsxs)("div", { className: "bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between p-6 border-b border-gray-200", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg font-semibold text-gray-900", children: "Suggestion Preview" }), (0, jsx_runtime_1.jsx)("button", { onClick: function () { return setSelectedSuggestion(null); }, className: "text-gray-400 hover:text-gray-600 transition-colors", children: (0, jsx_runtime_1.jsx)(lucide_react_1.X, { className: "w-6 h-6" }) })] }), (0, jsx_runtime_1.jsxs)("div", { className: "p-6", children: [(0, jsx_runtime_1.jsx)(ui_1.Heading, { level: 4, className: "text-gray-900 mb-2", children: selectedSuggestion.title }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600 mb-4", children: selectedSuggestion.description }), (0, jsx_runtime_1.jsx)("div", { className: "space-y-3", children: selectedSuggestion.changes.map(function (change, index) { return ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between p-3 bg-gray-50 rounded-lg", children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "body", className: "font-medium text-gray-900", children: change.cardId }), (0, jsx_runtime_1.jsx)(ui_1.Text, { variant: "small", className: "text-gray-600", children: change.reason })] }), (0, jsx_runtime_1.jsxs)("div", { className: "text-sm text-gray-500", children: [change.x, ", ", change.y] })] }, index)); }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex space-x-3 mt-6", children: [(0, jsx_runtime_1.jsx)(Button_1.default, { onClick: function () { return handleApplySuggestion(selectedSuggestion); }, className: "flex-1", children: "Apply Suggestion" }), (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: function () { return setSelectedSuggestion(null); }, variant: "outline", children: "Cancel" })] })] })] }) }))] }));
}
