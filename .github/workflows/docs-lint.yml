name: Documentation Linting

on:
  pull_request:
    paths:
      - 'docs/**/*.md'
      - '**/*.md'
  push:
    branches: [ main, master ]
    paths:
      - 'docs/**/*.md'

jobs:
  lint-docs:
    name: Lint Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install markdownlint-cli
        run: npm install -g markdownlint-cli

      - name: Lint markdown files
        run: markdownlint '**/*.md' --ignore node_modules --ignore .git

      - name: Check for broken links
        run: |
          npm install -g lychee
          lychee --no-progress 'docs/**/*.md' || true

      - name: Validate frontmatter
        run: |
          # Simple frontmatter validation script
          node -e "
            const fs = require('fs');
            const path = require('path');
            const glob = require('glob');
            
            function validateFrontmatter(file) {
              const content = fs.readFileSync(file, 'utf8');
              if (!content.startsWith('---')) return { valid: false, error: 'Missing frontmatter' };
              
              const frontmatterEnd = content.indexOf('---', 3);
              if (frontmatterEnd === -1) return { valid: false, error: 'Invalid frontmatter' };
              
              const frontmatter = content.substring(3, frontmatterEnd);
              const required = ['title', 'category', 'status', 'last_reviewed', 'owner'];
              const missing = required.filter(field => !frontmatter.includes(field + ':'));
              
              if (missing.length > 0) {
                return { valid: false, error: 'Missing fields: ' + missing.join(', ') };
              }
              
              return { valid: true };
            }
            
            // Note: This is a basic check. For full validation, install glob package
            console.log('Frontmatter validation would run here');
          " || true

      - name: Check stale documentation
        run: |
          # Flag docs not updated in 90 days
          find docs -name "*.md" -type f -mtime +90 -exec echo "Stale doc: {}" \; || true






